import{r,s as x,j as e}from"./index-D8VqHZL0.js";import{r as N,B as w,C as v}from"./PrincipalDashboard-CR4eMefn.js";import"./auth.service-C-6KUiiY.js";import"./UnpaidFeeAnalytics-DgMQFA0x.js";import"./clerk.service-wZ_w9nVm.js";function M(){const[m,g]=r.useState([]),[j,i]=r.useState(!0),[u,c]=r.useState(null),[p,o]=r.useState(!1),[l,n]=r.useState({name:"",code:""}),[h,b]=r.useState(null);r.useEffect(()=>{d()},[]);const d=async()=>{var t;try{c(null),i(!0);const s=(t=(await x.auth.getSession()).data.session)==null?void 0:t.access_token;if(!s){c("No authentication token found. Please log in again."),i(!1);return}const a=await N(s);g(a.subjects||[])}catch(s){console.error("Error loading subjects:",s),c(s.message||"Failed to load subjects. Please try again.")}finally{i(!1)}},y=async t=>{var s;t.preventDefault();try{const a=(s=(await x.auth.getSession()).data.session)==null?void 0:s.access_token;if(!a){alert("Please login to continue");return}await w(a,{name:l.name,code:l.code||null}),n({name:"",code:""}),o(!1),d()}catch(a){alert(a.message||"Failed to create subject")}},f=async t=>{var s;if(confirm("Are you sure you want to delete this subject? This action cannot be undone."))try{const a=(s=(await x.auth.getSession()).data.session)==null?void 0:s.access_token;if(!a){alert("Please login to continue");return}await v(a,t),alert("Subject deleted successfully!"),d()}catch(a){alert(a.message||"Failed to delete subject")}};return j?e.jsx("div",{className:"p-6",children:"Loading subjects..."}):u?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-600 text-xl mr-2",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold",children:"Error Loading Subjects"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:u})]})]}),e.jsx("button",{onClick:()=>{c(null),d()},className:"mt-3 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Retry"})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Subjects Management"}),e.jsx("button",{onClick:()=>{o(!0),b(null),n({name:"",code:""})},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Add Subject"})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:h?"Edit Subject":"Create New Subject"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject Name *"}),e.jsx("input",{type:"text",value:l.name,onChange:t=>n({...l,name:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject Code (Optional)"}),e.jsx("input",{type:"text",value:l.code,onChange:t=>n({...l,code:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"e.g., MATH, ENG, SCI"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:h?"Update":"Create"}),e.jsx("button",{type:"button",onClick:()=>{o(!1),b(null),n({name:"",code:""})},className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subject Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:t.code||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>f(t.id),className:"text-red-600 hover:text-red-900",title:"Delete subject",children:"ğŸ—‘ï¸ Delete"})})]},t.id))})]}),m.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ğŸ“š"}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:"No subjects yet"}),e.jsx("p",{className:"text-sm",children:"Create your first subject to get started"})]})]})]})}export{M as default};
