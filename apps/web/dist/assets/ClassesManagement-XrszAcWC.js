import{r,s as u,j as e}from"./index-jNkMZTGm.js";import{r as J,t as K,v as Q,w as N,x as X,y as Z,z as I,A as ee}from"./PrincipalDashboard-CyFNEUke.js";import"./auth.service-B0iywXjZ.js";import"./UnpaidFeeAnalytics-mcRUqrLn.js";import"./clerk.service-FPcaANOT.js";function ie(){const[M,z]=r.useState([]),[D,v]=r.useState(!0),[A,j]=r.useState(null),[F,w]=r.useState(!1),[$,C]=r.useState(!1),[S,k]=r.useState(null),[c,x]=r.useState({name:"",description:""}),[b,L]=r.useState([]),[g,P]=r.useState({}),[i,o]=r.useState([]),[V,_]=r.useState(!1),[n,h]=r.useState(null),[R,T]=r.useState([]),[y,f]=r.useState("");r.useEffect(()=>{p(),B(),H()},[]);const H=async()=>{var s;try{const a=(s=(await u.auth.getSession()).data.session)==null?void 0:s.access_token;if(!a)return;const t=await J(a);T(t.subjects||[])}catch(a){console.error("Error loading subjects:",a)}},O=async s=>{var t,l;const a=(t=(await u.auth.getSession()).data.session)==null?void 0:t.access_token;if(a)try{const d=await N(a),m=((l=d.classes)==null?void 0:l.find(E=>E.id===s.id))||s;h(m),z(d.classes||[])}catch(d){console.error("Error loading classes:",d),h(s)}else h(s);_(!0),f("")},U=async()=>{var s,a;if(!n||!y){alert("Please select a subject");return}try{const t=(s=(await u.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t){alert("Please login to continue");return}await X(t,n.id,y),f(""),await p();const d=(a=(await N(t)).classes)==null?void 0:a.find(m=>m.id===n.id);d&&h(d)}catch(t){alert(t.message||"Failed to add subject")}},q=async s=>{var a,t;if(n&&confirm("Are you sure you want to remove this subject from the class?"))try{const l=(a=(await u.auth.getSession()).data.session)==null?void 0:a.access_token;if(!l){alert("Please login to continue");return}if(await Z(l,n.id,s),await p(),n){const m=(t=(await N(l)).classes)==null?void 0:t.find(E=>E.id===n.id);m&&h(m)}}catch(l){alert(l.message||"Failed to remove subject")}},B=async()=>{var s;try{const a=(s=(await u.auth.getSession()).data.session)==null?void 0:s.access_token;if(!a)return;const t=await K(a);L(t.types||[]);for(const l of t.types||[])try{const d=await Q(a,l.id);P(m=>({...m,[l.id]:d.values||[]}))}catch(d){console.error(`Error loading values for type ${l.id}:`,d)}}catch(a){console.error("Error loading classification types:",a)}},p=async()=>{var s;try{j(null),v(!0);const a=(s=(await u.auth.getSession()).data.session)==null?void 0:s.access_token;if(!a){j("No authentication token found. Please log in again."),v(!1);return}const t=await N(a);z(t.classes||[])}catch(a){console.error("Error loading classes:",a),j(a.message||"Failed to load classes. Please try again.")}finally{v(!1)}},G=async s=>{var a;s.preventDefault();try{const t=(a=(await u.auth.getSession()).data.session)==null?void 0:a.access_token;if(!t){alert("Please login to continue");return}await I(t,{name:c.name,description:c.description,classification_value_ids:i.length>0?i:void 0}),x({name:"",description:""}),o([]),w(!1),p()}catch(t){alert(t.message||"Failed to create class")}},Y=s=>{var t;k(s),x({name:s.name,description:s.description||""});const a=((t=s.classifications)==null?void 0:t.map(l=>l.value_id).filter(Boolean))||[];o(a),C(!0)},W=async s=>{var a;if(s.preventDefault(),!!S)try{const t=(a=(await u.auth.getSession()).data.session)==null?void 0:a.access_token;if(!t){alert("Please login to continue");return}await ee(t,S.id,{name:c.name,description:c.description,classification_value_ids:i.length>0?i:[]}),x({name:"",description:""}),o([]),C(!1),k(null),p()}catch(t){alert(t.message||"Failed to update class")}};return D?e.jsx("div",{className:"p-6",children:"Loading classes..."}):A?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-600 text-xl mr-2",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold",children:"Error Loading Classes"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:A})]})]}),e.jsx("button",{onClick:()=>{j(null),p()},className:"mt-3 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Retry"})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Classes Management"}),e.jsx("button",{onClick:()=>w(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Create Class"})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Class"}),e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Class Name"}),e.jsx("input",{type:"text",value:c.name,onChange:s=>x({...c,name:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:c.description,onChange:s=>x({...c,description:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Classifications ",b.length>0&&e.jsx("span",{className:"text-gray-500 font-normal",children:"(Optional)"})]}),b.length===0?e.jsxs("div",{className:"border border-yellow-200 bg-yellow-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-yellow-800 mb-2",children:e.jsx("strong",{children:"No classification types available."})}),e.jsx("p",{className:"text-xs text-yellow-700",children:'Create classification types (e.g., "Grade", "Stream", "House") in the Classifications section first, then add values to categorize your classes.'})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Select classification values to categorize this class. You can select multiple values from different types."}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:b.map(s=>e.jsxs("div",{className:"border-b border-gray-200 pb-3 last:border-b-0 last:pb-0",children:[e.jsxs("div",{className:"font-semibold text-sm mb-2 text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â—"}),s.name]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-4",children:g[s.id]&&g[s.id].length>0?g[s.id].map(a=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer px-2 py-1 bg-white border border-gray-300 rounded hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:i.includes(a.id),onChange:t=>{t.target.checked?o([...i,a.id]):o(i.filter(l=>l!==a.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:a.value})]},a.id)):e.jsx("span",{className:"text-xs text-gray-400 italic",children:"No values available for this type"})})]},s.id))}),i.length>0&&e.jsxs("div",{className:"mt-2 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:["âœ“ ",i.length," classification value(s) selected"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>{w(!1),o([])},className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[M.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.name}),e.jsx("button",{onClick:()=>Y(s),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-50 transition",title:"Edit class",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]}),s.classifications&&s.classifications.length>0?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wide",children:"Classifications"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.classifications.map((a,t)=>e.jsxs("span",{className:"px-2 py-1 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-md text-xs font-medium text-blue-800 shadow-sm",title:`${a.type}: ${a.value}`,children:[e.jsxs("span",{className:"font-semibold text-blue-600",children:[a.type,":"]})," ",e.jsx("span",{className:"text-blue-800",children:a.value})]},t))})]}):e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"text-xs text-gray-400 italic",children:"No classifications assigned"})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"text-xs font-semibold text-gray-500 mb-2 uppercase tracking-wide flex items-center justify-between",children:[e.jsx("span",{children:"Subjects"}),e.jsx("button",{onClick:()=>O(s),className:"text-blue-600 hover:text-blue-800 text-xs font-normal normal-case",title:"Manage subjects",children:"âœï¸ Manage"})]}),s.subjects&&s.subjects.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.subjects.map(a=>e.jsxs("span",{className:"px-2 py-1 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-md text-xs font-medium text-green-800 shadow-sm",title:a.code?`${a.name} (${a.code})`:a.name,children:[a.name,a.code&&e.jsxs("span",{className:"text-green-600",children:[" (",a.code,")"]})]},a.id))}):e.jsx("div",{className:"text-xs text-gray-400 italic",children:"No subjects assigned"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-gray-600 text-sm",children:s.description||e.jsx("span",{className:"text-gray-400 italic",children:"No description"})})}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"text-xs text-gray-500",children:["Created: ",new Date(s.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]})})]},s.id)),M.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“š"}),e.jsx("p",{className:"text-lg font-semibold mb-2",children:"No classes yet"}),e.jsx("p",{className:"text-sm",children:"Create your first class to get started"})]})]}),$&&S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Class"}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Class Name"}),e.jsx("input",{type:"text",value:c.name,onChange:s=>x({...c,name:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:c.description,onChange:s=>x({...c,description:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Classifications ",b.length>0&&e.jsx("span",{className:"text-gray-500 font-normal",children:"(Optional)"})]}),b.length===0?e.jsxs("div",{className:"border border-yellow-200 bg-yellow-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-yellow-800 mb-2",children:e.jsx("strong",{children:"No classification types available."})}),e.jsx("p",{className:"text-xs text-yellow-700",children:'Create classification types (e.g., "Grade", "Stream", "House") in the Classifications section first, then add values to categorize your classes.'})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Select classification values to categorize this class. You can select multiple values from different types."}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50",children:b.map(s=>e.jsxs("div",{className:"border-b border-gray-200 pb-3 last:border-b-0 last:pb-0",children:[e.jsxs("div",{className:"font-semibold text-sm mb-2 text-gray-700 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-600",children:"â—"}),s.name]}),e.jsx("div",{className:"flex flex-wrap gap-2 ml-4",children:g[s.id]&&g[s.id].length>0?g[s.id].map(a=>e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer px-2 py-1 bg-white border border-gray-300 rounded hover:bg-blue-50 hover:border-blue-300 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:i.includes(a.id),onChange:t=>{t.target.checked?o([...i,a.id]):o(i.filter(l=>l!==a.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:a.value})]},a.id)):e.jsx("span",{className:"text-xs text-gray-400 italic",children:"No values available for this type"})})]},s.id))}),i.length>0&&e.jsxs("div",{className:"mt-2 text-xs font-medium text-blue-600 bg-blue-50 border border-blue-200 rounded px-2 py-1",children:["âœ“ ",i.length," classification value(s) selected"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Update"}),e.jsx("button",{type:"button",onClick:()=>{C(!1),k(null),x({name:"",description:""}),o([])},className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),V&&n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Manage Subjects: ",n.name]}),e.jsx("button",{onClick:()=>{_(!1),h(null),f("")},className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]}),e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-semibold mb-3 text-gray-700",children:"Add Subject"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:y,onChange:s=>f(s.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"",children:"Select a subject"}),R.filter(s=>{var a;return!((a=n.subjects)!=null&&a.some(t=>t.id===s.id))}).map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.code?`(${s.code})`:""]},s.id))]}),e.jsx("button",{onClick:U,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",disabled:!y,children:"Add"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold mb-3 text-gray-700",children:"Current Subjects"}),n.subjects&&n.subjects.length>0?e.jsx("div",{className:"space-y-2",children:n.subjects.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900",children:s.name}),s.code&&e.jsxs("span",{className:"text-gray-500 ml-2",children:["(",s.code,")"]})]}),e.jsx("button",{onClick:()=>q(s.class_subject_id),className:"text-red-600 hover:text-red-800 text-sm",title:"Remove subject",children:"ðŸ—‘ï¸ Remove"})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No subjects assigned to this class yet."}),e.jsx("p",{className:"text-sm mt-1",children:"Add subjects using the form above."})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{_(!1),h(null),f("")},className:"w-full bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Close"})})]})})]})}export{ie as default};
