import{s as f,A as n}from"./index-BLS27RO3.js";const m="",i={students:`${m}/students`,studentsAdmin:`${m}/students-admin`,classes:`${m}/classes`,clerkFees:`${m}/clerk-fees`,salary:`${m}/salary`};async function p(a){const t=await fetch(`${n}${i.students}`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load students");return await t.json()}async function $(a,t,e=1,o=50){var r,s;const l=new URLSearchParams;t&&l.append("class_group_id",t),l.append("page",e.toString()),l.append("limit",Math.min(o,100).toString());const u=`${n}${i.studentsAdmin}?${l.toString()}`;console.log("[clerk.service] Loading students from:",u);const c=await fetch(u,{headers:{Authorization:`Bearer ${a}`}});if(!c.ok){const y=await c.json().catch(()=>({error:`HTTP ${c.status}: ${c.statusText}`})),h=(y==null?void 0:y.error)||`Failed to load students (${c.status})`;throw console.error("[clerk.service] Failed to load students:",{url:u,status:c.status,statusText:c.statusText,error:h,classGroupId:t}),new Error(h)}const d=await c.json();return console.log("[clerk.service] Successfully loaded students:",{classesCount:((r=d.classes)==null?void 0:r.length)||0,unassignedCount:((s=d.unassigned)==null?void 0:s.length)||0,total_students:d.total_students,classGroupId:t}),d}async function g(a){const t=await fetch(`${n}${i.classes}`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load classes for fee collection");return await t.json()}async function S(a,t){const e=await fetch(`${n}${i.clerkFees}/student/${t}/fee-structure`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const o=await e.json().catch(()=>({}));if(o.error&&o.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(o.error||"Failed to load fee structure")}return await e.json()}async function _(a,t){const e=await fetch(`${n}${i.clerkFees}/student/${t}/payments`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{payments:[]}}async function F(a,t){const e=await fetch(`${n}${i.clerkFees}/collect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw new Error(o.error||"Failed to collect fee")}return await e.json()}async function j(a,t,e){const o=await fetch(`${n}${i.salary}/history/${t}?${e.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!o.ok){const l=await o.json().catch(()=>({}));throw new Error(l.error||"Failed to load payment history")}return await o.json()}async function k(a){var d;let t=[],e=[],o=[];try{const{data:r,error:s}=await f.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!s&&r&&(t=r)}catch(r){console.error("Error loading recent payments from Supabase:",r)}try{const r=new Date().toISOString().split("T")[0],{data:s,error:y}=await f.from("monthly_fee_payments").select("payment_amount").gte("payment_date",r);!y&&s&&(e=s)}catch(r){console.error("Error loading today payments from Supabase:",r)}try{const{data:r,error:s}=await f.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!s&&r&&(o=r)}catch(r){console.error("Error loading pending components from Supabase:",r)}const l=e.reduce((r,s)=>r+parseFloat(s.payment_amount||0),0),u=o.reduce((r,s)=>r+parseFloat(s.pending_amount||0),0);return{totalStudents:((d=(await p(a).catch(()=>({students:[]}))).students)==null?void 0:d.length)||0,todayCollection:l,totalPending:u,recentPayments:t}}async function A(a,t="last_12_months"){const e=await fetch(`${n}${i.salary}/unpaid?time_scope=${t}`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{teachers:[]}}async function E(a){const t=await fetch(`${n}${i.salary}/summary`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const e=await t.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(e.error||"Failed to load salary summaries")}return await t.json()}async function P(a,t){const e=await fetch(`${n}${i.salary}/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw new Error(o.error||"Failed to record payment")}return await e.json()}export{i as R,g as a,S as b,_ as c,F as d,$ as e,A as f,E as g,j as h,k as l,P as r};
