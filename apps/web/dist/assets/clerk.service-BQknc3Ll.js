import{s as u,A as n}from"./index-BOMOBQPd.js";const d="",i={students:`${d}/students`,studentsAdmin:`${d}/students-admin`,classes:`${d}/classes`,clerkFees:`${d}/clerk-fees`,salary:`${d}/salary`};async function h(r){const e=await fetch(`${n}${i.students}`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok)throw new Error("Failed to load students");return await e.json()}async function w(r,e){let t=`${n}${i.studentsAdmin}`;e&&(t+=`?class_group_id=${e}`);const a=await fetch(t,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok){const c=await a.json().catch(()=>({error:`HTTP ${a.status}: ${a.statusText}`})),l=(c==null?void 0:c.error)||`Failed to load students (${a.status})`;throw console.error("[clerk.service] Failed to load students:",{url:t,status:a.status,statusText:a.statusText,error:l}),new Error(l)}return await a.json()}async function $(r){const e=await fetch(`${n}${i.classes}`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok)throw new Error("Failed to load classes for fee collection");return await e.json()}async function g(r,e){const t=await fetch(`${n}${i.clerkFees}/student/${e}/fee-structure`,{headers:{Authorization:`Bearer ${r}`}});if(!t.ok){const a=await t.json().catch(()=>({}));if(a.error&&a.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(a.error||"Failed to load fee structure")}return await t.json()}async function _(r,e){const t=await fetch(`${n}${i.clerkFees}/student/${e}/payments`,{headers:{Authorization:`Bearer ${r}`}});return t.ok?await t.json():{payments:[]}}async function S(r,e){const t=await fetch(`${n}${i.clerkFees}/collect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to collect fee")}return await t.json()}async function F(r,e,t){const a=await fetch(`${n}${i.salary}/history/${e}?${t.toString()}`,{headers:{Authorization:`Bearer ${r}`}});if(!a.ok){const c=await a.json().catch(()=>({}));throw new Error(c.error||"Failed to load payment history")}return await a.json()}async function j(r){var y;let e=[],t=[],a=[];try{const{data:o,error:s}=await u.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!s&&o&&(e=o)}catch(o){console.error("Error loading recent payments from Supabase:",o)}try{const o=new Date().toISOString().split("T")[0],{data:s,error:f}=await u.from("monthly_fee_payments").select("payment_amount").gte("payment_date",o);!f&&s&&(t=s)}catch(o){console.error("Error loading today payments from Supabase:",o)}try{const{data:o,error:s}=await u.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!s&&o&&(a=o)}catch(o){console.error("Error loading pending components from Supabase:",o)}const c=t.reduce((o,s)=>o+parseFloat(s.payment_amount||0),0),l=a.reduce((o,s)=>o+parseFloat(s.pending_amount||0),0);return{totalStudents:((y=(await h(r).catch(()=>({students:[]}))).students)==null?void 0:y.length)||0,todayCollection:c,totalPending:l,recentPayments:e}}async function k(r,e="last_12_months"){const t=await fetch(`${n}${i.salary}/unpaid?time_scope=${e}`,{headers:{Authorization:`Bearer ${r}`}});return t.ok?await t.json():{teachers:[]}}async function A(r){const e=await fetch(`${n}${i.salary}/summary`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(t.error||"Failed to load salary summaries")}return await e.json()}async function E(r,e){const t=await fetch(`${n}${i.salary}/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(e)});if(!t.ok){const a=await t.json();throw new Error(a.error||"Failed to record payment")}return await t.json()}export{i as R,$ as a,w as b,_ as c,S as d,g as e,k as f,A as g,F as h,j as l,E as r};
