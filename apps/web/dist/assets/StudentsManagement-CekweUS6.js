import{r as o,s as v,j as e}from"./index-CN_qW8X5.js";import{w as Fe,D as Ee,E as De,F as Pe,G as ne,H as Te,I as Me,J as $e,K as Le,L as Ue}from"./PrincipalDashboard-BhrUjhjb.js";import"./auth.service-BN9bvnQx.js";import"./UnpaidFeeAnalytics-Czf1g9VC.js";import"./clerk.service-DLvCQljG.js";function We(){var ae,le;const[J,re]=o.useState([]),[E,ie]=o.useState([]),[K,Q]=o.useState(new Set),[de,D]=o.useState(!0),[V,P]=o.useState(null),[oe,ce]=o.useState(0),[T,me]=o.useState([]),[U,O]=o.useState({}),[ue,q]=o.useState(!1),[xe,R]=o.useState(!1),[fe,G]=o.useState(!1),[b,X]=o.useState(null),[M,pe]=o.useState(""),[k,z]=o.useState({class_group_id:"",section_id:"",roll_number:""}),[d,g]=o.useState({class_fee_id:"",class_fee_discount:0,transport_enabled:!1,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[],effective_from_date:""}),[j,W]=o.useState(null),[he,Y]=o.useState(!1),[Z,C]=o.useState(!1),[$,I]=o.useState({target_class_id:"",section_id:""}),[A,B]=o.useState({target_class_id:"",clear_sections:!1}),[ge,H]=o.useState(!1),[n,p]=o.useState({email:"",password:"",full_name:"",username:"",phone:"",roll_number:"",class_group_id:"",section_id:"",admission_date:"",gender:"",date_of_birth:"",home_address:"",guardian_name:"",guardian_phone:"",guardian_email:"",guardian_relationship:"parent"}),[w,F]=o.useState(null),[_e,ee]=o.useState(!1),[m,y]=o.useState({class_fee_id:"",class_fee_discount:0,transport_enabled:!0,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[]}),[h,S]=o.useState({checking:!1,available:null,message:""});o.useEffect(()=>{const t=setTimeout(async()=>{var l;const a=n.username.trim();if(!a){S({checking:!1,available:null,message:""});return}if(a.length<3){S({checking:!1,available:null,message:"Username must be at least 3 characters"});return}S({checking:!0,available:null,message:"Checking availability..."});try{const r=(l=(await v.auth.getSession()).data.session)==null?void 0:l.access_token;if(!r){S({checking:!1,available:null,message:""});return}const c=await Ee(r,a);S({checking:!1,available:c.available,message:c.message||(c.available?"Username is available ✓":"Username already exists. Please choose another.")})}catch(r){console.error("Error checking username:",r),S({checking:!1,available:!1,message:"Error checking username"})}},300);return()=>clearTimeout(t)},[n.username]);const L=async(s=!1)=>{var t;try{P(null),s&&D(!0);const a=(t=(await v.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a){P("No authentication token found. Please log in again."),s&&D(!1);return}const l=await De(a);re((l.classes||[]).map(r=>{var c;return{id:r.id,name:r.name,description:r.description||null,classifications:[],students:(r.students||[]).map(i=>({id:i.id,roll_number:i.roll_number,status:"active",section_id:i.section_id,section_name:null,profile:i.profile})),student_count:((c=r.students)==null?void 0:c.length)||0}})),ie(l.unassigned||[]),ce(l.total_students||0),s&&l.classes&&l.classes.length>0&&K.size===0&&Q(new Set([l.classes[0].id]))}catch(a){console.error("Error loading students:",a),P(a.message||"Failed to load students. Please try again.")}finally{s&&D(!1)}};o.useEffect(()=>{L(!0),be()},[]);const be=async()=>{var s;try{const t=(s=(await v.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const a=await Fe(t);me(a.classes||[])}catch(t){console.error("Error loading classes:",t)}},je=async s=>{var t;if(!s){O(a=>({...a,[s]:[]}));return}if(!U[s])try{const a=(t=(await v.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;const l=await Pe(a,s);O(r=>({...r,[s]:l.sections||[]}))}catch(a){console.error("Error loading sections:",a),O(l=>({...l,[s]:[]}))}},ye=async s=>{var t,a,l,r;try{ee(!0);const c=(t=(await v.auth.getSession()).data.session)==null?void 0:t.access_token;if(!c)return;const i=await ne(c,s);console.log("[Add Student] Loaded default fees:",i),console.log("[Add Student] Class fees array:",i.class_fees),console.log("[Add Student] Class fees length:",(a=i.class_fees)==null?void 0:a.length),console.log("[Add Student] Is array?",Array.isArray(i.class_fees)),F(i);const x=i.class_fees&&i.class_fees.length>0?i.class_fees[0].id:"";console.log("[Add Student] Default class fee ID:",x),console.log("[Add Student] Class fees count:",((l=i.class_fees)==null?void 0:l.length)||0),console.log("[Add Student] Custom fees count:",((r=i.custom_fees)==null?void 0:r.length)||0);const u=(i.custom_fees||[]).map(_=>({custom_fee_id:_.id,discount:0,is_exempt:!1}));y({class_fee_id:x,class_fee_discount:0,transport_enabled:!0,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:u})}catch(c){console.error("Error loading default fees:",c),F(null)}finally{ee(!1)}},se=async s=>{var t;if(X(s),z({class_group_id:s.class_group_id||"",section_id:s.section_id||"",roll_number:s.roll_number||""}),q(!0),s.id)try{const a=(t=(await v.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;const l=await Te(a,s.id);if(l.fee_config){const r=l.fee_config;g({class_fee_id:r.class_fee_id||"",class_fee_discount:r.class_fee_discount||0,transport_enabled:r.transport_enabled??!1,transport_route_id:r.transport_route_id||"",transport_fee_discount:r.transport_fee_discount||0,other_fees:r.other_fees||[],custom_fees:r.custom_fees||[],effective_from_date:""})}}catch(a){console.error("Error loading fee config:",a)}s.class_group_id&&te(s.class_group_id)},te=async s=>{var t,a;try{Y(!0);const l=(t=(await v.auth.getSession()).data.session)==null?void 0:t.access_token;if(!l)return;const r=await ne(l,s);if(console.log("[Edit Student] Loaded default fees:",r),console.log("[Edit Student] Class fees array:",r.class_fees),console.log("[Edit Student] Class fees length:",(a=r.class_fees)==null?void 0:a.length),W(r),r.class_fees&&Array.isArray(r.class_fees)&&r.class_fees.length>0){const c=r.class_fees[0].id;g(i=>({...i,class_fee_id:c,class_fee_discount:i.class_fee_id===c?i.class_fee_discount:0}))}else g(c=>({...c,class_fee_id:"",class_fee_discount:0}))}catch(l){console.error("Error loading default fees:",l),W(null)}finally{Y(!1)}},Ne=s=>{X(s),I({target_class_id:"",section_id:""}),R(!0)},ve=s=>{pe(s),B({target_class_id:"",clear_sections:!1}),G(!0)},we=async()=>{var s;if(b)try{C(!0);const t=(s=(await v.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const a={class_group_id:k.class_group_id||null,section_id:k.section_id||null,roll_number:k.roll_number||null};k.class_group_id&&j&&(a.fee_config={...d,effective_from_date:d.effective_from_date||void 0}),await Me(t,b.id,a),q(!1),alert("Student updated successfully!"),await L(!1)}catch(t){alert(t.message||"Failed to update student")}finally{C(!1)}},ke=async()=>{var s;if(!b||!$.target_class_id){alert("Please select a target class");return}try{C(!0);const t=(s=(await v.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const{section_id:a,...l}=$,r=await $e(t,b.id,l);R(!1),alert(r.message||"Student promoted successfully!"),await L(!1)}catch(t){alert(t.message||"Failed to promote student")}finally{C(!1)}},Se=async()=>{var s;if(!M||!A.target_class_id){alert("Please select a target class");return}if(confirm("Are you sure you want to move all students from this class to the target class? This action cannot be undone."))try{C(!0);const t=(s=(await v.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const a=await Le(t,M,A);G(!1),alert(a.message||"Class promoted successfully!"),await L(!1)}catch(t){alert(t.message||"Failed to promote class")}finally{C(!1)}},Ce=s=>{Q(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})};if(de)return e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Students Management"}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:e.jsx("div",{className:"text-2xl mb-4",children:"Loading students..."})})]});if(V)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-600 text-xl mr-2",children:"⚠️"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold",children:"Error Loading Students"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:V})]})]}),e.jsx("button",{onClick:()=>{P(null),D(!0),window.location.reload()},className:"mt-3 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Retry"})]})});const Ae=async s=>{var t;if(s.preventDefault(),h.checking){alert("Please wait while we check username availability...");return}if(h.available===!1){alert("Please choose a different username. The current username is already taken.");return}if(n.username.trim().length<3){alert("Username must be at least 3 characters long.");return}try{const a=(t=(await v.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;await Ue(a,{email:n.email,password:n.password,full_name:n.full_name,username:n.username,phone:n.phone||null,roll_number:n.roll_number||null,class_group_id:n.class_group_id||null,section_id:n.section_id||null,admission_date:n.admission_date||null,gender:n.gender||null,date_of_birth:n.date_of_birth||null,home_address:n.home_address||null,guardian_name:n.guardian_name,guardian_phone:n.guardian_phone,guardian_email:n.guardian_email||null,guardian_relationship:n.guardian_relationship,fee_config:n.class_group_id?m:void 0}),alert("Student added successfully!"),H(!1),p({email:"",password:"",full_name:"",username:"",phone:"",roll_number:"",class_group_id:"",section_id:"",admission_date:"",gender:"",date_of_birth:"",home_address:"",guardian_name:"",guardian_phone:"",guardian_email:"",guardian_relationship:"parent"}),S({checking:!1,available:null,message:""}),F(null),y({class_fee_id:"",class_fee_discount:0,transport_enabled:!0,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[]}),window.location.reload()}catch(a){alert(a.message||"Failed to add student")}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Students Management"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-lg text-gray-600",children:["Total: ",e.jsx("span",{className:"font-bold text-blue-600",children:oe})," students"]}),e.jsx("button",{onClick:()=>H(!0),className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition",children:"➕ Add Student"})]})]}),e.jsx("div",{className:"space-y-4 mb-6",children:J.map(s=>{const t=K.has(s.id),a=s.classifications&&s.classifications.length>0?` (${s.classifications.map(l=>`${l.type}: ${l.value}`).join(", ")})`:"";return e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("button",{onClick:()=>Ce(s.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-2xl",children:t?"▼":"▶"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[s.name,a]}),s.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:l=>{l.stopPropagation(),ve(s.id)},className:"px-3 py-1 bg-green-600 text-white rounded-md text-sm font-semibold hover:bg-green-700 transition",title:"Promote entire class",children:"⬆ Promote Class"}),e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:[s.student_count," ",s.student_count===1?"student":"students"]})]})]}),t&&e.jsx("div",{className:"border-t border-gray-200",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Roll No."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Section"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.students.map(l=>{var r,c,i;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:l.roll_number||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((r=l.profile)==null?void 0:r.full_name)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:l.section_name||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((c=l.profile)==null?void 0:c.email)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((i=l.profile)==null?void 0:i.phone)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${l.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>se(l),className:"text-blue-600 hover:text-blue-900",title:"Edit student",children:"✏️ Edit"}),e.jsx("button",{onClick:()=>Ne(l),className:"text-green-600 hover:text-green-900",title:"Promote/Demote student",children:"⬆ Promote"})]})})]},l.id)})})]})})})]},s.id)})}),E.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 bg-yellow-50 border-b border-yellow-200",children:[e.jsxs("h3",{className:"text-lg font-semibold text-yellow-800",children:["Unassigned Students (",E.length,")"]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"These students haven't been assigned to a class yet."})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Roll No."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map(s=>{var t,a,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.roll_number||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:((t=s.profile)==null?void 0:t.full_name)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((a=s.profile)==null?void 0:a.email)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:((l=s.profile)==null?void 0:l.phone)||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("button",{onClick:()=>se(s),className:"text-blue-600 hover:text-blue-900",title:"Assign class to student",children:"✏️ Assign Class"})})]},s.id)})})]})})]}),J.length===0&&E.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[e.jsx("div",{className:"text-gray-500 text-lg",children:"No students found."}),e.jsx("div",{className:"text-gray-400 text-sm mt-2",children:"Students will appear here once they are approved and assigned to classes."})]}),ue&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Student: ",(ae=b.profile)==null?void 0:ae.full_name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Class"}),e.jsxs("select",{value:k.class_group_id,onChange:s=>{const t=s.target.value;z({...k,class_group_id:t,section_id:""}),t?(te(t),g({class_fee_id:"",class_fee_discount:0,transport_enabled:!1,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[],effective_from_date:""})):(W(null),g({class_fee_id:"",class_fee_discount:0,transport_enabled:!1,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[],effective_from_date:""}))},className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"",children:"No Class"}),T.map(s=>{const t=s.classifications&&s.classifications.length>0?` (${s.classifications.map(a=>`${a.type}: ${a.value}`).join(", ")})`:"";return e.jsxs("option",{value:s.id,children:[s.name,t]},s.id)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Roll Number"}),e.jsx("input",{type:"text",value:k.roll_number,onChange:s=>z({...k,roll_number:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),k.class_group_id&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-700",children:"Fee Configuration"}),b&&e.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apply From Date *"}),e.jsx("input",{type:"date",required:!0,value:d.effective_from_date||new Date().toISOString().split("T")[0],min:b.admission_date||void 0,onChange:s=>g({...d,effective_from_date:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),e.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["The new fee structure will be effective from this date. Previous fee structure remains unchanged for all months before this date.",b.admission_date&&` (Student admission date: ${new Date(b.admission_date).toLocaleDateString()})`]})]}),he?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading fee information..."})]}):j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h5",{className:"font-semibold text-gray-700 mb-2",children:"Class Fee (Default for this class)"}),(()=>{var i;const s=j.class_fees&&Array.isArray(j.class_fees)?j.class_fees:[];let t=null;s.length>0&&(d.class_fee_id&&(t=s.find(x=>x.id===d.class_fee_id)),t||(t=s[0],!d.class_fee_id&&t&&g(x=>({...x,class_fee_id:t.id})))),console.log("[Edit Student Display] Class fees available:",s.length),console.log("[Edit Student Display] editFeeConfig.class_fee_id:",d.class_fee_id),console.log("[Edit Student Display] Selected fee:",t?{id:t.id,amount:t.amount}:"none");const a=((i=t==null?void 0:t.fee_categories)==null?void 0:i.name)||"Class Fee",l=t?parseFloat(t.amount||0):0,r=(t==null?void 0:t.fee_cycle)||"monthly",c=Math.max(0,l-d.class_fee_discount);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[a,":"]}),e.jsxs("span",{className:"font-medium",children:["₹",l.toFixed(2),"/",r]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Discount (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",max:l,value:d.class_fee_discount,onChange:x=>{const u=parseFloat(x.target.value)||0;g({...d,class_fee_discount:Math.min(u,l)})},className:"w-full px-2 py-1 border rounded text-sm",placeholder:"0"})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold pt-1 border-t",children:[e.jsx("span",{children:"Final Amount:"}),e.jsxs("span",{className:"text-green-600",children:["₹",c.toFixed(2),"/",r]})]})]})})()]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:"Transport Fee"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.transport_enabled,onChange:s=>g({...d,transport_enabled:s.target.checked,transport_route_id:s.target.checked?d.transport_route_id:""}),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Enable Transport"})]})]}),d.transport_enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Select Route"}),e.jsxs("select",{value:d.transport_route_id,onChange:s=>g({...d,transport_route_id:s.target.value}),className:"w-full px-2 py-1 border rounded text-sm",children:[e.jsx("option",{value:"",children:"Select Transport Route"}),j.transport_routes.map(s=>{var t,a,l;return e.jsxs("option",{value:s.id,children:[s.route_name," ",s.bus_number?`(${s.bus_number})`:""," - ₹",((a=(t=s.fee)==null?void 0:t.total)==null?void 0:a.toFixed(2))||"0.00","/",((l=s.fee)==null?void 0:l.fee_cycle)||"monthly"]},s.id)})]})]}),d.transport_route_id&&(()=>{const s=j.transport_routes.find(r=>r.id===d.transport_route_id),t=s==null?void 0:s.fee,a=t?parseFloat(t.total||0):0,l=Math.max(0,a-d.transport_fee_discount);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Route Fee:"}),e.jsxs("span",{className:"font-medium",children:["₹",a.toFixed(2),"/",(t==null?void 0:t.fee_cycle)||"monthly"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Discount (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:d.transport_fee_discount,onChange:r=>g({...d,transport_fee_discount:parseFloat(r.target.value)||0}),className:"w-full px-2 py-1 border rounded text-sm",placeholder:"0"})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold pt-1 border-t",children:[e.jsx("span",{children:"Final Amount:"}),e.jsxs("span",{className:"text-green-600",children:["₹",l.toFixed(2),"/",(t==null?void 0:t.fee_cycle)||"monthly"]})]})]})})()]})]}),j.custom_fees&&Array.isArray(j.custom_fees)&&j.custom_fees.length>0&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h5",{className:"font-semibold text-gray-700 mb-3",children:"Custom Fees"}),e.jsx("div",{className:"space-y-3",children:j.custom_fees.map(s=>{var i,x;const t=d.custom_fees.find(u=>u.custom_fee_id===s.id)||{custom_fee_id:s.id,discount:0,is_exempt:!1},a=parseFloat(s.amount||0),l=t.is_exempt?0:Math.max(0,a-t.discount),r=((i=s.class_groups)==null?void 0:i.name)||"All Classes",c=((x=s.fee_categories)==null?void 0:x.name)||s.name||"Custom Fee";return e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:c}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",r,")"]})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["₹",a.toFixed(2),"/",s.fee_cycle||"monthly"]})]})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:t.is_exempt,onChange:u=>{const _=d.custom_fees.map(f=>f.custom_fee_id===s.id?{...f,is_exempt:u.target.checked,discount:u.target.checked?0:f.discount}:f);d.custom_fees.find(f=>f.custom_fee_id===s.id)||_.push({custom_fee_id:s.id,discount:0,is_exempt:u.target.checked}),g({...d,custom_fees:_})},className:"rounded"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Exempt"})]})]}),!t.is_exempt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Discount (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",max:a,value:t.discount,onChange:u=>{const _=parseFloat(u.target.value)||0,f=d.custom_fees.map(N=>N.custom_fee_id===s.id?{...N,discount:Math.min(_,a)}:N);d.custom_fees.find(N=>N.custom_fee_id===s.id)||f.push({custom_fee_id:s.id,discount:Math.min(_,a),is_exempt:!1}),g({...d,custom_fees:f})},className:"w-full px-2 py-1 border rounded text-sm",placeholder:"0"})]}),e.jsxs("div",{className:"flex justify-between text-xs font-semibold pt-1 border-t mt-1",children:[e.jsx("span",{children:"Final Amount:"}),e.jsxs("span",{className:"text-green-600",children:["₹",l.toFixed(2),"/",s.fee_cycle||"monthly"]})]})]}),t.is_exempt&&e.jsx("div",{className:"text-xs text-red-600 font-semibold pt-1",children:"Student is exempt from this fee"})]},s.id)})})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Select a class to configure fees"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:we,disabled:Z,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:Z?"Updating...":"Update"}),e.jsx("button",{onClick:()=>q(!1),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})}),xe&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Promote/Demote Student: ",(le=b.profile)==null?void 0:le.full_name]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Class"}),e.jsxs("select",{value:$.target_class_id,onChange:s=>{I({...$,target_class_id:s.target.value,section_id:""})},className:"w-full px-3 py-2 border rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select Target Class"}),T.map(s=>{const t=s.classifications&&s.classifications.length>0?` (${s.classifications.map(a=>`${a.type}: ${a.value}`).join(", ")})`:"";return e.jsxs("option",{value:s.id,children:[s.name,t]},s.id)})]})]})}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:ke,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Promote"}),e.jsx("button",{onClick:()=>R(!1),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})}),ge&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Student"}),e.jsxs("form",{onSubmit:Ae,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",required:!0,value:n.full_name,onChange:s=>p({...n,full_name:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email *"}),e.jsx("input",{type:"email",required:!0,value:n.email,onChange:s=>p({...n,email:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Username *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",required:!0,value:n.username,onChange:s=>p({...n,username:s.target.value}),className:`w-full px-3 py-2 pr-10 border rounded-md ${h.available===!1?"border-red-500 focus:border-red-500 focus:ring-red-500":h.available===!0?"border-green-500 focus:border-green-500 focus:ring-green-500":""}`,placeholder:"Unique username for login (unique per school)"}),n.username.trim().length>0&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:h.checking?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}):h.available===!0?e.jsx("svg",{className:"h-5 w-5 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):h.available===!1?e.jsx("svg",{className:"h-5 w-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):null})]}),n.username.trim().length>0&&e.jsx("div",{className:"mt-1",children:h.checking?e.jsxs("p",{className:"text-xs text-blue-600 flex items-center gap-1",children:[e.jsx("span",{className:"animate-spin inline-block w-3 h-3 border-2 border-blue-600 border-t-transparent rounded-full"}),"Checking availability..."]}):h.message?e.jsx("p",{className:`text-xs font-medium ${h.available===!0?"text-green-600":h.available===!1?"text-red-600":"text-gray-500"}`,children:h.message}):null}),n.username.trim().length===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Username must be unique within your school"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Password *"}),e.jsx("input",{type:"password",required:!0,minLength:8,value:n.password,onChange:s=>p({...n,password:s.target.value}),className:"w-full px-3 py-2 border rounded-md",placeholder:"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Phone"}),e.jsx("input",{type:"tel",value:n.phone,onChange:s=>p({...n,phone:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Gender"}),e.jsxs("select",{value:n.gender,onChange:s=>p({...n,gender:s.target.value}),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Roll Number"}),e.jsx("input",{type:"text",value:n.roll_number,onChange:s=>p({...n,roll_number:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Class"}),e.jsxs("select",{value:n.class_group_id,onChange:async s=>{const t=s.target.value;p({...n,class_group_id:t,section_id:""}),t?(je(t),await ye(t)):(F(null),y({class_fee_id:"",class_fee_discount:0,transport_enabled:!0,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[]}))},className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Select Class (Optional)"}),T.map(s=>{const t=s.classifications&&s.classifications.length>0?` (${s.classifications.map(a=>`${a.type}: ${a.value}`).join(", ")})`:"";return e.jsxs("option",{value:s.id,children:[s.name,t]},s.id)})]})]}),n.class_group_id&&U[n.class_group_id]&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Section"}),e.jsxs("select",{value:n.section_id,onChange:s=>p({...n,section_id:s.target.value}),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"",children:"Select Section (Optional)"}),U[n.class_group_id].map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Date of Birth"}),e.jsx("input",{type:"date",value:n.date_of_birth,onChange:s=>p({...n,date_of_birth:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Home Address"}),e.jsx("textarea",{value:n.home_address,onChange:s=>p({...n,home_address:s.target.value}),className:"w-full px-3 py-2 border rounded-md",rows:3,placeholder:"Enter home address"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Admission Date"}),e.jsx("input",{type:"date",value:n.admission_date,onChange:s=>p({...n,admission_date:s.target.value}),className:"w-full px-3 py-2 border rounded-md"})]}),n.class_group_id&&e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-700",children:"Fee Configuration"}),_e?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Loading fee information..."})]}):w?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h5",{className:"font-semibold text-gray-700 mb-2",children:"Class Fee (Default for this class)"}),(()=>{var i;const s=w.class_fees&&Array.isArray(w.class_fees)?w.class_fees:[];let t=null;s.length>0&&(m.class_fee_id&&(t=s.find(x=>x.id===m.class_fee_id)),t||(t=s[0],!m.class_fee_id&&t&&y(x=>({...x,class_fee_id:t.id})))),console.log("[Add Student Display] Class fees available:",s.length),console.log("[Add Student Display] feeConfig.class_fee_id:",m.class_fee_id),console.log("[Add Student Display] Selected fee:",t?{id:t.id,amount:t.amount}:"none");const a=((i=t==null?void 0:t.fee_categories)==null?void 0:i.name)||"Class Fee",l=t?parseFloat(t.amount||0):0,r=(t==null?void 0:t.fee_cycle)||"monthly",c=Math.max(0,l-m.class_fee_discount);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[a,":"]}),e.jsxs("span",{className:"font-medium",children:["₹",l.toFixed(2),"/",r]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Discount (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",max:l,value:m.class_fee_discount,onChange:x=>{const u=parseFloat(x.target.value)||0;y({...m,class_fee_discount:Math.min(u,l)})},className:"w-full px-2 py-1 border rounded text-sm",placeholder:"0"})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold pt-1 border-t",children:[e.jsx("span",{children:"Final Amount:"}),e.jsxs("span",{className:"text-green-600",children:["₹",c.toFixed(2),"/",r]})]})]})})()]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:"Transport Fee"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:m.transport_enabled,onChange:s=>y({...m,transport_enabled:s.target.checked,transport_route_id:s.target.checked?m.transport_route_id:""}),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Enable Transport"})]})]}),m.transport_enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Select Route"}),e.jsxs("select",{value:m.transport_route_id,onChange:s=>y({...m,transport_route_id:s.target.value}),className:"w-full px-2 py-1 border rounded text-sm",children:[e.jsx("option",{value:"",children:"Select Transport Route"}),w.transport_routes.map(s=>{var t,a,l;return e.jsxs("option",{value:s.id,children:[s.route_name," ",s.bus_number?`(${s.bus_number})`:""," - ₹",((a=(t=s.fee)==null?void 0:t.total)==null?void 0:a.toFixed(2))||"0.00","/",((l=s.fee)==null?void 0:l.fee_cycle)||"monthly"]},s.id)})]})]}),m.transport_route_id&&(()=>{const s=w.transport_routes.find(r=>r.id===m.transport_route_id),t=s==null?void 0:s.fee,a=t?parseFloat(t.total||0):0,l=Math.max(0,a-m.transport_fee_discount);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Route Fee:"}),e.jsxs("span",{className:"font-medium",children:["₹",a.toFixed(2),"/",(t==null?void 0:t.fee_cycle)||"monthly"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Discount (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:m.transport_fee_discount,onChange:r=>y({...m,transport_fee_discount:parseFloat(r.target.value)||0}),className:"w-full px-2 py-1 border rounded text-sm",placeholder:"0"})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold pt-1 border-t",children:[e.jsx("span",{children:"Final Amount:"}),e.jsxs("span",{className:"text-green-600",children:["₹",l.toFixed(2),"/",(t==null?void 0:t.fee_cycle)||"monthly"]})]})]})})()]})]}),w.custom_fees&&Array.isArray(w.custom_fees)&&w.custom_fees.length>0&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h5",{className:"font-semibold text-gray-700 mb-3",children:"Custom Fees"}),e.jsx("div",{className:"space-y-3",children:w.custom_fees.map(s=>{var i,x;const t=m.custom_fees.find(u=>u.custom_fee_id===s.id)||{custom_fee_id:s.id,discount:0,is_exempt:!1},a=parseFloat(s.amount||0),l=t.is_exempt?0:Math.max(0,a-t.discount),r=((i=s.class_groups)==null?void 0:i.name)||"All Classes",c=((x=s.fee_categories)==null?void 0:x.name)||s.name||"Custom Fee";return e.jsxs("div",{className:"bg-white p-3 rounded border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-sm",children:c}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",r,")"]})]}),e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["₹",a.toFixed(2),"/",s.fee_cycle||"monthly"]})]})}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer ml-3",children:[e.jsx("input",{type:"checkbox",checked:t.is_exempt,onChange:u=>{const _=m.custom_fees.map(f=>f.custom_fee_id===s.id?{...f,is_exempt:u.target.checked,discount:u.target.checked?0:f.discount}:f);m.custom_fees.find(f=>f.custom_fee_id===s.id)||_.push({custom_fee_id:s.id,discount:0,is_exempt:u.target.checked}),y({...m,custom_fees:_})},className:"rounded"}),e.jsx("span",{className:"text-xs text-gray-600",children:"Exempt"})]})]}),!t.is_exempt&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Discount (₹)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",max:a,value:t.discount,onChange:u=>{const _=parseFloat(u.target.value)||0,f=m.custom_fees.map(N=>N.custom_fee_id===s.id?{...N,discount:Math.min(_,a)}:N);m.custom_fees.find(N=>N.custom_fee_id===s.id)||f.push({custom_fee_id:s.id,discount:Math.min(_,a),is_exempt:!1}),y({...m,custom_fees:f})},className:"w-full px-2 py-1 border rounded text-sm",placeholder:"0"})]}),e.jsxs("div",{className:"flex justify-between text-xs font-semibold pt-1 border-t mt-1",children:[e.jsx("span",{children:"Final Amount:"}),e.jsxs("span",{className:"text-green-600",children:["₹",l.toFixed(2),"/",s.fee_cycle||"monthly"]})]})]}),t.is_exempt&&e.jsx("div",{className:"text-xs text-red-600 font-semibold pt-1",children:"Student is exempt from this fee"})]},s.id)})})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Select a class to configure fees"})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"text-lg font-semibold mb-3 text-gray-700",children:"Parent/Guardian Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Parent/Guardian Name *"}),e.jsx("input",{type:"text",required:!0,value:n.guardian_name,onChange:s=>p({...n,guardian_name:s.target.value}),className:"w-full px-3 py-2 border rounded-md",placeholder:"Full name of parent or guardian"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Parent/Guardian Phone Number *"}),e.jsx("input",{type:"tel",required:!0,value:n.guardian_phone,onChange:s=>p({...n,guardian_phone:s.target.value}),className:"w-full px-3 py-2 border rounded-md",placeholder:"Phone number"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Parent/Guardian Email"}),e.jsx("input",{type:"email",value:n.guardian_email,onChange:s=>p({...n,guardian_email:s.target.value}),className:"w-full px-3 py-2 border rounded-md",placeholder:"Email address (optional)"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Relationship"}),e.jsxs("select",{value:n.guardian_relationship,onChange:s=>p({...n,guardian_relationship:s.target.value}),className:"w-full px-3 py-2 border rounded-md",children:[e.jsx("option",{value:"parent",children:"Parent"}),e.jsx("option",{value:"guardian",children:"Guardian"}),e.jsx("option",{value:"relative",children:"Relative"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"submit",disabled:h.checking||h.available===!1,className:`flex-1 px-4 py-2 rounded-lg ${h.checking||h.available===!1?"bg-gray-400 cursor-not-allowed text-white":"bg-green-600 text-white hover:bg-green-700"}`,children:h.checking?"Checking...":"Add Student"}),e.jsx("button",{type:"button",onClick:()=>{H(!1),p({email:"",password:"",full_name:"",username:"",phone:"",roll_number:"",class_group_id:"",section_id:"",admission_date:"",gender:"",date_of_birth:"",home_address:"",guardian_name:"",guardian_phone:"",guardian_email:"",guardian_relationship:"parent"}),S({checking:!1,available:null,message:""}),F(null),y({class_fee_id:"",class_fee_discount:0,transport_enabled:!0,transport_route_id:"",transport_fee_discount:0,other_fees:[],custom_fees:[]})},className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})]})}),fe&&M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Promote Entire Class"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"This will move all active students from the current class to the target class."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Class"}),e.jsxs("select",{value:A.target_class_id,onChange:s=>B({...A,target_class_id:s.target.value}),className:"w-full px-3 py-2 border rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select Target Class"}),T.filter(s=>s.id!==M).map(s=>{const t=s.classifications&&s.classifications.length>0?` (${s.classifications.map(a=>`${a.type}: ${a.value}`).join(", ")})`:"";return e.jsxs("option",{value:s.id,children:[s.name,t]},s.id)})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:A.clear_sections,onChange:s=>B({...A,clear_sections:s.target.checked})}),e.jsx("span",{className:"text-sm",children:"Clear section assignments"})]})})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:Se,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700",children:"Promote Class"}),e.jsx("button",{onClick:()=>G(!1),className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})})]})}export{We as default};
