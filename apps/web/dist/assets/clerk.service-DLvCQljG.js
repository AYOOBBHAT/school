import{s as f,A as i}from"./index-CN_qW8X5.js";const y="",c={students:`${y}/students`,studentsAdmin:`${y}/students-admin`,classes:`${y}/classes`,clerkFees:`${y}/clerk-fees`,salary:`${y}/salary`};async function p(r){const t=await fetch(`${i}${c.students}`,{headers:{Authorization:`Bearer ${r}`}});if(!t.ok)throw new Error("Failed to load students");return await t.json()}async function $(r,t,e=1,o=50){var a,s;const d=new URLSearchParams;t&&d.append("class_group_id",t),d.append("page",e.toString()),d.append("limit",Math.min(o,100).toString());const u=`${i}${c.studentsAdmin}?${d.toString()}`;console.log("[clerk.service] Loading students from:",u);const n=await fetch(u,{headers:{Authorization:`Bearer ${r}`}});if(!n.ok){const m=await n.json().catch(()=>({error:`HTTP ${n.status}: ${n.statusText}`})),h=(m==null?void 0:m.error)||`Failed to load students (${n.status})`;throw console.error("[clerk.service] Failed to load students:",{url:u,status:n.status,statusText:n.statusText,error:h,classGroupId:t}),new Error(h)}const l=await n.json();return console.log("[clerk.service] Successfully loaded students:",{classesCount:((a=l.classes)==null?void 0:a.length)||0,unassignedCount:((s=l.unassigned)==null?void 0:s.length)||0,total_students:l.total_students,classGroupId:t}),l}async function g(r){const t=await fetch(`${i}${c.classes}`,{headers:{Authorization:`Bearer ${r}`}});if(!t.ok)throw new Error("Failed to load classes for fee collection");return await t.json()}async function S(r,t){const e=await fetch(`${i}${c.clerkFees}/student/${t}/fee-structure`,{headers:{Authorization:`Bearer ${r}`}});if(!e.ok){const o=await e.json().catch(()=>({}));if(o.error&&o.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(o.error||"Failed to load fee structure")}return await e.json()}async function _(r,t){const e=await fetch(`${i}${c.clerkFees}/student/${t}/payments`,{headers:{Authorization:`Bearer ${r}`}});return e.ok?await e.json():{payments:[]}}async function F(r,t,e){const o=await fetch(`${i}${c.salary}/history/${t}?${e.toString()}`,{headers:{Authorization:`Bearer ${r}`}});if(!o.ok){const d=await o.json().catch(()=>({}));throw new Error(d.error||"Failed to load payment history")}return await o.json()}async function k(r){var l;let t=[],e=[],o=[];try{const{data:a,error:s}=await f.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!s&&a&&(t=a)}catch(a){console.error("Error loading recent payments from Supabase:",a)}try{const a=new Date().toISOString().split("T")[0],{data:s,error:m}=await f.from("monthly_fee_payments").select("payment_amount").gte("payment_date",a);!m&&s&&(e=s)}catch(a){console.error("Error loading today payments from Supabase:",a)}try{const{data:a,error:s}=await f.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!s&&a&&(o=a)}catch(a){console.error("Error loading pending components from Supabase:",a)}const d=e.reduce((a,s)=>a+parseFloat(s.payment_amount||0),0),u=o.reduce((a,s)=>a+parseFloat(s.pending_amount||0),0);return{totalStudents:((l=(await p(r).catch(()=>({students:[]}))).students)==null?void 0:l.length)||0,todayCollection:d,totalPending:u,recentPayments:t}}async function j(r,t="last_12_months"){const e=await fetch(`${i}${c.salary}/unpaid?time_scope=${t}`,{headers:{Authorization:`Bearer ${r}`}});return e.ok?await e.json():{teachers:[]}}async function A(r){const t=await fetch(`${i}${c.salary}/summary`,{headers:{Authorization:`Bearer ${r}`}});if(!t.ok){const e=await t.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(e.error||"Failed to load salary summaries")}return await t.json()}async function E(r,t){const e=await fetch(`${i}${c.salary}/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(t)});if(!e.ok){const o=await e.json();throw new Error(o.error||"Failed to record payment")}return await e.json()}export{c as R,g as a,S as b,_ as c,$ as d,j as e,A as f,F as g,k as l,E as r};
