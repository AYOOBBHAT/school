const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AttendanceView-Cv4iaKxn.js","assets/index-CvzWxVsV.js","assets/index-K4J_ZkV3.css","assets/auth.service-CL5ZGV46.js","assets/MarksEntryView-DcTWe-UE.js","assets/SalaryView-DpGiG0fO.js","assets/TeacherPaymentHistory-D6NWYJiF.js","assets/clerk.service-aRqn5QlN.js","assets/StudentFeeStatusView-DCJ-xKM5.js"])))=>i.map(i=>d[i]);
import{u as v,r as d,s as _,j as e,A as g,_ as b}from"./index-CvzWxVsV.js";import{g as k,L as j}from"./auth.service-CL5ZGV46.js";function E(){const a=v(),[t,s]=d.useState(!0),[r,l]=d.useState(null),[i,o]=d.useState(null),n=d.useRef(!0);return d.useEffect(()=>(n.current=!0,(async()=>{var h,p;try{const x=(h=(await _.auth.getSession()).data.session)==null?void 0:h.access_token;if(!x){n.current&&a("/login");return}const m=await k(x),f=(p=m.profile)==null?void 0:p.role;if(f!=="teacher"){console.warn("[useTeacherAuth] Unauthorized access attempt by role:",f);const y={principal:"/principal/dashboard",clerk:"/clerk",student:"/student/home",parent:"/parent/home"}[f]||"/login";n.current&&a(y,{replace:!0});return}n.current&&(l(f),o(m.profile))}catch(c){console.error("[useTeacherAuth] Error verifying role:",c),n.current&&a("/login");return}finally{n.current&&s(!1)}})(),()=>{n.current=!1}),[a]),{loading:t,role:r,profile:i}}function N({currentView:a,setCurrentView:t,profile:s,onLogout:r}){return e.jsx("div",{className:"w-64 bg-gray-900 text-white min-h-screen fixed left-0 top-0",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8",children:"JhelumVerse"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Logged in as"}),e.jsx("div",{className:"font-semibold",children:(s==null?void 0:s.full_name)||"Teacher"}),e.jsx("div",{className:"text-sm text-gray-400",children:s==null?void 0:s.email})]}),e.jsxs("nav",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>t("classes"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="classes"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“š My Classes"}),e.jsx("button",{onClick:()=>t("attendance"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="attendance"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“… Attendance"}),e.jsx("button",{onClick:()=>t("marks"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="marks"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“Š Marks Entry"}),e.jsx("button",{onClick:()=>t("salary"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="salary"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ’° My Salary"}),!1]}),e.jsx("button",{onClick:r,className:"mt-8 w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 transition",children:"ðŸšª Logout"})]})})}async function $(a,t){const s=await fetch(`${g}/teacher-assignments/teacher/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok)throw new Error("Failed to load assignments");return await s.json()}async function B(a){const t=await fetch(`${g}/exams`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load exams");return(await t.json()).exams||[]}async function C(a,t){const s=await fetch(`${g}/teacher-assignments/teacher/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok)throw new Error("Failed to load classes");const l=(await s.json()).assignments||[],i=new Map;return l.forEach(o=>{i.has(o.class_group_id)||i.set(o.class_group_id,{id:o.class_group_id,name:o.class_groups.name})}),Array.from(i.values())}async function D(a,t,s){if(!s)return[];const r=await fetch(`${g}/teacher-assignments/teacher/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Failed to load subjects");const i=(await r.json()).assignments||[],o=new Map;return i.filter(n=>n.class_group_id===s).forEach(n=>{o.has(n.subject_id)||o.set(n.subject_id,{id:n.subject_id,name:n.subjects.name,code:n.subjects.code})}),Array.from(o.values())}async function V(a,t){if(!t)return[];const s=new URLSearchParams({class_group_id:t}),r=await fetch(`${g}/students-admin?${s.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Failed to load students");const l=await r.json(),i=[];return l.classes&&l.classes.forEach(o=>{if(o.id===t){const n={};o.sections&&o.sections.forEach(u=>{n[u.id]=u.name}),o.students.forEach(u=>{i.push({...u,section_name:u.section_id&&n[u.section_id]||null})})}}),i}async function A(a,t,s){const r=new URLSearchParams({class_group_id:t});s&&r.append("section_id",s);const l=await fetch(`${g}/students-admin?${r.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!l.ok)throw new Error("Failed to load students");const i=await l.json(),o=[];return i.classes&&i.classes.forEach(n=>{if(n.id===t){const u={};n.sections&&n.sections.forEach(h=>{u[h.id]=h.name}),n.students.forEach(h=>{(!s||h.section_id===s)&&o.push({...h,section_name:h.section_id&&u[h.section_id]||null})})}}),o}async function U(a,t){const s=await fetch(`${g}/marks/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({marks:t})});if(!s.ok){const r=await s.json();throw new Error(r.error||"Failed to save marks")}}async function q(a,t){const[s,r]=await Promise.all([fetch(`${g}/salary/structure/${t}`,{headers:{Authorization:`Bearer ${a}`}}),fetch(`${g}/salary/records`,{headers:{Authorization:`Bearer ${a}`}})]);let l=null,i=[];return s.ok&&(l=(await s.json()).structure),r.ok&&(i=(await r.json()).records||[]),{structure:l,records:i}}function L({currentView:a}){const[t,s]=d.useState([]),[r,l]=d.useState(null),[i,o]=d.useState([]),[n,u]=d.useState(!0);d.useEffect(()=>{h()},[a]);const h=async()=>{var c,x,m;try{u(!0);const f=await _.auth.getSession(),w=(c=f.data.session)==null?void 0:c.access_token,y=(m=(x=f.data.session)==null?void 0:x.user)==null?void 0:m.id;if(!w||!y)return;const S=await $(w,y);s(S.assignments||[])}catch(f){console.error("Error loading assignments:",f),s([])}finally{u(!1)}},p=async c=>{var x;try{const m=(x=(await _.auth.getSession()).data.session)==null?void 0:x.access_token;if(!m)return;const f=await A(m,c.class_group_id,c.section_id||void 0);o(f),l(c)}catch(m){console.error("Error loading students:",m)}};return n?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"My Classes & Subjects"}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[e.jsx("div",{className:"text-gray-500 text-lg mb-2",children:"No classes assigned yet"}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Contact your principal to assign you to classes and subjects."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(c=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition cursor-pointer",onClick:()=>p(c),children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:c.class_groups.name}),c.sections&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Section: ",c.sections.name]}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:[c.subjects.name," ",c.subjects.code&&`(${c.subjects.code})`]}),c.class_groups.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:c.class_groups.description})]},c.id))})]})}const M=d.lazy(()=>b(()=>import("./AttendanceView-Cv4iaKxn.js"),__vite__mapDeps([0,1,2,3]))),z=d.lazy(()=>b(()=>import("./MarksEntryView-DcTWe-UE.js"),__vite__mapDeps([4,1,2,3]))),R=d.lazy(()=>b(()=>import("./SalaryView-DpGiG0fO.js"),__vite__mapDeps([5,1,2,6,7,3]))),T=d.lazy(()=>b(()=>import("./StudentFeeStatusView-DCJ-xKM5.js"),__vite__mapDeps([8,1,2])));function F(){const a=v(),{profile:t,loading:s}=E(),[r,l]=d.useState("classes"),i=async()=>{await _.auth.signOut(),a("/login")};return s?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-xl",children:"Loading..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(N,{currentView:r,setCurrentView:l,profile:t,onLogout:i}),e.jsx("div",{className:"ml-64",children:e.jsxs("div",{className:"p-6",children:[r==="classes"&&e.jsx(L,{currentView:r}),r==="attendance"&&e.jsx(j,{children:e.jsx(M,{profile:t})}),r==="marks"&&e.jsx(j,{children:e.jsx(z,{profile:t})}),r==="salary"&&e.jsx(j,{children:e.jsx(R,{profile:t})}),r==="fees"&&e.jsx(j,{children:e.jsx(T,{students:[],studentFeeStatus:{},loadingFees:!1})})]})})]})}const I=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{I as T,B as a,C as b,D as c,V as d,q as e,A as l,U as s};
