import{r,s as n,j as e}from"./index-COKSofT7.js";import{t as M,v as _,M as L,N as z,O as B,P,Q as R,R as Y}from"./PrincipalDashboard-Bjh_1P84.js";import"./auth.service-DWxzfbKx.js";import"./UnpaidFeeAnalytics-DQu6H-W3.js";import"./clerk.service-B_a4VSiT.js";function K(){var N,w,C;const[o,S]=r.useState([]),[k,x]=r.useState(!0),[b,d]=r.useState(null),[T,u]=r.useState(!1),[G,h]=r.useState(!1),[i,g]=r.useState(null),[f,y]=r.useState({name:""}),[j,v]=r.useState({value:""}),[c,V]=r.useState({});r.useEffect(()=>{m()},[]);const m=async()=>{var s;try{d(null),x(!0);const a=(s=(await n.auth.getSession()).data.session)==null?void 0:s.access_token;if(!a){d("No authentication token found. Please log in again."),x(!1);return}const t=await M(a);S(t.types||[]);for(const l of t.types||[])p(l.id)}catch(a){console.error("Error loading types:",a),d(a.message||"Failed to load classification types. Please try again.")}finally{x(!1)}},p=async s=>{var a;try{const t=(a=(await n.auth.getSession()).data.session)==null?void 0:a.access_token;if(!t)return;const l=await _(t,s);V(D=>({...D,[s]:l.values||[]}))}catch(t){console.error("Error loading values:",t)}},E=async s=>{var a;s.preventDefault();try{const t=(a=(await n.auth.getSession()).data.session)==null?void 0:a.access_token;if(!t)return;await B(t,{name:f.name}),y({name:""}),u(!1),m()}catch(t){alert(t.message||"Failed to create classification type")}},F=async s=>{var a;if(s.preventDefault(),!!i)try{const t=(a=(await n.auth.getSession()).data.session)==null?void 0:a.access_token;if(!t)return;await P(t,{classification_type_id:i,value:j.value}),v({value:""}),h(!1),g(null),p(i)}catch(t){alert(t.message||"Failed to create classification value")}},A=async s=>{var a;if(confirm("Are you sure you want to delete this classification type? All values will be deleted."))try{const t=(a=(await n.auth.getSession()).data.session)==null?void 0:a.access_token;if(!t)return;await R(t,s),m()}catch(t){alert(t.message||"Failed to delete classification type")}},H=async(s,a)=>{var t;if(confirm("Are you sure you want to delete this value?"))try{const l=(t=(await n.auth.getSession()).data.session)==null?void 0:t.access_token;if(!l)return;await Y(l,s),p(a)}catch(l){alert(l.message||"Failed to delete classification value")}};return k?e.jsx("div",{className:"p-6",children:"Loading classifications..."}):b?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-600 text-xl mr-2",children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-red-800 font-semibold",children:"Error Loading Classifications"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:b})]})]}),e.jsx("button",{onClick:()=>{d(null),m()},className:"mt-3 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Retry"})]})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Dynamic Class Classifications"}),e.jsx("p",{className:"text-gray-600 mb-3",children:"Create custom classification types to organize your classes. Each school can define their own structure."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ Examples:"}),e.jsxs("ul",{className:"text-sm text-blue-800 space-y-1 list-disc list-inside",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Gender-based:"}),' Create type "Gender" with values "Boys", "Girls" â†’ Classes: "Grade 9 â€“ Boys", "Grade 9 â€“ Girls"']}),e.jsxs("li",{children:[e.jsx("strong",{children:"House system:"}),' Create type "House" with values "Blue House", "Red House", "Green House"']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Section-based:"}),' Create type "Section" with values "A", "B", "C"']}),e.jsxs("li",{children:[e.jsx("strong",{children:"Custom:"}),' Create type "Level" with values "Junior Group", "Senior Group"']})]})]})]}),e.jsx("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 shadow-md",children:"+ Add Classification Type"})]}),e.jsxs("div",{className:"space-y-6",children:[o.map(s=>{var a,t;return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[((a=c[s.id])==null?void 0:a.length)||0," value",(((t=c[s.id])==null?void 0:t.length)||0)!==1?"s":""," defined"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{g(s.id),h(!0)},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm font-medium shadow-sm",children:"+ Add Value"}),e.jsx("button",{onClick:()=>A(s.id),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm font-medium shadow-sm",children:"Delete Type"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(c[s.id]||[]).map(l=>e.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg px-4 py-2 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900",children:l.value}),e.jsx("button",{onClick:()=>H(l.id,s.id),className:"text-red-600 hover:text-red-800 hover:bg-red-50 rounded-full w-5 h-5 flex items-center justify-center text-sm font-bold transition-colors",title:"Delete value",children:"Ã—"})]},l.id)),(!c[s.id]||c[s.id].length===0)&&e.jsx("div",{className:"w-full text-center py-4",children:e.jsx("span",{className:"text-gray-400 text-sm italic",children:'No values yet. Click "+ Add Value" to create one.'})})]})]},s.id)}),o.length===0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ·ï¸"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No Classification Types Yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first classification type to start organizing your classes."}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:'For example: "Grade", "Section", "House", "Gender", or any custom category your school uses.'}),e.jsx("button",{onClick:()=>u(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 font-medium shadow-md",children:"Create Your First Classification Type"})]})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-96",children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Create Classification Type"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:'Define a category for classifying your classes (e.g., "Grade", "Section", "House", "Gender")'}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Type Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:f.name,onChange:s=>y({name:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Grade, Section, House, Gender, Stream",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Examples: Grade, Section, House, Gender, Stream, Level, Group"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Create"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),G&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-96 max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-xl font-bold mb-2",children:["Add Value to ",(N=o.find(s=>s.id===i))==null?void 0:N.name]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add a specific value for this classification type. You can add multiple values."}),e.jsxs("form",{onSubmit:F,children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Value ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:j.value,onChange:s=>v({value:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:L(((w=o.find(s=>s.id===i))==null?void 0:w.name)||""),required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:z(((C=o.find(s=>s.id===i))==null?void 0:C.name)||"")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Add"}),e.jsx("button",{type:"button",onClick:()=>{h(!1),g(null)},className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})})]})}export{K as default};
