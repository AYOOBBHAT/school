import{s as l,A as s}from"./index-DetD3wdn.js";const c="",i={students:`${c}/students`,studentsAdmin:`${c}/students-admin`,classes:`${c}/classes`,clerkFees:`${c}/clerk-fees`,salary:`${c}/salary`};async function m(a){const e=await fetch(`${s}${i.students}`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load students");return await e.json()}async function w(a,e){let t=`${s}${i.studentsAdmin}`;e&&(t+=`?class_group_id=${e}`);const r=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Failed to load students for fee collection");return await r.json()}async function $(a){const e=await fetch(`${s}${i.classes}`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load classes for fee collection");return await e.json()}async function _(a,e){const t=await fetch(`${s}${i.clerkFees}/student/${e}/fee-structure`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const r=await t.json().catch(()=>({}));if(r.error&&r.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(r.error||"Failed to load fee structure")}return await t.json()}async function g(a,e){const t=await fetch(`${s}${i.clerkFees}/student/${e}/payments`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{payments:[]}}async function S(a,e){const t=await fetch(`${s}${i.clerkFees}/collect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to collect fee")}return await t.json()}async function F(a,e,t){const r=await fetch(`${s}${i.salary}/history/${e}?${t.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok){const d=await r.json().catch(()=>({}));throw new Error(d.error||"Failed to load payment history")}return await r.json()}async function j(a){var u;let e=[],t=[],r=[];try{const{data:o,error:n}=await l.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!n&&o&&(e=o)}catch(o){console.error("Error loading recent payments from Supabase:",o)}try{const o=new Date().toISOString().split("T")[0],{data:n,error:f}=await l.from("monthly_fee_payments").select("payment_amount").gte("payment_date",o);!f&&n&&(t=n)}catch(o){console.error("Error loading today payments from Supabase:",o)}try{const{data:o,error:n}=await l.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!n&&o&&(r=o)}catch(o){console.error("Error loading pending components from Supabase:",o)}const d=t.reduce((o,n)=>o+parseFloat(n.payment_amount||0),0),y=r.reduce((o,n)=>o+parseFloat(n.pending_amount||0),0);return{totalStudents:((u=(await m(a).catch(()=>({students:[]}))).students)==null?void 0:u.length)||0,todayCollection:d,totalPending:y,recentPayments:e}}async function A(a,e="last_12_months"){const t=await fetch(`${s}${i.salary}/unpaid?time_scope=${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{teachers:[]}}async function k(a){const e=await fetch(`${s}${i.salary}/summary`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(t.error||"Failed to load salary summaries")}return await e.json()}async function E(a,e){const t=await fetch(`${s}${i.salary}/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to record payment")}return await t.json()}export{i as R,$ as a,w as b,g as c,S as d,_ as e,A as f,k as g,F as h,j as l,E as r};
