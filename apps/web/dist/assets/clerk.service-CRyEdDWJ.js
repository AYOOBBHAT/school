import{s as l,A as o}from"./index-vhIfXfhd.js";async function y(e){const a=await fetch(`${o}/students`,{headers:{Authorization:`Bearer ${e}`}});return a.ok?await a.json():{students:[]}}async function m(e,a){let t=`${o}/students-admin`;a&&(t+=`?class_group_id=${a}`);const r=await fetch(t,{headers:{Authorization:`Bearer ${e}`}});return r.ok?await r.json():{classes:[],unassigned:[]}}async function h(e){const a=await fetch(`${o}/classes`,{headers:{Authorization:`Bearer ${e}`}});return a.ok?await a.json():{classes:[]}}async function w(e,a){const t=await fetch(`${o}/clerk-fees/student/${a}/fee-structure`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){const r=await t.json().catch(()=>({}));if(r.error&&r.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(r.error||"Failed to load fee structure")}return await t.json()}async function g(e,a){const t=await fetch(`${o}/clerk-fees/student/${a}/payments`,{headers:{Authorization:`Bearer ${e}`}});return t.ok?await t.json():{payments:[]}}async function _(e,a){const t=await fetch(`${o}/clerk-fees/collect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(a)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to collect fee")}return await t.json()}async function $(e,a){var c,d;const t=await fetch(`${o}/clerk-fees/analytics/unpaid?${a.toString()}`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return{summary:{total_students:0,unpaid_count:0,partially_paid_count:0,paid_count:0,total_unpaid_amount:0},chart_data:{paid:0,unpaid:0,partially_paid:0},students:[],pagination:{page:1,limit:10,total:0,total_pages:1}};const r=await t.json(),i=r.analytics||r;return i.pagination||(i.pagination={page:1,limit:((c=i.students)==null?void 0:c.length)||10,total:((d=i.students)==null?void 0:d.length)||0,total_pages:1}),i}async function S(e,a,t){const r=await fetch(`${o}/salary/history/${a}?${t.toString()}`,{headers:{Authorization:`Bearer ${e}`}});if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.error||"Failed to load payment history")}return await r.json()}async function j(e){var u;let a=[],t=[],r=[];try{const{data:n,error:s}=await l.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!s&&n&&(a=n)}catch(n){console.error("Error loading recent payments from Supabase:",n)}try{const n=new Date().toISOString().split("T")[0],{data:s,error:p}=await l.from("monthly_fee_payments").select("payment_amount").gte("payment_date",n);!p&&s&&(t=s)}catch(n){console.error("Error loading today payments from Supabase:",n)}try{const{data:n,error:s}=await l.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!s&&n&&(r=n)}catch(n){console.error("Error loading pending components from Supabase:",n)}const i=t.reduce((n,s)=>n+parseFloat(s.payment_amount||0),0),c=r.reduce((n,s)=>n+parseFloat(s.pending_amount||0),0);return{totalStudents:((u=(await y(e).catch(()=>({students:[]}))).students)==null?void 0:u.length)||0,todayCollection:i,totalPending:c,recentPayments:a}}async function k(e,a="last_12_months"){const t=await fetch(`${o}/salary/unpaid?time_scope=${a}`,{headers:{Authorization:`Bearer ${e}`}});return t.ok?await t.json():{teachers:[]}}async function F(e){const a=await fetch(`${o}/salary/summary`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){const t=await a.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(t.error||"Failed to load salary summaries")}return await a.json()}async function A(e,a){const t=await fetch(`${o}/salary/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(a)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to record payment")}return await t.json()}export{h as a,$ as b,m as c,g as d,_ as e,w as f,k as g,F as h,S as i,j as l,A as r};
