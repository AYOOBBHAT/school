import{r as o,j as s,s as g}from"./index-DetD3wdn.js";import{a as A,b as I,c as O,d as M,s as $}from"./TeacherDashboard-BZTtsXbU.js";import"./auth.service-DRVvgeqx.js";function B({profile:D}){var _,E,C;const[f,F]=o.useState([]),[k,P]=o.useState([]),[v,N]=o.useState([]),[u,S]=o.useState(""),[l,j]=o.useState(""),[c,b]=o.useState(""),[w,h]=o.useState([]),[i,m]=o.useState({});o.useEffect(()=>{(async()=>{var a,d,p;const n=await g.auth.getSession(),t=(a=n.data.session)==null?void 0:a.access_token,r=(p=(d=n.data.session)==null?void 0:d.user)==null?void 0:p.id;if(!(!t||!r))try{const[x,y]=await Promise.all([A(t),I(t,r)]);F(x),P(y)}catch(x){console.error("Error loading data:",x)}})()},[]),o.useEffect(()=>{(async()=>{var a,d,p;if(!l){N([]),h([]);return}const n=await g.auth.getSession(),t=(a=n.data.session)==null?void 0:a.access_token,r=(p=(d=n.data.session)==null?void 0:d.user)==null?void 0:p.id;if(!(!t||!r))try{const[x,y]=await Promise.all([O(t,r,l),M(t,l)]);N(x),h(y)}catch(x){console.error("Error loading data:",x)}})()},[l]),o.useEffect(()=>{(async()=>{var r;if(!l||!c)return;const t=(r=(await g.auth.getSession()).data.session)==null?void 0:r.access_token;if(t)try{const a=await M(t,l);h(a)}catch(a){console.error("Error loading students:",a)}})()},[c,l]);const R=async()=>{var e;if(!u||!l||!c){alert("Please select Exam, Class, and Subject");return}try{const t=(e=(await g.auth.getSession()).data.session)==null?void 0:e.access_token;if(!t)throw new Error("No authentication token");const r=Object.entries(i).filter(([a,d])=>d.marks_obtained&&d.max_marks).map(([a,d])=>({student_id:a,exam_id:u,subject_id:c,marks_obtained:parseFloat(d.marks_obtained),max_marks:parseFloat(d.max_marks),school_id:D.school_id}));if(r.length===0)throw new Error("Please enter at least one mark");await $(t,r),alert("Marks saved successfully!"),m({})}catch(n){alert(n.message||"Failed to save marks")}};return s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Enter Marks"}),s.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Exam *"}),s.jsxs("select",{value:u,onChange:e=>{S(e.target.value),j(""),b(""),h([]),m({})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",children:[s.jsx("option",{value:"",children:"Select Exam"}),f.map(e=>s.jsxs("option",{value:e.id,children:[e.name," ",e.term&&`(${e.term})`]},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Class *"}),s.jsxs("select",{value:l,onChange:e=>{j(e.target.value),b(""),h([]),m({})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",disabled:!u,children:[s.jsx("option",{value:"",children:"Select Class"}),k.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Subject *"}),s.jsxs("select",{value:c,onChange:e=>{b(e.target.value),m({})},className:"w-full px-3 py-2 border border-gray-300 rounded-md",disabled:!l,children:[s.jsx("option",{value:"",children:"Select Subject"}),v.map(e=>s.jsxs("option",{value:e.id,children:[e.name," ",e.code&&`(${e.code})`]},e.id))]})]})]})}),u&&l&&c&&s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"text-xl font-bold mb-2",children:"Enter Marks for Students"}),s.jsxs("p",{className:"text-gray-600",children:[(_=f.find(e=>e.id===u))==null?void 0:_.name," - ",(E=k.find(e=>e.id===l))==null?void 0:E.name," - ",(C=v.find(e=>e.id===c))==null?void 0:C.name]})]}),w.length===0?s.jsx("div",{className:"text-center py-8 text-gray-500",children:"No students found in this class."}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Roll No."}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Marks Obtained"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Max Marks"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>{var n,t;return s.jsxs("tr",{children:[s.jsx("td",{className:"px-4 py-3 text-sm",children:e.roll_number||"N/A"}),s.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:e.profile.full_name}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"number",value:((n=i[e.id])==null?void 0:n.marks_obtained)||"",onChange:r=>{var a;m({...i,[e.id]:{...i[e.id],marks_obtained:r.target.value,max_marks:((a=i[e.id])==null?void 0:a.max_marks)||""}})},className:"w-24 px-2 py-1 border rounded-md text-sm",placeholder:"0"})}),s.jsx("td",{className:"px-4 py-3",children:s.jsx("input",{type:"number",value:((t=i[e.id])==null?void 0:t.max_marks)||"",onChange:r=>{var a;m({...i,[e.id]:{...i[e.id],marks_obtained:((a=i[e.id])==null?void 0:a.marks_obtained)||"",max_marks:r.target.value}})},className:"w-24 px-2 py-1 border rounded-md text-sm",placeholder:"100"})})]},e.id)})})]})}),s.jsxs("div",{className:"mt-4 flex gap-3",children:[s.jsx("button",{onClick:R,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700",children:"Submit Marks"}),s.jsx("button",{onClick:()=>{S(""),j(""),b(""),h([]),m({})},className:"bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400",children:"Reset"})]})]})]})]})}export{B as default};
