const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AttendanceView-C_e7Io39.js","assets/vendor-react-Bn_hPIu6.js","assets/vendor-BYMAk37H.js","assets/index-HwjJ9f0_.js","assets/index-8NdQwjMH.css","assets/auth.service-DQRw-RIO.js","assets/MarksEntryView-DQzALXib.js","assets/SalaryView-B2GpzRyJ.js","assets/TeacherPaymentHistory-CporMiu2.js","assets/clerk.service-CDmFEBNd.js","assets/StudentFeeStatusView-BNsV5UBO.js"])))=>i.map(i=>d[i]);
import{s as _,A as x,_ as b}from"./index-HwjJ9f0_.js";import{u as N,r as h,j as e,N as y,R as E,a as j,e as $}from"./vendor-react-Bn_hPIu6.js";import{g as A,L as w}from"./auth.service-DQRw-RIO.js";function R(){const t=N(),[a,s]=h.useState(!0),[o,l]=h.useState(null),[c,n]=h.useState(null),r=h.useRef(!0);return h.useEffect(()=>(r.current=!0,(async()=>{var d,i;try{const m=(d=(await _.auth.getSession()).data.session)==null?void 0:d.access_token;if(!m){r.current&&t("/login");return}const f=await A(m),p=(i=f.profile)==null?void 0:i.role;if(p!=="teacher"){console.warn("[useTeacherAuth] Unauthorized access attempt by role:",p);const k={principal:"/principal/dashboard",clerk:"/clerk",student:"/student/home",parent:"/parent/home"}[p]||"/login";r.current&&t(k,{replace:!0});return}r.current&&(l(p),n(f.profile))}catch(g){console.error("[useTeacherAuth] Error verifying role:",g),r.current&&t("/login");return}finally{r.current&&s(!1)}})(),()=>{r.current=!1}),[t]),{loading:a,role:o,profile:c}}function L({profile:t,onLogout:a}){return e.jsx("div",{className:"w-64 bg-gray-900 text-white min-h-screen fixed left-0 top-0",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8",children:"JhelumVerse"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Logged in as"}),e.jsx("div",{className:"font-semibold",children:(t==null?void 0:t.full_name)||"Teacher"}),e.jsx("div",{className:"text-sm text-gray-400",children:t==null?void 0:t.email})]}),e.jsxs("nav",{className:"space-y-2",children:[e.jsx(y,{to:"/teacher/classes",className:({isActive:s})=>`w-full text-left px-4 py-2 rounded-lg transition block ${s?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“š My Classes"}),e.jsx(y,{to:"/teacher/attendance",className:({isActive:s})=>`w-full text-left px-4 py-2 rounded-lg transition block ${s?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“… Attendance"}),e.jsx(y,{to:"/teacher/marks",className:({isActive:s})=>`w-full text-left px-4 py-2 rounded-lg transition block ${s?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“Š Marks Entry"}),e.jsx(y,{to:"/teacher/salary",className:({isActive:s})=>`w-full text-left px-4 py-2 rounded-lg transition block ${s?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ’° My Salary"}),!1]}),e.jsx("button",{onClick:a,className:"mt-8 w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 transition",children:"ðŸšª Logout"})]})})}async function M(t,a){const s=await fetch(`${x}/teacher-assignments/teacher/${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Failed to load assignments");return await s.json()}async function q(t){const a=await fetch(`${x}/exams`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Failed to load exams");return(await a.json()).exams||[]}async function I(t,a){const s=await fetch(`${x}/teacher-assignments/teacher/${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Failed to load classes");const l=(await s.json()).assignments||[],c=new Map;return l.forEach(n=>{c.has(n.class_group_id)||c.set(n.class_group_id,{id:n.class_group_id,name:n.class_groups.name})}),Array.from(c.values())}async function J(t,a,s){if(!s)return[];const o=await fetch(`${x}/teacher-assignments/teacher/${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!o.ok)throw new Error("Failed to load subjects");const c=(await o.json()).assignments||[],n=new Map;return c.filter(r=>r.class_group_id===s).forEach(r=>{n.has(r.subject_id)||n.set(r.subject_id,{id:r.subject_id,name:r.subjects.name,code:r.subjects.code})}),Array.from(n.values())}async function W(t,a){if(!a)return[];const s=new URLSearchParams({class_group_id:a}),o=await fetch(`${x}/students-admin?${s.toString()}`,{headers:{Authorization:`Bearer ${t}`}});if(!o.ok)throw new Error("Failed to load students");const l=await o.json(),c=[];return l.classes&&l.classes.forEach(n=>{if(n.id===a){const r={};n.sections&&n.sections.forEach(u=>{r[u.id]=u.name}),n.students.forEach(u=>{c.push({...u,section_name:u.section_id&&r[u.section_id]||null})})}}),c}async function F(t,a,s){const o=new URLSearchParams({class_group_id:a});s&&o.append("section_id",s);const l=await fetch(`${x}/students-admin?${o.toString()}`,{headers:{Authorization:`Bearer ${t}`}});if(!l.ok)throw new Error("Failed to load students");const c=await l.json(),n=[];return c.classes&&c.classes.forEach(r=>{if(r.id===a){const u={};r.sections&&r.sections.forEach(d=>{u[d.id]=d.name}),r.students.forEach(d=>{(!s||d.section_id===s)&&n.push({id:d.id,roll_number:d.roll_number,section_id:d.section_id,section_name:d.section_id&&u[d.section_id]||null,profile:d.profile})})}}),n}async function H(t,a){const s=await fetch(`${x}/marks/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({marks:a})});if(!s.ok){const o=await s.json();throw new Error(o.error||"Failed to save marks")}}async function K(t,a){const[s,o]=await Promise.all([fetch(`${x}/salary/structure/${a}`,{headers:{Authorization:`Bearer ${t}`}}),fetch(`${x}/salary/records`,{headers:{Authorization:`Bearer ${t}`}})]);let l=null,c=[];return s.ok&&(l=(await s.json()).structure),o.ok&&(c=(await o.json()).records||[]),{structure:l,records:c}}function T(){const[t,a]=h.useState([]),[s,o]=h.useState(null),[l,c]=h.useState([]),[n,r]=h.useState(!0);h.useEffect(()=>{u()},[]);const u=async()=>{var i,g,m;try{r(!0);const f=await _.auth.getSession(),p=(i=f.data.session)==null?void 0:i.access_token,S=(m=(g=f.data.session)==null?void 0:g.user)==null?void 0:m.id;if(!p||!S)return;const k=await M(p,S);a(k.assignments||[])}catch(f){console.error("Error loading assignments:",f),a([])}finally{r(!1)}},d=async i=>{var g;try{const m=(g=(await _.auth.getSession()).data.session)==null?void 0:g.access_token;if(!m)return;const f=await F(m,i.class_group_id,i.section_id||void 0);c(f),o(i)}catch(m){console.error("Error loading students:",m)}};return n?e.jsx("div",{className:"text-center py-8",children:"Loading..."}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"My Classes & Subjects"}),t.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[e.jsx("div",{className:"text-gray-500 text-lg mb-2",children:"No classes assigned yet"}),e.jsx("div",{className:"text-gray-400 text-sm",children:"Contact your principal to assign you to classes and subjects."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(i=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition cursor-pointer",onClick:()=>d(i),children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:i.class_groups.name}),i.sections&&e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Section: ",i.sections.name]}),e.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:[i.subjects.name," ",i.subjects.code&&`(${i.subjects.code})`]}),i.class_groups.description&&e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:i.class_groups.description})]},i.id))})]})}const v=(t,a=3)=>h.lazy(async()=>{for(let s=0;s<a;s++)try{return await t()}catch(o){if(s===a-1)throw console.error("Failed to load component after retries:",o),o;await new Promise(l=>setTimeout(l,1e3*(s+1)))}throw new Error("Failed to load component")}),P=v(()=>b(()=>import("./AttendanceView-C_e7Io39.js"),__vite__mapDeps([0,1,2,3,4,5]))),z=v(()=>b(()=>import("./MarksEntryView-DQzALXib.js"),__vite__mapDeps([6,1,2,3,4,5]))),O=v(()=>b(()=>import("./SalaryView-B2GpzRyJ.js"),__vite__mapDeps([7,1,2,3,4,8,9,5]))),B=v(()=>b(()=>import("./StudentFeeStatusView-BNsV5UBO.js"),__vite__mapDeps([10,1,2])));function V(){const t=N(),{profile:a,loading:s}=R(),o=async()=>{await _.auth.signOut(),t("/login")};return s?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-xl",children:"Loading..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(L,{profile:a,onLogout:o}),e.jsx("div",{className:"ml-64",children:e.jsx("div",{className:"p-6",children:e.jsxs(E,{children:[e.jsx(j,{path:"classes",element:e.jsx(T,{})}),e.jsx(j,{path:"attendance",element:e.jsx(w,{children:e.jsx(P,{profile:a})})}),e.jsx(j,{path:"marks",element:e.jsx(w,{children:e.jsx(z,{profile:a})})}),e.jsx(j,{path:"salary",element:e.jsx(w,{children:e.jsx(O,{profile:a})})}),e.jsx(j,{path:"fees",element:e.jsx(w,{children:e.jsx(B,{students:[],studentFeeStatus:{},loadingFees:!1})})}),e.jsx(j,{path:"*",element:e.jsx($,{to:"classes",replace:!0})})]})})})]})}const Q=Object.freeze(Object.defineProperty({__proto__:null,default:V},Symbol.toStringTag,{value:"Module"}));export{Q as T,q as a,I as b,J as c,W as d,K as e,F as l,H as s};
