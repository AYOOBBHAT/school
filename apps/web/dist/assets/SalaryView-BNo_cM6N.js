import{r as n,s as v,j as e}from"./index-BsIG4eoL.js";import{T as w}from"./TeacherPaymentHistory-DNo2AEMH.js";import{e as f}from"./TeacherDashboard-CcXUTczg.js";import"./clerk.service-NPHe08Ze.js";import"./auth.service-CPocT0BX.js";function $({profile:l}){const[a,m]=n.useState(null),[d,h]=n.useState([]),[y,r]=n.useState(!1),[u,o]=n.useState(!1);n.useEffect(()=>{g()},[]);const g=async()=>{var t,s,c;r(!0);try{const i=await v.auth.getSession(),x=(t=i.data.session)==null?void 0:t.access_token,p=(c=(s=i.data.session)==null?void 0:s.user)==null?void 0:c.id;if(!x||!p)return;const{structure:j,records:b}=await f(x,p);m(j),h(b)}catch(i){console.error("Error loading salary data:",i)}finally{r(!1)}};return y?e.jsx("div",{className:"text-center py-8",children:"Loading salary information..."}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"My Salary"}),e.jsxs("button",{onClick:()=>o(!0),className:"bg-emerald-600 text-white px-4 py-2 rounded-lg hover:bg-emerald-700 transition flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’°"}),e.jsx("span",{children:"View Payment History"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Salary Structure"}),a?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Base Salary"}),e.jsxs("div",{className:"text-lg font-semibold",children:["â‚¹",parseFloat(a.base_salary||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"HRA (House Rent Allowance)"}),e.jsxs("div",{className:"text-lg font-semibold",children:["â‚¹",parseFloat(a.hra||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Other Allowances"}),e.jsxs("div",{className:"text-lg font-semibold",children:["â‚¹",parseFloat(a.other_allowances||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Fixed Deductions"}),e.jsxs("div",{className:"text-lg font-semibold text-red-600",children:["â‚¹",parseFloat(a.fixed_deductions||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Salary Cycle"}),e.jsx("div",{className:"text-lg font-semibold capitalize",children:a.salary_cycle||"monthly"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Attendance-Based Deduction"}),e.jsx("div",{className:"text-lg font-semibold",children:a.attendance_based_deduction?"âœ… Enabled":"âŒ Disabled"})]}),e.jsxs("div",{className:"md:col-span-2 pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gross Salary (Base + HRA + Allowances)"}),e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["â‚¹",(a.base_salary+a.hra+a.other_allowances).toLocaleString()]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Salary structure not set yet. Please contact your principal."})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Salary History"}),d.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No salary records found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Month/Year"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Gross Salary"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Deductions"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Attendance Deduction"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Net Salary"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Payment Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.sort((t,s)=>t.year!==s.year?s.year-t.year:s.month-t.month).map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[new Date(2e3,t.month-1).toLocaleString("default",{month:"long"})," ",t.year]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:["â‚¹",t.gross_salary.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:["â‚¹",t.total_deductions.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-red-600",children:["â‚¹",t.attendance_deduction.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap font-semibold text-green-600",children:["â‚¹",t.net_salary.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.status==="pending"?"bg-yellow-100 text-yellow-800":t.status==="approved"?"bg-green-100 text-green-800":t.status==="rejected"?"bg-red-100 text-red-800":t.status==="paid"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.status==="pending"?"Pending Approval":t.status==="approved"?"Approved":t.status==="rejected"?"Rejected":t.status==="paid"?"Paid":t.status}),t.status==="rejected"&&t.rejection_reason&&e.jsxs("div",{className:"text-xs text-red-600 mt-1 max-w-xs",children:["Reason: ",t.rejection_reason]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.payment_date?e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:new Date(t.payment_date).toLocaleDateString()}),t.payment_mode&&e.jsx("div",{className:"text-xs text-gray-500 capitalize",children:t.payment_mode})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.status==="paid"&&e.jsx("button",{onClick:()=>{const s=window.open("","_blank");s&&(s.document.write(`
                                  <html>
                                    <head>
                                      <title>Salary Slip - ${new Date(2e3,t.month-1).toLocaleString("default",{month:"long"})} ${t.year}</title>
                                      <style>
                                        body { font-family: Arial, sans-serif; padding: 20px; }
                                        .header { text-align: center; margin-bottom: 30px; }
                                        .details { margin: 20px 0; }
                                        .row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
                                        .label { font-weight: bold; }
                                        .amount { text-align: right; }
                                        .total { font-size: 18px; font-weight: bold; margin-top: 20px; padding-top: 20px; border-top: 2px solid #333; }
                                      </style>
                                    </head>
                                    <body>
                                      <div class="header">
                                        <h1>Salary Slip</h1>
                                        <p>${new Date(2e3,t.month-1).toLocaleString("default",{month:"long"})} ${t.year}</p>
                                      </div>
                                      <div class="details">
                                        <div class="row">
                                          <span class="label">Employee:</span>
                                          <span>${(l==null?void 0:l.full_name)||"Teacher"}</span>
                                        </div>
                                        <div class="row">
                                          <span class="label">Gross Salary:</span>
                                          <span class="amount">â‚¹${parseFloat(t.gross_salary||0).toLocaleString()}</span>
                                        </div>
                                        <div class="row">
                                          <span class="label">Total Deductions:</span>
                                          <span class="amount">â‚¹${parseFloat(t.total_deductions||0).toLocaleString()}</span>
                                        </div>
                                        ${t.attendance_deduction>0?`
                                        <div class="row">
                                          <span class="label">Attendance Deduction:</span>
                                          <span class="amount">â‚¹${parseFloat(t.attendance_deduction||0).toLocaleString()}</span>
                                        </div>
                                        `:""}
                                        <div class="row total">
                                          <span>Net Salary:</span>
                                          <span class="amount">â‚¹${parseFloat(t.net_salary||0).toLocaleString()}</span>
                                        </div>
                                        ${t.payment_date?`
                                        <div class="row">
                                          <span class="label">Payment Date:</span>
                                          <span>${new Date(t.payment_date).toLocaleDateString()}</span>
                                        </div>
                                        <div class="row">
                                          <span class="label">Payment Mode:</span>
                                          <span>${(t.payment_mode||"").toUpperCase()}</span>
                                        </div>
                                        `:""}
                                      </div>
                                    </body>
                                  </html>
                                `),s.document.close())},className:"text-blue-600 hover:text-blue-900 font-medium text-sm",children:"View Slip"})})]},t.id))})]})})]}),d.some(t=>t.status==="paid")&&e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Note:"}),' Click "View Slip" on paid salaries to view your salary slip. You can print it from the browser.']})}),u&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(w,{teacherId:l.id,teacherName:l.full_name||void 0,onClose:()=>o(!1),showHeader:!0})})})]})}export{$ as default};
