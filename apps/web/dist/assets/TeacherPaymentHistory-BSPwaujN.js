import{r as a,s as q,j as e}from"./index-jNkMZTGm.js";import{i as z}from"./clerk.service-FPcaANOT.js";function $({teacherId:N,teacherName:v,onClose:w,showHeader:A=!0}){const[c,M]=a.useState([]),[s,E]=a.useState(null),[F,y]=a.useState(!0),[_,b]=a.useState(null),[x,k]=a.useState(""),[m,P]=a.useState(""),[p,S]=a.useState("all"),[u,C]=a.useState("all"),[n,r]=a.useState(1),[g,L]=a.useState(1),[R,B]=a.useState(0),H=20,l=a.useRef(!0),j=a.useCallback(async()=>{var t,T,D;try{if(!l.current)return;y(!0),b(null);const i=(t=(await q.auth.getSession()).data.session)==null?void 0:t.access_token;if(!i){if(!l.current)return;b("Authentication required"),y(!1);return}const o=new URLSearchParams({page:n.toString(),limit:H.toString()});x&&o.append("start_date",x),m&&o.append("end_date",m),p!=="all"&&o.append("payment_type",p),u!=="all"&&o.append("payment_mode",u);const h=await z(i,N,o);if(!l.current)return;M(h.payments||[]),E(h.summary||null),L(((T=h.pagination)==null?void 0:T.total_pages)||1),B(((D=h.pagination)==null?void 0:D.total)||0)}catch(i){if(!l.current)return;console.error("Error loading payment history:",i),b(i.message||"Failed to load payment history")}finally{l.current&&y(!1)}},[N,n,x,m,p,u]);a.useEffect(()=>(l.current=!0,j(),()=>{l.current=!1}),[j]);const d=t=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(t),f=t=>new Date(t).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}),I=t=>{switch(t){case"salary":return"bg-blue-100 text-blue-800";case"advance":return"bg-yellow-100 text-yellow-800";case"adjustment":return"bg-purple-100 text-purple-800";case"bonus":return"bg-green-100 text-green-800";case"loan":return"bg-orange-100 text-orange-800";case"other":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},U=t=>{switch(t){case"bank":return"Bank Transfer";case"cash":return"Cash";case"upi":return"UPI";default:return t}},V=()=>{k(""),P(""),S("all"),C("all"),r(1)};return F&&c.length===0?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading payment history..."})]})}):_&&c.length===0?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx("p",{className:"text-red-800 font-semibold mb-2",children:"Error"}),e.jsx("p",{className:"text-red-600",children:_}),e.jsx("button",{onClick:j,className:"mt-4 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Retry"})]}):e.jsxs("div",{className:"space-y-6",children:[A&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Payment History",v&&e.jsxs("span",{className:"text-gray-600 font-normal",children:[" - ",v]})]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Complete salary and payment history"})]}),w&&e.jsx("button",{onClick:w,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"Ã—"})]}),s&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Total Paid"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:d(s.total_paid_till_date)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[s.total_payments," payments"]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Pending Amount"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:d(s.pending_amount)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Unpaid salaries"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Average Payment"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:d(s.average_payment)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Per payment"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Date Range"}),e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.date_range.first_payment_date?f(s.date_range.first_payment_date):"N/A"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["to ",s.date_range.last_payment_date?f(s.date_range.last_payment_date):"N/A"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4 border border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:x,onChange:t=>{k(t.target.value),r(1)},className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:m,onChange:t=>{P(t.target.value),r(1)},className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Type"}),e.jsxs("select",{value:p,onChange:t=>{S(t.target.value),r(1)},className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"salary",children:"Salary"}),e.jsx("option",{value:"advance",children:"Advance"}),e.jsx("option",{value:"adjustment",children:"Adjustment"}),e.jsx("option",{value:"bonus",children:"Bonus"}),e.jsx("option",{value:"loan",children:"Loan/Extra"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Payment Mode"}),e.jsxs("select",{value:u,onChange:t=>{C(t.target.value),r(1)},className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Modes"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:V,className:"w-full bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 text-sm font-medium",children:"Clear Filters"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Mode"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Paid By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Running Total"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Notes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-lg font-medium",children:"No payments found"}),e.jsx("p",{className:"text-sm mt-1",children:"Try adjusting your filters"})]})})}):c.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f(t.payment_date)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:t.salary_period_label||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-semibold text-green-600",children:d(t.amount)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${I(t.payment_type)}`,children:t.payment_type_label})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:U(t.payment_mode)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-600",children:t.paid_by_name||"System"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-blue-600",children:d(t.running_total)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",title:t.notes||"",children:t.notes||"-"})})]},t.id))})]})}),g>1&&e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing page ",n," of ",g," (",R," total payments)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r(t=>Math.max(1,t-1)),disabled:n===1,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>r(t=>Math.min(g,t+1)),disabled:n===g,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})]})}export{$ as T};
