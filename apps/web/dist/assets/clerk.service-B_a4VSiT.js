import{s as f,A as i}from"./index-COKSofT7.js";const u="",c={students:`${u}/students`,studentsAdmin:`${u}/students-admin`,classes:`${u}/classes`,clerkFees:`${u}/clerk-fees`,salary:`${u}/salary`};async function h(a){const e=await fetch(`${i}${c.students}`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load students");return await e.json()}async function w(a,e){var y,d;let t=`${i}${c.studentsAdmin}`;const o=new URLSearchParams;e&&o.append("class_group_id",e),o.append("page","1"),o.append("limit","100"),o.toString()&&(t+=`?${o.toString()}`),console.log("[clerk.service] Loading students from:",t);const n=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});if(!n.ok){const r=await n.json().catch(()=>({error:`HTTP ${n.status}: ${n.statusText}`})),s=(r==null?void 0:r.error)||`Failed to load students (${n.status})`;throw console.error("[clerk.service] Failed to load students:",{url:t,status:n.status,statusText:n.statusText,error:s,classGroupId:e}),new Error(s)}const l=await n.json();return console.log("[clerk.service] Successfully loaded students:",{classesCount:((y=l.classes)==null?void 0:y.length)||0,unassignedCount:((d=l.unassigned)==null?void 0:d.length)||0,total_students:l.total_students,classGroupId:e}),l}async function $(a){const e=await fetch(`${i}${c.classes}`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load classes for fee collection");return await e.json()}async function g(a,e){const t=await fetch(`${i}${c.clerkFees}/student/${e}/fee-structure`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const o=await t.json().catch(()=>({}));if(o.error&&o.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(o.error||"Failed to load fee structure")}return await t.json()}async function S(a,e){const t=await fetch(`${i}${c.clerkFees}/student/${e}/payments`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{payments:[]}}async function _(a,e){const t=await fetch(`${i}${c.clerkFees}/collect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const o=await t.json();throw new Error(o.error||"Failed to collect fee")}return await t.json()}async function F(a,e,t){const o=await fetch(`${i}${c.salary}/history/${e}?${t.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!o.ok){const n=await o.json().catch(()=>({}));throw new Error(n.error||"Failed to load payment history")}return await o.json()}async function j(a){var d;let e=[],t=[],o=[];try{const{data:r,error:s}=await f.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!s&&r&&(e=r)}catch(r){console.error("Error loading recent payments from Supabase:",r)}try{const r=new Date().toISOString().split("T")[0],{data:s,error:m}=await f.from("monthly_fee_payments").select("payment_amount").gte("payment_date",r);!m&&s&&(t=s)}catch(r){console.error("Error loading today payments from Supabase:",r)}try{const{data:r,error:s}=await f.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!s&&r&&(o=r)}catch(r){console.error("Error loading pending components from Supabase:",r)}const n=t.reduce((r,s)=>r+parseFloat(s.payment_amount||0),0),l=o.reduce((r,s)=>r+parseFloat(s.pending_amount||0),0);return{totalStudents:((d=(await h(a).catch(()=>({students:[]}))).students)==null?void 0:d.length)||0,todayCollection:n,totalPending:l,recentPayments:e}}async function k(a,e="last_12_months"){const t=await fetch(`${i}${c.salary}/unpaid?time_scope=${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{teachers:[]}}async function A(a){const e=await fetch(`${i}${c.salary}/summary`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(t.error||"Failed to load salary summaries")}return await e.json()}async function E(a,e){const t=await fetch(`${i}${c.salary}/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const o=await t.json();throw new Error(o.error||"Failed to record payment")}return await t.json()}export{c as R,$ as a,w as b,S as c,_ as d,g as e,k as f,A as g,F as h,j as l,E as r};
