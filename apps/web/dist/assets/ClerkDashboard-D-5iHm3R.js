const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeeCollection-CZkIN4xg.js","assets/index-BOMOBQPd.js","assets/index-B4QZcnWE.css","assets/clerk.service-BQknc3Ll.js","assets/SalaryPaymentSection-BdQHnwa-.js","assets/TeacherPaymentHistory-CBR5Mhmc.js"])))=>i.map(i=>d[i]);
import{u as y,r,s as p,j as e,a as b,_ as N}from"./index-BOMOBQPd.js";import{g as w,L as j}from"./auth.service-69BbSp1u.js";import{l as k}from"./clerk.service-BQknc3Ll.js";import{U as _}from"./UnpaidFeeAnalytics-6Dqe3-Q5.js";function C(){const t=y(),[i,n]=r.useState(!0),[s,a]=r.useState(null),[d,o]=r.useState(null),l=r.useRef(!0);return r.useEffect(()=>(l.current=!0,(async()=>{var h,c;try{const u=(h=(await p.auth.getSession()).data.session)==null?void 0:h.access_token;if(!u){l.current&&t("/login");return}const g=await w(u),f=(c=g.profile)==null?void 0:c.role;if(f!=="clerk"&&f!=="principal"){const v={teacher:"/teacher/classes",student:"/student/home",parent:"/parent"}[f]||"/login";l.current&&t(v,{replace:!0});return}l.current&&(a(f),o(g.profile))}catch(m){console.error("[useClerkAuth] Error verifying role:",m),l.current&&t("/login");return}finally{l.current&&n(!1)}})(),()=>{l.current=!1}),[t]),{loading:i,role:s,profile:d}}function P({profile:t,activeTab:i,setActiveTab:n}){const s=y(),a=async()=>{await p.auth.signOut(),s("/login")};return e.jsx("div",{className:"w-64 bg-gray-900 text-white min-h-screen fixed left-0 top-0",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8",children:"JhelumVerse"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Logged in as"}),e.jsx("div",{className:"font-semibold",children:(t==null?void 0:t.full_name)||"Clerk"}),e.jsx("div",{className:"text-sm text-gray-400",children:t==null?void 0:t.email})]}),e.jsxs("nav",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>{n("dashboard"),s("/clerk")},className:`w-full text-left px-4 py-2 rounded-lg transition ${i==="dashboard"?"bg-blue-600 text-white":"hover:bg-gray-800 text-gray-300"}`,children:"ðŸ“Š Dashboard"}),e.jsx("button",{onClick:()=>{n("fee-collection"),s("/clerk/fees")},className:`w-full text-left px-4 py-2 rounded-lg transition ${i==="fee-collection"?"bg-blue-600 text-white":"hover:bg-gray-800 text-gray-300"}`,children:"ðŸ’° Fee Collection"}),e.jsx("button",{onClick:()=>{n("salary-payment"),s("/clerk/salary")},className:`w-full text-left px-4 py-2 rounded-lg transition ${i==="salary-payment"?"bg-blue-600 text-white":"hover:bg-gray-800 text-gray-300"}`,children:"ðŸ’µ Pay Salary"})]}),e.jsx("button",{onClick:a,className:"mt-8 w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 transition",children:"ðŸšª Logout"})]})})}function L({dashboardStats:t,loadingStats:i,setActiveTab:n}){var a,d,o;const s=y();return i?e.jsx("div",{className:"text-center py-8",children:"Loading statistics..."}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Dashboard Overview"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Total Students"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-2",children:(t==null?void 0:t.totalStudents)||0})]}),e.jsx("div",{className:"text-4xl",children:"ðŸ‘¥"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Today's Collection"}),e.jsxs("p",{className:"text-3xl font-bold text-green-600 mt-2",children:["â‚¹",((a=t==null?void 0:t.todayCollection)==null?void 0:a.toFixed(2))||"0.00"]})]}),e.jsx("div",{className:"text-4xl",children:"ðŸ’°"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Total Pending"}),e.jsxs("p",{className:"text-3xl font-bold text-red-600 mt-2",children:["â‚¹",((d=t==null?void 0:t.totalPending)==null?void 0:d.toFixed(2))||"0.00"]})]}),e.jsx("div",{className:"text-4xl",children:"ðŸ“‹"})]})})]}),e.jsx(_,{userRole:"clerk",onCollectFee:l=>{n("fee-collection"),s(`/clerk/fees?student=${l}`)}}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Recent Payments"}),((o=t==null?void 0:t.recentPayments)==null?void 0:o.length)>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Mode"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.recentPayments.slice(0,10).map((l,x)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(l.payment_date).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["â‚¹",parseFloat(l.payment_amount||0).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-sm uppercase text-gray-600",children:l.payment_mode})]},x))})]})}):e.jsx("p",{className:"text-gray-500 text-center py-8",children:"No recent payments"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:()=>{n("fee-collection"),s("/clerk/fees")},className:"p-4 border-2 border-blue-500 rounded-lg hover:bg-blue-50 transition text-left",children:[e.jsx("div",{className:"font-semibold text-lg",children:"ðŸ’° Collect Fees"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"Record fee payments from students"})]}),e.jsxs("button",{onClick:()=>{n("fee-collection"),s("/clerk/fees")},className:"p-4 border-2 border-green-500 rounded-lg hover:bg-green-50 transition text-left",children:[e.jsx("div",{className:"font-semibold text-lg",children:"ðŸ“Š View Reports"}),e.jsx("div",{className:"text-sm text-gray-600 mt-1",children:"View payment history and analytics"})]})]})]})]})}const D=r.lazy(()=>N(()=>import("./FeeCollection-CZkIN4xg.js"),__vite__mapDeps([0,1,2,3]))),R=r.lazy(()=>N(()=>import("./SalaryPaymentSection-BdQHnwa-.js"),__vite__mapDeps([4,1,2,3,5])));function M(){const t=b(),{loading:i,profile:n}=C(),[s,a]=r.useState("dashboard"),[d,o]=r.useState(null),[l,x]=r.useState(!1);r.useEffect(()=>{const c=t.pathname;c.includes("/clerk/fees")||c.includes("/clerk/payments")?a("fee-collection"):c.includes("/clerk/salary")?a("salary-payment"):(c==="/clerk"||c==="/clerk/")&&a("dashboard")},[t.pathname]),r.useEffect(()=>{s==="dashboard"&&n&&h()},[s,n]);const h=async()=>{var c;x(!0);try{const u=(c=(await p.auth.getSession()).data.session)==null?void 0:c.access_token;if(!u)return;const g=await k(u);o(g)}catch(m){console.error("Error loading dashboard stats:",m),o({totalStudents:0,todayCollection:0,totalPending:0,recentPayments:[]})}finally{x(!1)}};return i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"Loading..."})})}):e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(P,{profile:n,activeTab:s,setActiveTab:a}),e.jsx("div",{className:"ml-64 flex-1",children:e.jsxs("div",{className:"p-6",children:[s==="dashboard"&&e.jsx(L,{dashboardStats:d,loadingStats:l,setActiveTab:a}),s==="fee-collection"&&e.jsx(j,{children:e.jsx(D,{})}),s==="salary-payment"&&e.jsx(j,{children:e.jsx(R,{})})]})})]})}export{M as default};
