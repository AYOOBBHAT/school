const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StaffManagement-C-n7Ej-m.js","assets/index-jNkMZTGm.js","assets/index-CEa455P0.css","assets/TeacherPaymentHistory-BSPwaujN.js","assets/clerk.service-FPcaANOT.js","assets/auth.service-B0iywXjZ.js","assets/UnpaidFeeAnalytics-mcRUqrLn.js","assets/ClassesManagement-XrszAcWC.js","assets/SubjectsManagement-BxHu-ufn.js","assets/StudentsManagement-D8E2-uvZ.js","assets/ClassificationsManagement-BdBewfN8.js","assets/ExamsManagement-ClJYX7Pn.js","assets/SalaryManagement-BNrksjUu.js","assets/FeeManagement-B9J33rb0.js"])))=>i.map(i=>d[i]);
import{u as L,r as d,s as j,j as r,L as J,A as o,a as G,E as R,_ as E}from"./index-jNkMZTGm.js";import{g as M,L as $}from"./auth.service-B0iywXjZ.js";import{U as I}from"./UnpaidFeeAnalytics-mcRUqrLn.js";function V(){const a=L(),[e,t]=d.useState(!0),[s,n]=d.useState(null),l=d.useRef(!0);return d.useEffect(()=>(l.current=!0,(async()=>{var w,g,A,c,u;try{const m=await j.auth.getSession(),y=(w=m.data.session)==null?void 0:w.access_token,h=(g=m.data.session)==null?void 0:g.user;if(console.log("[usePrincipalAuth] Session check:",{hasToken:!!y,hasUser:!!h,userId:h==null?void 0:h.id,email:h==null?void 0:h.email}),!y||!h){console.warn("[usePrincipalAuth] No session or token found, redirecting to login"),l.current&&a("/login");return}let p;try{p=await M(y)}catch(v){console.error("[usePrincipalAuth] Error parsing profile response:",v);const b=(c=(A=m.data.session)==null?void 0:A.user)==null?void 0:c.id;if(!b){l.current&&a("/login");return}const{data:S}=await j.from("profiles").select("role, approval_status").eq("id",b).single();if(S&&S.role==="principal"){l.current&&n("principal");return}else{l.current&&a("/login");return}}const f=(u=p==null?void 0:p.profile)==null?void 0:u.role;if(f!=="principal"&&f!=="clerk"){console.warn("[usePrincipalAuth] Unauthorized access attempt by role:",f);const b={student:"/student/home",teacher:"/teacher/classes",parent:"/parent/home"}[f]||"/login";l.current&&a(b,{replace:!0});return}l.current&&n(f)}catch(m){console.error("[usePrincipalAuth] Error verifying role:",m),l.current&&a("/login");return}finally{l.current&&t(!1)}})(),()=>{l.current=!1}),[a]),{loading:e,role:s}}function U({currentPath:a}){const e=L(),t=async()=>{await j.auth.signOut(),e("/login")},n=[{path:"/principal/dashboard",label:"Dashboard",icon:"ðŸ“Š"},{path:"/principal/staff",label:"Staff Management",icon:"ðŸ‘¥"},{path:"/principal/classifications",label:"Classifications",icon:"ðŸ·ï¸"},{path:"/principal/classes",label:"Classes",icon:"ðŸ«"},{path:"/principal/subjects",label:"Subjects",icon:"ðŸ“š"},{path:"/principal/students",label:"Students",icon:"ðŸŽ“"},{path:"/principal/exams",label:"Exams",icon:"ðŸ“"},{path:"/principal/salary",label:"Salary Management",icon:"ðŸ’°"},{path:"/principal/fees",label:"Fee Management",icon:"ðŸ’µ"}];return r.jsxs("div",{className:"w-64 bg-gray-900 text-white min-h-screen fixed left-0 top-0",children:[r.jsxs("div",{className:"p-6",children:[r.jsx("h1",{className:"text-2xl font-bold mb-8",children:"JhelumVerse"}),r.jsx("nav",{className:"space-y-2",children:n.map(l=>r.jsxs(J,{to:l.path,className:`flex items-center space-x-3 px-4 py-3 rounded-lg transition ${a===l.path?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-800"}`,children:[r.jsx("span",{children:l.icon}),r.jsx("span",{children:l.label})]},l.path))})]}),r.jsx("div",{className:"absolute bottom-0 w-full p-6",children:r.jsx("button",{onClick:t,className:"w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition",children:"Logout"})})]})}const T=()=>({total:0,male:0,female:0,other:0,unknown:0}),q=a=>{if(!a)return"unknown";const e=a.trim().toLowerCase();return["male","m","boy","boys"].includes(e)?"male":["female","f","girl","girls"].includes(e)?"female":e.length>0&&e!=="male"&&e!=="female"?"other":"unknown"},O=a=>{const e=T();return a.forEach(t=>{const s=q(t);e.total+=1,e[s]+=1}),e},P=a=>({total:(a==null?void 0:a.total)??0,male:(a==null?void 0:a.male)??0,female:(a==null?void 0:a.female)??0,other:(a==null?void 0:a.other)??0,unknown:(a==null?void 0:a.unknown)??0}),ce=a=>{const e=a.toLowerCase();return e.includes("grade")?"Grade 9, Grade 10, Grade 11":e.includes("section")?"A, B, C, D":e.includes("house")?"Blue House, Red House, Green House":e.includes("gender")?"Boys, Girls, Mixed":e.includes("stream")?"Science, Arts, Commerce":e.includes("level")?"Junior, Senior, Advanced":"Enter value"},le=a=>{const e=a.toLowerCase();return e.includes("grade")?"Examples: Grade 9, Grade 10, Grade 11, Grade 12":e.includes("section")?"Examples: A, B, C, D, E":e.includes("house")?"Examples: Blue House, Red House, Green House, Yellow House":e.includes("gender")?"Examples: Boys, Girls, Mixed":e.includes("stream")?"Examples: Science, Arts, Commerce, Vocational":e.includes("level")?"Examples: Junior Group, Senior Group, Advanced":"Enter a value for this classification type"};function D({title:a,breakdown:e,colors:t={male:"#3B82F6",female:"#EC4899",other:"#10B981",unknown:"#9CA3AF"}}){const w=[{label:"Male",value:e.male,color:t.male},{label:"Female",value:e.female,color:t.female},{label:"Other",value:e.other,color:t.other},{label:"Not Specified",value:e.unknown,color:t.unknown}].filter(c=>c.value>0);let g=-90;const A=w.map(c=>{const u=e.total>0?c.value/e.total:0,m=u*360,y=g,h=g+m;g=h;const p=y*Math.PI/180,f=h*Math.PI/180,v=100+80*Math.cos(p),b=100+80*Math.sin(p),S=100+80*Math.cos(f),N=100+80*Math.sin(f),i=m>180?1:0,x=["M 100 100",`L ${v} ${b}`,`A 80 80 0 ${i} 1 ${S} ${N}`,"Z"].join(" ");return{...c,percentage:u,pathData:x}});return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:a}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsxs("div",{className:"relative",style:{width:200,height:200},children:[r.jsxs("svg",{width:200,height:200,children:[A.map((c,u)=>r.jsx("path",{d:c.pathData,fill:c.color,className:"transition-all duration-500"},u)),e.total===0&&r.jsx("circle",{cx:100,cy:100,r:80,fill:"none",stroke:"#E5E7EB",strokeWidth:40}),r.jsx("circle",{cx:100,cy:100,r:40,fill:"white"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:e.total}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Total"})]})})]}),r.jsx("div",{className:"mt-6 w-full max-w-xs",children:r.jsx("div",{className:"grid grid-cols-2 gap-3",children:w.map((c,u)=>r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:c.color}}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 truncate",children:c.label}),r.jsxs("div",{className:"text-xs text-gray-500",children:[c.value," (",e.total>0?(c.value/e.total*100).toFixed(1):0,"%)"]})]})]},u))})})]})]})}async function de(a){const e=await fetch(`${o}/staff-admin`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load staff"}));throw new Error(t.error||`Failed to load staff: ${e.status}`)}return await e.json()}async function ue(a){const e=await fetch(`${o}/classes`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{classes:[]}}async function he(a){const e=await fetch(`${o}/subjects`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{subjects:[]}}async function fe(a){const e=await fetch(`${o}/teacher-assignments`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{assignments:[]}}async function pe(a){const e=await fetch(`${o}/teacher-attendance-assignments`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{assignments:[]}}async function me(a,e){const t=await fetch(`${o}/classes/${e}/sections`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{sections:[]}}async function we(a,e){const t=await fetch(`${o}/teacher-attendance?teacher_id=${e}`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)return{attendance:[],summary:void 0};const s=await t.json();return{attendance:s.attendance||[],summary:s.summary||null}}async function ye(a,e){const t=await fetch(`${o}/teacher-attendance`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to mark attendance")}}async function je(a,e){const t=await fetch(`${o}/staff-admin/${e}/performance`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load performance data");return await t.json()}async function xe(a,e,t){const s=await fetch(`${o}/staff-admin/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to update teacher")}return await s.json()}async function ge(a,e){const t=await fetch(`${o}/teacher-assignments/teacher/${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{assignments:[]}}async function be(a,e){const t=await fetch(`${o}/teacher-attendance-assignments/teacher/${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{assignments:[]}}async function $e(a,e){const t=await fetch(`${o}/teacher-assignments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create assignment")}return await t.json()}async function Ee(a,e){const t=await fetch(`${o}/teacher-attendance-assignments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create attendance assignment")}return await t.json()}async function Ae(a,e){const t=await fetch(`${o}/teacher-assignments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete assignment")}}async function ve(a,e,t,s){const n=await fetch(`${o}/teacher-attendance?teacher_id=${e}&start_date=${t}&end_date=${s}`,{headers:{Authorization:`Bearer ${a}`}});return n.ok?await n.json():{attendance:[],summary:null}}async function Se(a,e){const t=await fetch(`${o}/teacher-attendance/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save attendance")}}async function ke(a,e){const t=await fetch(`${o}/principal-users/staff`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to add staff member")}return await t.json()}async function _e(a,e){const t=await fetch(`${o}/teacher-attendance-assignments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete attendance assignment")}}async function Ne(a){const e=await fetch(`${o}/classes`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load classes"}));throw new Error(t.error||`Failed to load classes: ${e.status}`)}return await e.json()}async function Be(a,e){const t=await fetch(`${o}/classes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:e.name,description:e.description,classification_value_ids:e.classification_value_ids&&e.classification_value_ids.length>0?e.classification_value_ids:void 0})});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create class")}return await t.json()}async function Ce(a,e,t){const s=await fetch(`${o}/classes/${e}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({subject_id:t})});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to add subject")}return await s.json()}async function Te(a,e,t){const s=await fetch(`${o}/classes/${e}/subjects/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to remove subject")}}async function ze(a,e,t){const s=await fetch(`${o}/classes/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:t.name,description:t.description,classification_value_ids:t.classification_value_ids&&t.classification_value_ids.length>0?t.classification_value_ids:[]})});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to update class")}return await s.json()}async function Fe(a){const e=await fetch(`${o}/subjects`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load subjects"}));throw new Error(t.error||`Failed to load subjects: ${e.status}`)}return await e.json()}async function Oe(a,e){const t=await fetch(`${o}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:e.name,code:e.code||null})});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create subject")}return await t.json()}async function Pe(a,e){const t=await fetch(`${o}/subjects/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete subject")}}async function De(a,e){const t=await fetch(`${o}/principal-users/check-username/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{available:!1,message:"Username check failed"}}async function Le(a,e){const t=`${o}/students-admin`,s=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok){const n=await s.json().catch(()=>({error:"Failed to load students"}));throw new Error(n.error||`Failed to load students: ${s.status}`)}return await s.json()}async function Je(a,e){const t=await fetch(`${o}/classes/${e}/sections`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load sections");return await t.json()}async function Ge(a,e){const t=await fetch(`${o}/principal-users/classes/${e}/default-fees`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load default fees");return await t.json()}async function Re(a,e){const t=await fetch(`${o}/students-admin/${e}/fee-config`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():await t.json().catch(()=>({fee_config:null}))}async function Me(a,e,t){const s=await fetch(`${o}/students-admin/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to update student")}return await s.json()}async function Ie(a,e,t){const s=await fetch(`${o}/students-admin/${e}/promote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to promote student")}return await s.json()}async function Ve(a,e,t){const s=await fetch(`${o}/students-admin/class/${e}/promote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to promote class")}return await s.json()}async function Ue(a,e){const t=await fetch(`${o}/principal-users/students`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to add student")}return await t.json()}async function qe(a){const e=await fetch(`${o}/classifications/types`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load classification types"}));throw new Error(t.error||`Failed to load classification types: ${e.status}`)}return await e.json()}async function He(a,e){const t=await fetch(`${o}/classifications/types/${e}/values`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{values:[]}}async function We(a,e){const t=await fetch(`${o}/classifications/types`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create classification type")}return await t.json()}async function Ye(a,e){const t=await fetch(`${o}/classifications/values`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create classification value")}return await t.json()}async function Ke(a,e){if(!(await fetch(`${o}/classifications/values/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete classification value")}async function Ze(a,e){if(!(await fetch(`${o}/classifications/types/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete classification type")}async function Qe(a){const e=await fetch(`${o}/exams`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load exams");return await e.json()}async function Xe(a,e){const t=await fetch(`${o}/exams`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create exam")}return await t.json()}async function et(a){const e=await fetch(`${o}/fees/class-fees`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{class_fees:[]}}async function tt(a,e){const t=await fetch(`${o}/fees/class-fees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save class fee")}return await t.json()}async function at(a,e){const t=`${o}/fees/custom-fees`,s=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});return s.ok?await s.json():{custom_fees:[]}}async function st(a,e){const t=await fetch(`${o}/fees/custom-fees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save custom fee")}return await t.json()}async function rt(a,e){const t=await fetch(`${o}/fees/custom-fees/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete custom fee")}}async function ot(a){const e=await fetch(`${o}/fees/transport/routes`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{routes:[]}}async function nt(a,e){const t=await fetch(`${o}/fees/transport/routes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save route")}return await t.json()}async function it(a){const e=await fetch(`${o}/fees/transport/fees`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{transport_fees:[]}}async function ct(a,e){const t=await fetch(`${o}/fees/transport/fees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save transport fee")}return await t.json()}async function lt(a,e,t){let s="";if(e==="class"?s=`${o}/fees/class-fees/${t}/versions`:e==="transport"?s=`${o}/fees/transport/fees/${t}/versions`:e==="custom"&&(s=`${o}/fees/custom-fees/${t}/versions`),!s)return{versions:[]};const n=await fetch(s,{headers:{Authorization:`Bearer ${a}`}});return n.ok?await n.json():{versions:[]}}async function dt(a,e,t){const s=await fetch(`${o}/fees/class-fees/${e}/hike`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to hike fee")}return await s.json()}async function ut(a,e,t){const s=await fetch(`${o}/fees/transport/fees/${e}/hike`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to hike fee")}return await s.json()}async function ht(a){const e=await fetch(`${o}/students`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{students:[]}}async function ft(a){const e=await fetch(`${o}/salary/structures`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{structures:[]}}async function pt(a,e="last_12_months"){const t=await fetch(`${o}/salary/unpaid?time_scope=${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{teachers:[]}}async function mt(a,e){const t=await fetch(`${o}/salary/structure`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save structure")}return await t.json()}async function H(a){const e=await fetch(`${o}/school/info`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)throw new Error("Failed to load school info");const t=await e.json(),s=t.school||t;if(s&&typeof s=="object"&&!Array.isArray(s))return s;throw new Error("Unexpected school data format")}async function W(a){const e=await fetch(`${o}/dashboard/stats`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load dashboard stats");const t=await e.json();return t==null?void 0:t.stats}function Y(){const[a,e]=d.useState({totalStudents:0,totalStaff:0,totalClasses:0,studentsByGender:T(),staffByGender:T()}),[t,s]=d.useState(!0),[n,l]=d.useState(null),[_,w]=d.useState(!1);if(d.useEffect(()=>((async()=>{var c;try{const{data:{user:u},error:m}=await j.auth.getUser();if(m){console.error("Error getting user:",m);return}if(!u){console.log("No user found");return}const{data:y,error:h}=await j.from("profiles").select("school_id").eq("id",u.id).single();if(h){console.error("Error loading profile:",h);return}if(!y||!("school_id"in y)||!y.school_id){console.log("No profile or school_id found");return}const p=y.school_id,f=(c=(await j.auth.getSession()).data.session)==null?void 0:c.access_token,v=async()=>{try{const{data:i,error:x}=await j.from("schools").select("id, name, join_code, registration_number, address, contact_email, contact_phone, logo_url, created_at").eq("id",p).maybeSingle();!x&&i?(console.log("School data loaded from Supabase fallback:",i),l(i)):x&&console.error("Error loading school from Supabase:",x)}catch(i){console.error("Error in Supabase query:",i)}},b=async()=>{if(!f){await v();return}try{const i=await H(f);console.log("School data loaded from API:",i),l(i)}catch(i){console.error("Error loading school from API:",i),await v()}},S=async()=>{try{const[i,x,B]=await Promise.all([j.from("students").select("id, status, profile:profiles!students_profile_id_fkey(gender)").eq("school_id",p).eq("status","active"),j.from("profiles").select("id, gender").eq("school_id",p).in("role",["principal","clerk","teacher"]).eq("approval_status","approved"),j.from("class_groups").select("id",{count:"exact",head:!0}).eq("school_id",p)]);if(i.error)throw i.error;if(x.error)throw x.error;if(B.error)throw B.error;const z=O((i.data||[]).map(k=>{const C=Array.isArray(k.profile)?k.profile[0]:k.profile;return C==null?void 0:C.gender})),F=O((x.data||[]).map(k=>k.gender));e({totalStudents:z.total,totalStaff:F.total,totalClasses:B.count||0,studentsByGender:z,staffByGender:F})}catch(i){console.error("Error loading fallback stats:",i)}},N=async()=>{if(!f){await S();return}try{const i=await W(f);e({totalStudents:(i==null?void 0:i.totalStudents)??0,totalStaff:(i==null?void 0:i.totalStaff)??0,totalClasses:(i==null?void 0:i.totalClasses)??0,studentsByGender:P(i==null?void 0:i.studentsByGender),staffByGender:P(i==null?void 0:i.staffByGender)})}catch(i){console.error("Error loading dashboard stats:",i),await S()}};await b(),await N()}catch(u){console.error("Error loading dashboard:",u)}finally{s(!1)}})(),()=>{}),[]),t)return r.jsx("div",{className:"p-6",children:"Loading..."});const g=async()=>{if(n!=null&&n.join_code)try{await navigator.clipboard.writeText(n.join_code),w(!0),setTimeout(()=>w(!1),2e3)}catch(A){console.error("Failed to copy join code:",A);const c=document.createElement("textarea");c.value=n.join_code,document.body.appendChild(c),c.select(),document.execCommand("copy"),document.body.removeChild(c),w(!0),setTimeout(()=>w(!1),2e3)}};return r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"mb-6",children:[n&&r.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 p-8 mb-6 shadow-2xl",children:[r.jsx("div",{className:"absolute inset-0 bg-black opacity-10"}),r.jsxs("div",{className:"relative z-10",children:[r.jsxs("h1",{className:"text-4xl md:text-5xl font-extrabold text-white mb-2 drop-shadow-lg",children:["Welcome to"," ",r.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-yellow-200 via-white to-yellow-200 animate-pulse",children:n.name})]}),r.jsxs("div",{className:"flex flex-wrap gap-4 mt-4 text-sm",children:[n.join_code&&r.jsxs("div",{className:"flex items-center gap-2 bg-white bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[r.jsx("span",{className:"font-medium text-white",children:"School Code:"}),r.jsx("span",{className:"font-mono font-bold text-yellow-200",children:n.join_code})]}),n.registration_number&&r.jsxs("div",{className:"flex items-center gap-2 bg-white bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[r.jsx("span",{className:"font-medium text-white",children:"Registration No:"}),r.jsx("span",{className:"font-bold text-yellow-200",children:n.registration_number})]})]})]}),r.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -mr-32 -mt-32"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white opacity-5 rounded-full -ml-24 -mb-24"})]}),r.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"})]}),n&&r.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 mb-6 text-white",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-lg font-semibold mb-2",children:"School Join Code"}),r.jsx("p",{className:"text-sm opacity-90 mb-3",children:"Share this code with teachers, students, and parents so they can join your school"}),n.join_code?r.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[r.jsx("code",{className:"text-2xl font-bold bg-white/20 px-4 py-2 rounded-lg font-mono",children:n.join_code}),r.jsx("button",{onClick:g,className:"bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-blue-50 transition flex items-center gap-2",children:_?r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"âœ“"}),r.jsx("span",{children:"Copied!"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"ðŸ“‹"}),r.jsx("span",{children:"Copy Code"})]})})]}):r.jsxs("div",{className:"bg-white/20 rounded-lg p-4",children:[r.jsx("p",{className:"text-white font-semibold mb-2",children:"âš ï¸ Join Code Not Found"}),r.jsx("p",{className:"text-sm opacity-90",children:"Your school join code is missing. Please contact support or check your school settings."}),r.jsxs("p",{className:"text-xs opacity-75 mt-2",children:["School ID: ",n.id]})]})]}),r.jsx("div",{className:"text-6xl opacity-20 ml-4",children:"ðŸ”‘"})]})}),!1,r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[r.jsx(D,{title:"Student Gender Breakdown",breakdown:a.studentsByGender,colors:{male:"#3B82F6",female:"#EC4899",other:"#10B981",unknown:"#9CA3AF"}}),r.jsx(D,{title:"Staff Gender Breakdown",breakdown:a.staffByGender,colors:{male:"#3B82F6",female:"#EC4899",other:"#10B981",unknown:"#9CA3AF"}})]}),r.jsx(I,{userRole:"principal"})]})}const K=d.lazy(()=>E(()=>import("./StaffManagement-C-n7Ej-m.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Z=d.lazy(()=>E(()=>import("./ClassesManagement-XrszAcWC.js"),__vite__mapDeps([7,1,2,5,6,4]))),Q=d.lazy(()=>E(()=>import("./SubjectsManagement-BxHu-ufn.js"),__vite__mapDeps([8,1,2,5,6,4]))),X=d.lazy(()=>E(()=>import("./StudentsManagement-D8E2-uvZ.js"),__vite__mapDeps([9,1,2,5,6,4]))),ee=d.lazy(()=>E(()=>import("./ClassificationsManagement-BdBewfN8.js"),__vite__mapDeps([10,1,2,5,6,4]))),te=d.lazy(()=>E(()=>import("./ExamsManagement-ClJYX7Pn.js"),__vite__mapDeps([11,1,2,5,6,4]))),ae=d.lazy(()=>E(()=>import("./SalaryManagement-BNrksjUu.js"),__vite__mapDeps([12,1,2,5,6,4]))),se=d.lazy(()=>E(()=>import("./FeeManagement-B9J33rb0.js"),__vite__mapDeps([13,1,2,5,6,4])));function re(){const a=G(),{loading:e}=V(),[t,s]=d.useState("dashboard");return d.useEffect(()=>{const n=a.pathname;return n==="/principal/dashboard"?s("dashboard"):n==="/principal/staff"?s("staff"):n==="/principal/classifications"?s("classifications"):n==="/principal/classes"?s("classes"):n==="/principal/subjects"?s("subjects"):n==="/principal/students"?s("students"):n==="/principal/exams"?s("exams"):n==="/principal/salary"?s("salary"):n==="/principal/fees"&&s("fees"),()=>{}},[a]),e?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"text-center",children:r.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"Loading..."})})}):r.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[r.jsx(U,{currentPath:a.pathname}),r.jsxs("div",{className:"ml-64 flex-1",children:[t==="dashboard"&&r.jsx(Y,{}),t==="staff"&&r.jsx(R,{fallback:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Error Loading Staff Page"}),r.jsx("p",{className:"text-red-600 text-sm",children:"Please refresh the page or try again later."})]})}),children:r.jsx($,{children:r.jsx(K,{},"staff-management")})}),t==="classifications"&&r.jsx($,{children:r.jsx(ee,{})}),t==="classes"&&r.jsx($,{children:r.jsx(Z,{})}),t==="subjects"&&r.jsx($,{children:r.jsx(Q,{})}),t==="students"&&r.jsx($,{children:r.jsx(X,{})}),t==="exams"&&r.jsx($,{children:r.jsx(te,{})}),t==="salary"&&r.jsx($,{children:r.jsx(ae,{})}),t==="fees"&&r.jsx($,{children:r.jsx(se,{userRole:"principal"})})]})]})}const wt=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{ht as $,ze as A,Oe as B,Pe as C,De as D,Le as E,Je as F,Ge as G,Re as H,Me as I,Ie as J,Ve as K,Ue as L,ce as M,le as N,We as O,Ye as P,Ze as Q,Ke as R,Qe as S,Xe as T,ft as U,pt as V,mt as W,et as X,at as Y,ot as Z,it as _,he as a,rt as a0,tt as a1,st as a2,nt as a3,ct as a4,lt as a5,dt as a6,ut as a7,wt as a8,fe as b,pe as c,me as d,de as e,ve as f,_e as g,je as h,ge as i,be as j,$e as k,ue as l,ye as m,Ee as n,Ae as o,ke as p,we as q,Fe as r,Se as s,qe as t,xe as u,He as v,Ne as w,Ce as x,Te as y,Be as z};
