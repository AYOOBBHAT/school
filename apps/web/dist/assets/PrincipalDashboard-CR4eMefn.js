const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StaffManagement-DsO-VACD.js","assets/index-D8VqHZL0.js","assets/index-K4J_ZkV3.css","assets/TeacherPaymentHistory-DVTfxYOM.js","assets/clerk.service-wZ_w9nVm.js","assets/auth.service-C-6KUiiY.js","assets/UnpaidFeeAnalytics-DgMQFA0x.js","assets/ClassesManagement-CB-fhwDX.js","assets/SubjectsManagement-BgHe7rKM.js","assets/StudentsManagement-DpFpolYp.js","assets/ClassificationsManagement-B0nhqzll.js","assets/ExamsManagement-DrPVZFLx.js","assets/SalaryManagement-BIF1IbC4.js","assets/FeeManagement-igVCP_7O.js"])))=>i.map(i=>d[i]);
import{u as O,r as d,s as j,j as r,L as P,A as o,a as D,E as L,_ as b}from"./index-D8VqHZL0.js";import{g as G,L as $}from"./auth.service-C-6KUiiY.js";import{U as R}from"./UnpaidFeeAnalytics-DgMQFA0x.js";function J(){const a=O(),[e,t]=d.useState(!0),[s,n]=d.useState(null),c=d.useRef(!0);return d.useEffect(()=>(c.current=!0,(async()=>{var x,w,E,l,h;try{const f=await j.auth.getSession(),y=(x=f.data.session)==null?void 0:x.access_token,u=(w=f.data.session)==null?void 0:w.user;if(console.log("[usePrincipalAuth] Session check:",{hasToken:!!y,hasUser:!!u,userId:u==null?void 0:u.id,email:u==null?void 0:u.email}),!y||!u){console.warn("[usePrincipalAuth] No session or token found, redirecting to login"),c.current&&a("/login");return}let g;try{g=await G(y)}catch(A){console.error("[usePrincipalAuth] Error parsing profile response:",A);const i=(l=(E=f.data.session)==null?void 0:E.user)==null?void 0:l.id;if(!i){c.current&&a("/login");return}const{data:p}=await j.from("profiles").select("role, approval_status").eq("id",i).single();if(p&&p.role==="principal"){c.current&&n("principal");return}else{c.current&&a("/login");return}}const m=(h=g==null?void 0:g.profile)==null?void 0:h.role;if(m!=="principal"&&m!=="clerk"){console.warn("[usePrincipalAuth] Unauthorized access attempt by role:",m);const i={student:"/student/home",teacher:"/teacher/classes",parent:"/parent/home"}[m]||"/login";c.current&&a(i,{replace:!0});return}c.current&&n(m)}catch(f){console.error("[usePrincipalAuth] Error verifying role:",f),c.current&&a("/login");return}finally{c.current&&t(!1)}})(),()=>{c.current=!1}),[a]),{loading:e,role:s}}function M({currentPath:a}){const e=O(),t=async()=>{await j.auth.signOut(),e("/login")},n=[{path:"/principal/dashboard",label:"Dashboard",icon:"ðŸ“Š"},{path:"/principal/staff",label:"Staff Management",icon:"ðŸ‘¥"},{path:"/principal/classifications",label:"Classifications",icon:"ðŸ·ï¸"},{path:"/principal/classes",label:"Classes",icon:"ðŸ«"},{path:"/principal/subjects",label:"Subjects",icon:"ðŸ“š"},{path:"/principal/students",label:"Students",icon:"ðŸŽ“"},{path:"/principal/exams",label:"Exams",icon:"ðŸ“"},{path:"/principal/salary",label:"Salary Management",icon:"ðŸ’°"},{path:"/principal/fees",label:"Fee Management",icon:"ðŸ’µ"}];return r.jsxs("div",{className:"w-64 bg-gray-900 text-white min-h-screen fixed left-0 top-0",children:[r.jsxs("div",{className:"p-6",children:[r.jsx("h1",{className:"text-2xl font-bold mb-8",children:"JhelumVerse"}),r.jsx("nav",{className:"space-y-2",children:n.map(c=>r.jsxs(P,{to:c.path,className:`flex items-center space-x-3 px-4 py-3 rounded-lg transition ${a===c.path?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-800"}`,children:[r.jsx("span",{children:c.icon}),r.jsx("span",{children:c.label})]},c.path))})]}),r.jsx("div",{className:"absolute bottom-0 w-full p-6",children:r.jsx("button",{onClick:t,className:"w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition",children:"Logout"})})]})}const z=()=>({total:0,male:0,female:0,other:0,unknown:0}),I=a=>{if(!a)return"unknown";const e=a.trim().toLowerCase();return["male","m","boy","boys"].includes(e)?"male":["female","f","girl","girls"].includes(e)?"female":e.length>0&&e!=="male"&&e!=="female"?"other":"unknown"},T=a=>{const e=z();return a.forEach(t=>{const s=I(t);e.total+=1,e[s]+=1}),e},F=a=>({total:(a==null?void 0:a.total)??0,male:(a==null?void 0:a.male)??0,female:(a==null?void 0:a.female)??0,other:(a==null?void 0:a.other)??0,unknown:(a==null?void 0:a.unknown)??0}),oe=a=>{const e=a.toLowerCase();return e.includes("grade")?"Grade 9, Grade 10, Grade 11":e.includes("section")?"A, B, C, D":e.includes("house")?"Blue House, Red House, Green House":e.includes("gender")?"Boys, Girls, Mixed":e.includes("stream")?"Science, Arts, Commerce":e.includes("level")?"Junior, Senior, Advanced":"Enter value"},ne=a=>{const e=a.toLowerCase();return e.includes("grade")?"Examples: Grade 9, Grade 10, Grade 11, Grade 12":e.includes("section")?"Examples: A, B, C, D, E":e.includes("house")?"Examples: Blue House, Red House, Green House, Yellow House":e.includes("gender")?"Examples: Boys, Girls, Mixed":e.includes("stream")?"Examples: Science, Arts, Commerce, Vocational":e.includes("level")?"Examples: Junior Group, Senior Group, Advanced":"Enter a value for this classification type"};function C({title:a,breakdown:e,colors:t={male:"#3B82F6",female:"#EC4899",other:"#10B981",unknown:"#9CA3AF"}}){const x=[{label:"Male",value:e.male,color:t.male},{label:"Female",value:e.female,color:t.female},{label:"Other",value:e.other,color:t.other},{label:"Not Specified",value:e.unknown,color:t.unknown}].filter(l=>l.value>0);let w=-90;const E=x.map(l=>{const h=e.total>0?l.value/e.total:0,f=h*360,y=w,u=w+f;w=u;const g=y*Math.PI/180,m=u*Math.PI/180,A=100+80*Math.cos(g),i=100+80*Math.sin(g),p=100+80*Math.cos(m),S=100+80*Math.sin(m),k=f>180?1:0,_=["M 100 100",`L ${A} ${i}`,`A 80 80 0 ${k} 1 ${p} ${S}`,"Z"].join(" ");return{...l,percentage:h,pathData:_}});return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:a}),r.jsxs("div",{className:"flex flex-col items-center",children:[r.jsxs("div",{className:"relative",style:{width:200,height:200},children:[r.jsxs("svg",{width:200,height:200,children:[E.map((l,h)=>r.jsx("path",{d:l.pathData,fill:l.color,className:"transition-all duration-500"},h)),e.total===0&&r.jsx("circle",{cx:100,cy:100,r:80,fill:"none",stroke:"#E5E7EB",strokeWidth:40}),r.jsx("circle",{cx:100,cy:100,r:40,fill:"white"})]}),r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:e.total}),r.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"Total"})]})})]}),r.jsx("div",{className:"mt-6 w-full max-w-xs",children:r.jsx("div",{className:"grid grid-cols-2 gap-3",children:x.map((l,h)=>r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:l.color}}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"text-sm font-medium text-gray-700 truncate",children:l.label}),r.jsxs("div",{className:"text-xs text-gray-500",children:[l.value," (",e.total>0?(l.value/e.total*100).toFixed(1):0,"%)"]})]})]},h))})})]})]})}async function ie(a){const e=await fetch(`${o}/staff-admin`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load staff"}));throw new Error(t.error||`Failed to load staff: ${e.status}`)}return await e.json()}async function ce(a){const e=await fetch(`${o}/classes`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{classes:[]}}async function le(a){const e=await fetch(`${o}/subjects`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{subjects:[]}}async function de(a){const e=await fetch(`${o}/teacher-assignments`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{assignments:[]}}async function ue(a){const e=await fetch(`${o}/teacher-attendance-assignments`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{assignments:[]}}async function fe(a,e){const t=await fetch(`${o}/classes/${e}/sections`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{sections:[]}}async function he(a,e){const t=await fetch(`${o}/teacher-attendance?teacher_id=${e}`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)return{attendance:[],summary:void 0};const s=await t.json();return{attendance:s.attendance||[],summary:s.summary||null}}async function pe(a,e){const t=await fetch(`${o}/teacher-attendance`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to mark attendance")}}async function we(a,e){const t=await fetch(`${o}/staff-admin/${e}/performance`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load performance data");return await t.json()}async function me(a,e,t){const s=await fetch(`${o}/staff-admin/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to update teacher")}return await s.json()}async function ye(a,e){const t=await fetch(`${o}/teacher-assignments/teacher/${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{assignments:[]}}async function je(a,e){const t=await fetch(`${o}/teacher-attendance-assignments/teacher/${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{assignments:[]}}async function ge(a,e){const t=await fetch(`${o}/teacher-assignments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create assignment")}return await t.json()}async function xe(a,e){const t=await fetch(`${o}/teacher-attendance-assignments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create attendance assignment")}return await t.json()}async function $e(a,e){const t=await fetch(`${o}/teacher-assignments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete assignment")}}async function be(a,e,t,s){const n=await fetch(`${o}/teacher-attendance?teacher_id=${e}&start_date=${t}&end_date=${s}`,{headers:{Authorization:`Bearer ${a}`}});return n.ok?await n.json():{attendance:[],summary:null}}async function Ee(a,e){const t=await fetch(`${o}/teacher-attendance/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save attendance")}}async function Ae(a,e){const t=await fetch(`${o}/principal-users/staff`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to add staff member")}return await t.json()}async function Se(a,e){const t=await fetch(`${o}/teacher-attendance-assignments/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete attendance assignment")}}async function ve(a){const e=await fetch(`${o}/classes`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load classes"}));throw new Error(t.error||`Failed to load classes: ${e.status}`)}return await e.json()}async function ke(a,e){const t=await fetch(`${o}/classes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:e.name,description:e.description,classification_value_ids:e.classification_value_ids&&e.classification_value_ids.length>0?e.classification_value_ids:void 0})});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create class")}return await t.json()}async function _e(a,e,t){const s=await fetch(`${o}/classes/${e}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({subject_id:t})});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to add subject")}return await s.json()}async function Be(a,e,t){const s=await fetch(`${o}/classes/${e}/subjects/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to remove subject")}}async function ze(a,e,t){const s=await fetch(`${o}/classes/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:t.name,description:t.description,classification_value_ids:t.classification_value_ids&&t.classification_value_ids.length>0?t.classification_value_ids:[]})});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to update class")}return await s.json()}async function Ne(a){const e=await fetch(`${o}/subjects`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load subjects"}));throw new Error(t.error||`Failed to load subjects: ${e.status}`)}return await e.json()}async function Te(a,e){const t=await fetch(`${o}/subjects`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({name:e.name,code:e.code||null})});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create subject")}return await t.json()}async function Fe(a,e){const t=await fetch(`${o}/subjects/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete subject")}}async function Ce(a,e){const t=await fetch(`${o}/principal-users/check-username/${encodeURIComponent(e)}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{available:!1,message:"Username check failed"}}async function Oe(a,e){const t=`${o}/students-admin`,s=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok){const n=await s.json().catch(()=>({error:"Failed to load students"}));throw new Error(n.error||`Failed to load students: ${s.status}`)}return await s.json()}async function Pe(a,e){const t=await fetch(`${o}/classes/${e}/sections`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load sections");return await t.json()}async function De(a,e){const t=await fetch(`${o}/principal-users/classes/${e}/default-fees`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load default fees");return await t.json()}async function Le(a,e){const t=await fetch(`${o}/students-admin/${e}/fee-config`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():await t.json().catch(()=>({fee_config:null}))}async function Ge(a,e,t){const s=await fetch(`${o}/students-admin/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to update student")}return await s.json()}async function Re(a,e,t){const s=await fetch(`${o}/students-admin/${e}/promote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to promote student")}return await s.json()}async function Je(a,e,t){const s=await fetch(`${o}/students-admin/class/${e}/promote`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to promote class")}return await s.json()}async function Me(a,e){const t=await fetch(`${o}/principal-users/students`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to add student")}return await t.json()}async function Ie(a){const e=await fetch(`${o}/classifications/types`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load classification types"}));throw new Error(t.error||`Failed to load classification types: ${e.status}`)}return await e.json()}async function Ve(a,e){const t=await fetch(`${o}/classifications/types/${e}/values`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{values:[]}}async function Ue(a,e){const t=await fetch(`${o}/classifications/types`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create classification type")}return await t.json()}async function qe(a,e){const t=await fetch(`${o}/classifications/values`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create classification value")}return await t.json()}async function He(a,e){if(!(await fetch(`${o}/classifications/values/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete classification value")}async function We(a,e){if(!(await fetch(`${o}/classifications/types/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete classification type")}async function Ke(a){const e=await fetch(`${o}/exams`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load exams");return await e.json()}async function Ye(a,e){const t=await fetch(`${o}/exams`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to create exam")}return await t.json()}async function Ze(a){const e=await fetch(`${o}/fees/class-fees`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{class_fees:[]}}async function Qe(a,e){const t=await fetch(`${o}/fees/class-fees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save class fee")}return await t.json()}async function Xe(a,e){const t=`${o}/fees/custom-fees`,s=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});return s.ok?await s.json():{custom_fees:[]}}async function et(a,e){const t=await fetch(`${o}/fees/custom-fees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save custom fee")}return await t.json()}async function tt(a,e){const t=await fetch(`${o}/fees/custom-fees/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to delete custom fee")}}async function at(a){const e=await fetch(`${o}/fees/transport/routes`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{routes:[]}}async function st(a,e){const t=await fetch(`${o}/fees/transport/routes`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save route")}return await t.json()}async function rt(a){const e=await fetch(`${o}/fees/transport/fees`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{transport_fees:[]}}async function ot(a,e){const t=await fetch(`${o}/fees/transport/fees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save transport fee")}return await t.json()}async function nt(a,e,t){let s="";if(e==="class"?s=`${o}/fees/class-fees/${t}/versions`:e==="transport"?s=`${o}/fees/transport/fees/${t}/versions`:e==="custom"&&(s=`${o}/fees/custom-fees/${t}/versions`),!s)return{versions:[]};const n=await fetch(s,{headers:{Authorization:`Bearer ${a}`}});return n.ok?await n.json():{versions:[]}}async function it(a,e,t){const s=await fetch(`${o}/fees/class-fees/${e}/hike`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to hike fee")}return await s.json()}async function ct(a,e,t){const s=await fetch(`${o}/fees/transport/fees/${e}/hike`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to hike fee")}return await s.json()}async function lt(a){const e=await fetch(`${o}/students`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{students:[]}}async function dt(a){const e=await fetch(`${o}/salary/structures`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{structures:[]}}async function ut(a,e="last_12_months"){const t=await fetch(`${o}/salary/unpaid?time_scope=${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{teachers:[]}}async function ft(a,e){const t=await fetch(`${o}/salary/structure`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const s=await t.json();throw new Error(s.error||"Failed to save structure")}return await t.json()}async function V(a){const e=await fetch(`${o}/school/info`,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json",Accept:"application/json"}});if(!e.ok)throw new Error("Failed to load school info");const t=await e.json(),s=t.school||t;if(s&&typeof s=="object"&&!Array.isArray(s))return s;throw new Error("Unexpected school data format")}async function U(a){const e=await fetch(`${o}/dashboard/stats`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load dashboard stats");const t=await e.json();return t==null?void 0:t.stats}function q(){const[a,e]=d.useState({totalStudents:0,totalStaff:0,totalClasses:0,studentsByGender:z(),staffByGender:z()}),[t,s]=d.useState(!0),[n,c]=d.useState(null);return d.useEffect(()=>((async()=>{var x;try{const{data:{user:w},error:E}=await j.auth.getUser();if(E){console.error("Error getting user:",E);return}if(!w){console.log("No user found");return}const{data:l,error:h}=await j.from("profiles").select("school_id").eq("id",w.id).single();if(h){console.error("Error loading profile:",h);return}if(!l||!("school_id"in l)||!l.school_id){console.log("No profile or school_id found");return}const f=l.school_id,y=(x=(await j.auth.getSession()).data.session)==null?void 0:x.access_token,u=async()=>{try{const{data:i,error:p}=await j.from("schools").select("id, name, join_code, registration_number, address, contact_email, contact_phone, logo_url, created_at").eq("id",f).maybeSingle();!p&&i?(console.log("School data loaded from Supabase fallback:",i),c(i)):p&&console.error("Error loading school from Supabase:",p)}catch(i){console.error("Error in Supabase query:",i)}},g=async()=>{if(!y){await u();return}try{const i=await V(y);console.log("School data loaded from API:",i),c(i)}catch(i){console.error("Error loading school from API:",i),await u()}},m=async()=>{try{const[i,p,S]=await Promise.all([j.from("students").select("id, status, profile:profiles!students_profile_id_fkey(gender)").eq("school_id",f).eq("status","active"),j.from("profiles").select("id, gender").eq("school_id",f).in("role",["principal","clerk","teacher"]).eq("approval_status","approved"),j.from("class_groups").select("id",{count:"exact",head:!0}).eq("school_id",f)]);if(i.error)throw i.error;if(p.error)throw p.error;if(S.error)throw S.error;const k=T((i.data||[]).map(v=>{const B=Array.isArray(v.profile)?v.profile[0]:v.profile;return B==null?void 0:B.gender})),_=T((p.data||[]).map(v=>v.gender));e({totalStudents:k.total,totalStaff:_.total,totalClasses:S.count||0,studentsByGender:k,staffByGender:_})}catch(i){console.error("Error loading fallback stats:",i)}},A=async()=>{if(!y){await m();return}try{const i=await U(y);e({totalStudents:(i==null?void 0:i.totalStudents)??0,totalStaff:(i==null?void 0:i.totalStaff)??0,totalClasses:(i==null?void 0:i.totalClasses)??0,studentsByGender:F(i==null?void 0:i.studentsByGender),staffByGender:F(i==null?void 0:i.staffByGender)})}catch(i){console.error("Error loading dashboard stats:",i),await m()}};await g(),await A()}catch(w){console.error("Error loading dashboard:",w)}finally{s(!1)}})(),()=>{}),[]),t?r.jsx("div",{className:"p-6",children:"Loading..."}):r.jsxs("div",{className:"p-6",children:[r.jsxs("div",{className:"mb-6",children:[n&&r.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 p-8 mb-6 shadow-2xl",children:[r.jsx("div",{className:"absolute inset-0 bg-black opacity-10"}),r.jsxs("div",{className:"relative z-10",children:[r.jsxs("h1",{className:"text-4xl md:text-5xl font-extrabold text-white mb-2 drop-shadow-lg",children:["Welcome to"," ",r.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-yellow-200 via-white to-yellow-200 animate-pulse",children:n.name})]}),r.jsxs("div",{className:"flex flex-wrap gap-4 mt-4 text-sm",children:[n.join_code&&r.jsxs("div",{className:"flex items-center gap-2 bg-white bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[r.jsx("span",{className:"font-medium text-white",children:"School Code:"}),r.jsx("span",{className:"font-mono font-bold text-yellow-200",children:n.join_code})]}),n.registration_number&&r.jsxs("div",{className:"flex items-center gap-2 bg-white bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-lg",children:[r.jsx("span",{className:"font-medium text-white",children:"Registration No:"}),r.jsx("span",{className:"font-bold text-yellow-200",children:n.registration_number})]})]})]}),r.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -mr-32 -mt-32"}),r.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white opacity-5 rounded-full -ml-24 -mb-24"})]}),r.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"})]}),!1,r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 mt-6",children:[r.jsx(C,{title:"Student Gender Breakdown",breakdown:a.studentsByGender,colors:{male:"#3B82F6",female:"#EC4899",other:"#10B981",unknown:"#9CA3AF"}}),r.jsx(C,{title:"Staff Gender Breakdown",breakdown:a.staffByGender,colors:{male:"#3B82F6",female:"#EC4899",other:"#10B981",unknown:"#9CA3AF"}})]}),r.jsx(R,{userRole:"principal"})]})}const H=d.lazy(()=>b(()=>import("./StaffManagement-DsO-VACD.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),W=d.lazy(()=>b(()=>import("./ClassesManagement-CB-fhwDX.js"),__vite__mapDeps([7,1,2,5,6,4]))),K=d.lazy(()=>b(()=>import("./SubjectsManagement-BgHe7rKM.js"),__vite__mapDeps([8,1,2,5,6,4]))),Y=d.lazy(()=>b(()=>import("./StudentsManagement-DpFpolYp.js"),__vite__mapDeps([9,1,2,5,6,4]))),Z=d.lazy(()=>b(()=>import("./ClassificationsManagement-B0nhqzll.js"),__vite__mapDeps([10,1,2,5,6,4]))),Q=d.lazy(()=>b(()=>import("./ExamsManagement-DrPVZFLx.js"),__vite__mapDeps([11,1,2,5,6,4]))),X=d.lazy(()=>b(()=>import("./SalaryManagement-BIF1IbC4.js"),__vite__mapDeps([12,1,2,5,6,4]))),ee=d.lazy(()=>b(()=>import("./FeeManagement-igVCP_7O.js"),__vite__mapDeps([13,1,2,5,6,4])));function te(){const a=D(),{loading:e}=J(),[t,s]=d.useState("dashboard");return d.useEffect(()=>{const n=a.pathname;return n==="/principal/dashboard"?s("dashboard"):n==="/principal/staff"?s("staff"):n==="/principal/classifications"?s("classifications"):n==="/principal/classes"?s("classes"):n==="/principal/subjects"?s("subjects"):n==="/principal/students"?s("students"):n==="/principal/exams"?s("exams"):n==="/principal/salary"?s("salary"):n==="/principal/fees"&&s("fees"),()=>{}},[a]),e?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"text-center",children:r.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"Loading..."})})}):r.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[r.jsx(M,{currentPath:a.pathname}),r.jsxs("div",{className:"ml-64 flex-1",children:[t==="dashboard"&&r.jsx(q,{}),t==="staff"&&r.jsx(L,{fallback:r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-red-800 font-semibold mb-2",children:"Error Loading Staff Page"}),r.jsx("p",{className:"text-red-600 text-sm",children:"Please refresh the page or try again later."})]})}),children:r.jsx($,{children:r.jsx(H,{},"staff-management")})}),t==="classifications"&&r.jsx($,{children:r.jsx(Z,{})}),t==="classes"&&r.jsx($,{children:r.jsx(W,{})}),t==="subjects"&&r.jsx($,{children:r.jsx(K,{})}),t==="students"&&r.jsx($,{children:r.jsx(Y,{})}),t==="exams"&&r.jsx($,{children:r.jsx(Q,{})}),t==="salary"&&r.jsx($,{children:r.jsx(X,{})}),t==="fees"&&r.jsx($,{children:r.jsx(ee,{userRole:"principal"})})]})]})}const ht=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{lt as $,ze as A,Te as B,Fe as C,Ce as D,Oe as E,Pe as F,De as G,Le as H,Ge as I,Re as J,Je as K,Me as L,oe as M,ne as N,Ue as O,qe as P,We as Q,He as R,Ke as S,Ye as T,dt as U,ut as V,ft as W,Ze as X,Xe as Y,at as Z,rt as _,le as a,tt as a0,Qe as a1,et as a2,st as a3,ot as a4,nt as a5,it as a6,ct as a7,ht as a8,de as b,ue as c,fe as d,ie as e,be as f,Se as g,we as h,ye as i,je as j,ge as k,ce as l,pe as m,xe as n,$e as o,Ae as p,he as q,Ne as r,Ee as s,Ie as t,me as u,Ve as v,ve as w,_e as x,Be as y,ke as z};
