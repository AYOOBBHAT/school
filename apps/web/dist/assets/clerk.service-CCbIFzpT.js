import{s as c,A as s}from"./index-BwYdIgyR.js";async function y(a){const e=await fetch(`${s}/students`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{students:[]}}async function h(a,e){let t=`${s}/students-admin`;e&&(t+=`?class_group_id=${e}`);const r=await fetch(t,{headers:{Authorization:`Bearer ${a}`}});return r.ok?await r.json():{classes:[],unassigned:[]}}async function p(a){const e=await fetch(`${s}/classes`,{headers:{Authorization:`Bearer ${a}`}});return e.ok?await e.json():{classes:[]}}async function w(a,e){const t=await fetch(`${s}/clerk-fees/student/${e}/fee-structure`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok){const r=await t.json().catch(()=>({}));if(r.error&&r.error.includes("No fee configured"))return{message:"No fee configured for this student",fee_structure:null,monthly_ledger:[]};throw new Error(r.error||"Failed to load fee structure")}return await t.json()}async function $(a,e){const t=await fetch(`${s}/clerk-fees/student/${e}/payments`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{payments:[]}}async function g(a,e){const t=await fetch(`${s}/clerk-fees/collect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to collect fee")}return await t.json()}async function _(a,e,t){const r=await fetch(`${s}/salary/history/${e}?${t.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok){const i=await r.json().catch(()=>({}));throw new Error(i.error||"Failed to load payment history")}return await r.json()}async function S(a){var d;let e=[],t=[],r=[];try{const{data:o,error:n}=await c.from("monthly_fee_payments").select("payment_amount, payment_date, payment_mode").order("payment_date",{ascending:!1}).limit(10);!n&&o&&(e=o)}catch(o){console.error("Error loading recent payments from Supabase:",o)}try{const o=new Date().toISOString().split("T")[0],{data:n,error:l}=await c.from("monthly_fee_payments").select("payment_amount").gte("payment_date",o);!l&&n&&(t=n)}catch(o){console.error("Error loading today payments from Supabase:",o)}try{const{data:o,error:n}=await c.from("monthly_fee_components").select("pending_amount").in("status",["pending","partially-paid","overdue"]).gt("pending_amount",0);!n&&o&&(r=o)}catch(o){console.error("Error loading pending components from Supabase:",o)}const i=t.reduce((o,n)=>o+parseFloat(n.payment_amount||0),0),u=r.reduce((o,n)=>o+parseFloat(n.pending_amount||0),0);return{totalStudents:((d=(await y(a).catch(()=>({students:[]}))).students)==null?void 0:d.length)||0,todayCollection:i,totalPending:u,recentPayments:e}}async function j(a,e="last_12_months"){const t=await fetch(`${s}/salary/unpaid?time_scope=${e}`,{headers:{Authorization:`Bearer ${a}`}});return t.ok?await t.json():{teachers:[]}}async function F(a){const e=await fetch(`${s}/salary/summary`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){const t=await e.json().catch(()=>({error:"Failed to load salary summaries"}));throw new Error(t.error||"Failed to load salary summaries")}return await e.json()}async function k(a,e){const t=await fetch(`${s}/salary/payments`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to record payment")}return await t.json()}export{p as a,h as b,$ as c,g as d,w as e,j as f,F as g,_ as h,S as l,k as r};
