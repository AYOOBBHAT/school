const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AttendanceView-CkNwQXWd.js","assets/vendor-react-Cwbq-Nll.js","assets/vendor-BIu-86mi.js","assets/index-BLS27RO3.js","assets/index-8NdQwjMH.css","assets/auth.service-BqRRNXX5.js","assets/MarksEntryView-THM80f-b.js","assets/SalaryView-C6DM2Zar.js","assets/TeacherPaymentHistory-CX3VRHkp.js","assets/clerk.service-DWxizWMb.js","assets/StudentFeeStatusView-CsNv4S7g.js"])))=>i.map(i=>d[i]);
import{s as _,A as g,_ as b}from"./index-BLS27RO3.js";import{u as S,r as h,j as s}from"./vendor-react-Cwbq-Nll.js";import{g as E,L as j}from"./auth.service-BqRRNXX5.js";function N(){const a=S(),[t,e]=h.useState(!0),[r,c]=h.useState(null),[l,o]=h.useState(null),n=h.useRef(!0);return h.useEffect(()=>(n.current=!0,(async()=>{var d,p;try{const x=(d=(await _.auth.getSession()).data.session)==null?void 0:d.access_token;if(!x){n.current&&a("/login");return}const m=await E(x),f=(p=m.profile)==null?void 0:p.role;if(f!=="teacher"){console.warn("[useTeacherAuth] Unauthorized access attempt by role:",f);const y={principal:"/principal/dashboard",clerk:"/clerk",student:"/student/home",parent:"/parent/home"}[f]||"/login";n.current&&a(y,{replace:!0});return}n.current&&(c(f),o(m.profile))}catch(i){console.error("[useTeacherAuth] Error verifying role:",i),n.current&&a("/login");return}finally{n.current&&e(!1)}})(),()=>{n.current=!1}),[a]),{loading:t,role:r,profile:l}}function $({currentView:a,setCurrentView:t,profile:e,onLogout:r}){return s.jsx("div",{className:"w-64 bg-gray-900 text-white min-h-screen fixed left-0 top-0",children:s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"text-2xl font-bold mb-8",children:"JhelumVerse"}),s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"text-sm text-gray-400",children:"Logged in as"}),s.jsx("div",{className:"font-semibold",children:(e==null?void 0:e.full_name)||"Teacher"}),s.jsx("div",{className:"text-sm text-gray-400",children:e==null?void 0:e.email})]}),s.jsxs("nav",{className:"space-y-2",children:[s.jsx("button",{onClick:()=>t("classes"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="classes"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“š My Classes"}),s.jsx("button",{onClick:()=>t("attendance"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="attendance"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“… Attendance"}),s.jsx("button",{onClick:()=>t("marks"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="marks"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ“Š Marks Entry"}),s.jsx("button",{onClick:()=>t("salary"),className:`w-full text-left px-4 py-2 rounded-lg transition ${a==="salary"?"bg-blue-600":"hover:bg-gray-800"}`,children:"ðŸ’° My Salary"}),!1]}),s.jsx("button",{onClick:r,className:"mt-8 w-full text-left px-4 py-2 rounded-lg hover:bg-gray-800 transition",children:"ðŸšª Logout"})]})})}async function A(a,t){const e=await fetch(`${g}/teacher-assignments/teacher/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load assignments");return await e.json()}async function D(a){const t=await fetch(`${g}/exams`,{headers:{Authorization:`Bearer ${a}`}});if(!t.ok)throw new Error("Failed to load exams");return(await t.json()).exams||[]}async function V(a,t){const e=await fetch(`${g}/teacher-assignments/teacher/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw new Error("Failed to load classes");const c=(await e.json()).assignments||[],l=new Map;return c.forEach(o=>{l.has(o.class_group_id)||l.set(o.class_group_id,{id:o.class_group_id,name:o.class_groups.name})}),Array.from(l.values())}async function U(a,t,e){if(!e)return[];const r=await fetch(`${g}/teacher-assignments/teacher/${t}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Failed to load subjects");const l=(await r.json()).assignments||[],o=new Map;return l.filter(n=>n.class_group_id===e).forEach(n=>{o.has(n.subject_id)||o.set(n.subject_id,{id:n.subject_id,name:n.subjects.name,code:n.subjects.code})}),Array.from(o.values())}async function q(a,t){if(!t)return[];const e=new URLSearchParams({class_group_id:t}),r=await fetch(`${g}/students-admin?${e.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!r.ok)throw new Error("Failed to load students");const c=await r.json(),l=[];return c.classes&&c.classes.forEach(o=>{if(o.id===t){const n={};o.sections&&o.sections.forEach(u=>{n[u.id]=u.name}),o.students.forEach(u=>{l.push({...u,section_name:u.section_id&&n[u.section_id]||null})})}}),l}async function L(a,t,e){const r=new URLSearchParams({class_group_id:t});e&&r.append("section_id",e);const c=await fetch(`${g}/students-admin?${r.toString()}`,{headers:{Authorization:`Bearer ${a}`}});if(!c.ok)throw new Error("Failed to load students");const l=await c.json(),o=[];return l.classes&&l.classes.forEach(n=>{if(n.id===t){const u={};n.sections&&n.sections.forEach(d=>{u[d.id]=d.name}),n.students.forEach(d=>{(!e||d.section_id===e)&&o.push({id:d.id,roll_number:d.roll_number,section_id:d.section_id,section_name:d.section_id&&u[d.section_id]||null,profile:d.profile})})}}),o}async function I(a,t){const e=await fetch(`${g}/marks/bulk`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({marks:t})});if(!e.ok){const r=await e.json();throw new Error(r.error||"Failed to save marks")}}async function J(a,t){const[e,r]=await Promise.all([fetch(`${g}/salary/structure/${t}`,{headers:{Authorization:`Bearer ${a}`}}),fetch(`${g}/salary/records`,{headers:{Authorization:`Bearer ${a}`}})]);let c=null,l=[];return e.ok&&(c=(await e.json()).structure),r.ok&&(l=(await r.json()).records||[]),{structure:c,records:l}}function M({currentView:a}){const[t,e]=h.useState([]),[r,c]=h.useState(null),[l,o]=h.useState([]),[n,u]=h.useState(!0);h.useEffect(()=>{d()},[a]);const d=async()=>{var i,x,m;try{u(!0);const f=await _.auth.getSession(),v=(i=f.data.session)==null?void 0:i.access_token,y=(m=(x=f.data.session)==null?void 0:x.user)==null?void 0:m.id;if(!v||!y)return;const k=await A(v,y);e(k.assignments||[])}catch(f){console.error("Error loading assignments:",f),e([])}finally{u(!1)}},p=async i=>{var x;try{const m=(x=(await _.auth.getSession()).data.session)==null?void 0:x.access_token;if(!m)return;const f=await L(m,i.class_group_id,i.section_id||void 0);o(f),c(i)}catch(m){console.error("Error loading students:",m)}};return n?s.jsx("div",{className:"text-center py-8",children:"Loading..."}):s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-bold mb-6",children:"My Classes & Subjects"}),t.length===0?s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[s.jsx("div",{className:"text-gray-500 text-lg mb-2",children:"No classes assigned yet"}),s.jsx("div",{className:"text-gray-400 text-sm",children:"Contact your principal to assign you to classes and subjects."})]}):s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(i=>s.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition cursor-pointer",onClick:()=>p(i),children:[s.jsx("h3",{className:"text-xl font-bold mb-2",children:i.class_groups.name}),i.sections&&s.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Section: ",i.sections.name]}),s.jsxs("p",{className:"text-lg font-semibold text-blue-600",children:[i.subjects.name," ",i.subjects.code&&`(${i.subjects.code})`]}),i.class_groups.description&&s.jsx("p",{className:"text-sm text-gray-500 mt-2",children:i.class_groups.description})]},i.id))})]})}const w=(a,t=3)=>h.lazy(async()=>{for(let e=0;e<t;e++)try{return await a()}catch(r){if(e===t-1)throw console.error("Failed to load component after retries:",r),r;await new Promise(c=>setTimeout(c,1e3*(e+1)))}throw new Error("Failed to load component")}),R=w(()=>b(()=>import("./AttendanceView-CkNwQXWd.js"),__vite__mapDeps([0,1,2,3,4,5]))),F=w(()=>b(()=>import("./MarksEntryView-THM80f-b.js"),__vite__mapDeps([6,1,2,3,4,5]))),T=w(()=>b(()=>import("./SalaryView-C6DM2Zar.js"),__vite__mapDeps([7,1,2,3,4,8,9,5]))),P=w(()=>b(()=>import("./StudentFeeStatusView-CsNv4S7g.js"),__vite__mapDeps([10,1,2])));function z(){const a=S(),{profile:t,loading:e}=N(),[r,c]=h.useState("classes"),l=async()=>{await _.auth.signOut(),a("/login")};return e?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"text-xl",children:"Loading..."})}):s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx($,{currentView:r,setCurrentView:c,profile:t,onLogout:l}),s.jsx("div",{className:"ml-64",children:s.jsxs("div",{className:"p-6",children:[r==="classes"&&s.jsx(M,{currentView:r}),r==="attendance"&&s.jsx(j,{children:s.jsx(R,{profile:t})}),r==="marks"&&s.jsx(j,{children:s.jsx(F,{profile:t})}),r==="salary"&&s.jsx(j,{children:s.jsx(T,{profile:t})}),r==="fees"&&s.jsx(j,{children:s.jsx(P,{students:[],studentFeeStatus:{},loadingFees:!1})})]})})]})}const W=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));export{W as T,D as a,V as b,U as c,q as d,J as e,L as l,I as s};
