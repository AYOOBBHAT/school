const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/OverviewTab-BhaHEcv3.js","assets/index-CN_qW8X5.js","assets/index--4YWCpxC.css","assets/AttendanceTab-CE1jIvij.js","assets/MarksTab-DIZM6RMP.js"])))=>i.map(i=>d[i]);
import{u as y,r as n,s as h,A as g,j as e,_ as b}from"./index-CN_qW8X5.js";import{g as p,L as x}from"./auth.service-BN9bvnQx.js";function j(){const t=y(),[a,r]=n.useState(!0);return n.useEffect(()=>{(async()=>{var i,c;try{const d=(i=(await h.auth.getSession()).data.session)==null?void 0:i.access_token;if(!d){t("/login");return}const s=(c=(await p(d)).profile)==null?void 0:c.role;if(s!=="student"){const f={principal:"/principal/dashboard",clerk:"/clerk",teacher:"/teacher/classes",parent:"/parent"}[s]||"/login";t(f,{replace:!0});return}}catch(o){console.error("[StudentDashboard] Error verifying role:",o),t("/login")}finally{r(!1)}})()},[t]),{loading:a}}async function v(t){const a=await fetch(`${g}/students/profile`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const l=(await a.json().catch(()=>({error:"Failed to load profile"}))).error||"Failed to load profile";throw new Error(l)}return await a.json()}async function w(t){const a=await fetch(`${g}/students/attendance`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok){const r=await a.json().catch(()=>({error:"Unknown error"}));throw new Error(r.error||"Failed to load attendance")}return await a.json()}async function k(t){const a=await fetch(`${g}/students/marks`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Failed to load marks");return await a.json()}function S(){const[t,a]=n.useState(null),[r,l]=n.useState(!0),i=n.useCallback(async()=>{var c,o,d;try{const s=(c=(await h.auth.getSession()).data.session)==null?void 0:c.access_token;if(!s){l(!1);return}const m=await v(s);a(m.student)}catch(u){console.error("[useStudentProfile] Error loading profile:",u),((o=u.message)!=null&&o.includes("404")||(d=u.message)!=null&&d.includes("not found"))&&(console.error("[useStudentProfile] Student record not found"),a(null))}finally{l(!1)}},[]);return n.useEffect(()=>{i()},[i]),{profile:t,loading:r,loadProfile:i}}function _(){const[t,a]=n.useState([]),[r,l]=n.useState(null),[i,c]=n.useState(!1),o=n.useCallback(async()=>{var d,u;try{c(!0);const s=(d=(await h.auth.getSession()).data.session)==null?void 0:d.access_token;if(!s){console.error("[StudentDashboard] No token available");return}const m=await w(s);console.log("[useStudentAttendance] Attendance loaded:",{records:((u=m.attendance)==null?void 0:u.length)||0,summary:m.summary}),a(m.attendance||[]),l(m.summary||null)}catch(s){console.error("[useStudentAttendance] Error loading attendance:",s),a([]),l(null)}finally{c(!1)}},[]);return{attendance:t,attendanceSummary:r,loading:i,loadAttendance:o}}function N(){const[t,a]=n.useState([]),[r,l]=n.useState(!1),i=n.useCallback(async()=>{var c;try{l(!0);const o=(c=(await h.auth.getSession()).data.session)==null?void 0:c.access_token;if(!o)return;const d=await k(o);a(d.marks||[])}catch(o){console.error("Error loading marks:",o)}finally{l(!1)}},[]);return{marks:t,loading:r,loadMarks:i}}function A({profile:t,onLogout:a}){var r;return e.jsx("header",{className:"bg-white shadow-sm border-b",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Student Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:[((r=t.profiles)==null?void 0:r.full_name)||"Student",t.roll_number&&` • Roll No: ${t.roll_number}`,t.class_groups&&` • ${t.class_groups.name}`,t.sections&&` - ${t.sections.name}`]})]}),e.jsx("button",{onClick:a,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700",children:"Logout"})]})})})}function E({activeTab:t,setActiveTab:a}){return e.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:e.jsxs("div",{className:"flex border-b",children:[e.jsx("button",{onClick:()=>a("overview"),className:`px-6 py-3 font-medium ${t==="overview"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Overview"}),e.jsx("button",{onClick:()=>a("attendance"),className:`px-6 py-3 font-medium ${t==="attendance"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Attendance"}),e.jsx("button",{onClick:()=>a("marks"),className:`px-6 py-3 font-medium ${t==="marks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:"Marks"}),!1]})})}const L=n.lazy(()=>b(()=>import("./OverviewTab-BhaHEcv3.js"),__vite__mapDeps([0,1,2]))),P=n.lazy(()=>b(()=>import("./AttendanceTab-CE1jIvij.js"),__vite__mapDeps([3,1,2]))),$=n.lazy(()=>b(()=>import("./MarksTab-DIZM6RMP.js"),__vite__mapDeps([4,1,2])));function C(){const t=y(),{loading:a}=j(),{profile:r,loading:l}=S(),{attendance:i,attendanceSummary:c,loadAttendance:o}=_(),{marks:d,loadMarks:u}=N(),[s,m]=n.useState("overview");n.useEffect(()=>{s==="attendance"?o():s==="marks"&&u()},[s,o,u]);const f=async()=>{await h.auth.signOut(),t("/login")};return a||l?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"Loading..."})})}):r?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(A,{profile:r,onLogout:f}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx(E,{activeTab:s,setActiveTab:m}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[s==="overview"&&e.jsx(x,{children:e.jsx(L,{profile:r,attendanceSummary:c,feeSummary:null})}),s==="attendance"&&e.jsx(x,{children:e.jsx(P,{attendance:i,attendanceSummary:c})}),s==="marks"&&e.jsx(x,{children:e.jsx($,{marks:d})}),s==="fees"&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Fees & Payments"}),e.jsx("div",{className:"text-center py-12 text-gray-600",children:"Billing has been removed from this deployment."}),!1]})]})]})]}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"Profile not found"}),e.jsx("button",{onClick:()=>t("/login"),className:"mt-4 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Go to Login"})]})})}export{C as default};
