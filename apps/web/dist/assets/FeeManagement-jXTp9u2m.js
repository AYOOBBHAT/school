import{r as l,s as m,j as e}from"./index-BsIG4eoL.js";import{w as fe,E as be,X as je,Y as Ne,Z as ve,_ as _e,$ as we,a0 as Fe,a1 as Ce,a2 as Se,a3 as ke,a4 as Ae,a5 as Te,a6 as De,a7 as Le}from"./PrincipalDashboard-D7P6QpXr.js";import"./auth.service-CPocT0BX.js";import"./UnpaidFeeAnalytics-BEwbxtAT.js";import"./clerk.service-NPHe08Ze.js";function Be({userRole:U="principal"}){var Y,Z;const[n,W]=l.useState("class-fees"),[X,h]=l.useState(!1),p=U==="clerk",[L,J]=l.useState([]),[k,K]=l.useState([]),[G,R]=l.useState(!1),[d,y]=l.useState({class_group_id:"",name:"",amount:"",fee_cycle:"monthly",due_day:5,notes:""}),[A,ee]=l.useState([]),[se,E]=l.useState(!1),[u,w]=l.useState({class_group_id:"",name:"",amount:"",fee_cycle:"monthly"}),[H,te]=l.useState([]),[T,ae]=l.useState([]),[le,M]=l.useState(!1),[o,j]=l.useState({route_name:"",bus_number:"",distance_km:"",zone:"",description:""}),[re,P]=l.useState(!1),[r,g]=l.useState({route_id:"",base_fee:"",escort_fee:"0",fuel_surcharge:"0",fee_cycle:"monthly",due_day:5,notes:""}),[Re,ne]=l.useState([]),[B,de]=l.useState([]),[N,V]=l.useState(null),[F,ie]=l.useState(""),[f,ce]=l.useState(""),[Ee,He]=l.useState({student_id:"",class_group_id:"",month:new Date().getMonth()+1,year:new Date().getFullYear()}),[b,q]=l.useState(null),[oe,z]=l.useState(!1),[x,C]=l.useState({new_amount:"",effective_from_date:new Date().toISOString().split("T")[0],notes:""}),[O,$]=l.useState([]);l.useEffect(()=>{xe()},[]),l.useEffect(()=>(n==="class-fees"?S():n==="custom-fees"?v():n==="transport"?_():n==="tracking"?ge():n==="hikes"&&(S(),_(),v()),()=>{}),[n]);const xe=async()=>{var s;try{const t=(s=(await m.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const[a,i]=await Promise.all([fe(t),be(t)]);J(a.classes||[]),ne(i.students||[])}catch(t){console.error("Error loading initial data:",t)}},S=async()=>{var s;h(!0);try{const t=(s=(await m.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const a=await je(t);K(a.class_fees||[])}catch(t){console.error("Error loading class fees:",t)}finally{h(!1)}},v=async()=>{var s;h(!0);try{const t=(s=(await m.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const a=await Ne(t);ee(a.custom_fees||[])}catch(t){console.error("Error loading custom fees:",t)}finally{h(!1)}},_=async()=>{var s;h(!0);try{const t=(s=(await m.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const[a,i]=await Promise.all([ve(t),_e(t)]);te(a.routes||[]),ae(i.transport_fees||[])}catch(t){console.error("Error loading transport data:",t)}finally{h(!1)}},me=async s=>{var t;s.preventDefault();try{const a=(t=(await m.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;await Ce(a,{...d,amount:parseFloat(d.amount),due_day:parseInt(d.due_day.toString()),fee_category_id:null}),alert("Class fee saved successfully!"),R(!1),y({class_group_id:"",name:"",amount:"",fee_cycle:"monthly",due_day:5,notes:""}),S()}catch(a){alert(a.message||"Failed to save class fee")}},ue=async s=>{var t;s.preventDefault();try{const a=(t=(await m.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;await Se(a,{...u,amount:parseFloat(u.amount)}),alert("Custom fee saved successfully!"),E(!1),w({class_group_id:"",name:"",amount:"",fee_cycle:"monthly"}),v()}catch(a){alert(a.message||"Failed to save custom fee")}},pe=async s=>{var t;s.preventDefault();try{const a=(t=(await m.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;await ke(a,{...o,distance_km:o.distance_km?parseFloat(o.distance_km):null}),alert("Transport route saved successfully!"),M(!1),j({route_name:"",bus_number:"",distance_km:"",zone:"",description:""}),_()}catch(a){alert(a.message||"Failed to save route")}},he=async s=>{var t;s.preventDefault();try{const a=(t=(await m.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;await Ae(a,{...r,base_fee:parseFloat(r.base_fee),escort_fee:parseFloat(r.escort_fee)||0,fuel_surcharge:parseFloat(r.fuel_surcharge)||0,due_day:parseInt(r.due_day.toString())}),alert("Transport fee saved successfully!"),P(!1),g({route_id:"",base_fee:"",escort_fee:"0",fuel_surcharge:"0",fee_cycle:"monthly",due_day:5,notes:""}),_()}catch(a){alert(a.message||"Failed to save transport fee")}},ge=async()=>{var s;h(!0);try{const t=(s=(await m.auth.getSession()).data.session)==null?void 0:s.access_token;if(!t)return;const i=((await we(t)).students||[]).map(c=>({student:c,total_assigned:0,total_paid:0,pending_amount:0,transport_amount:0}));de(i)}catch(t){console.error("Error loading fee tracking:",t)}finally{h(!1)}},I=async(s,t)=>{var a,i;q({...s,feeType:t}),C({new_amount:((a=s.amount)==null?void 0:a.toString())||"",effective_from_date:new Date().toISOString().split("T")[0],notes:""}),z(!0);try{const c=(i=(await m.auth.getSession()).data.session)==null?void 0:i.access_token;if(!c)return;const D=await Te(c,t,s.id);$(D.versions||[])}catch(c){console.error("Error loading fee versions:",c)}},ye=async s=>{var t;if(s.preventDefault(),!!b)try{const a=(t=(await m.auth.getSession()).data.session)==null?void 0:t.access_token;if(!a)return;if(b.feeType==="class")await De(a,b.id,{new_amount:parseFloat(x.new_amount),effective_from_date:x.effective_from_date,notes:x.notes});else if(b.feeType==="transport")await Le(a,b.id,{new_amount:parseFloat(x.new_amount),effective_from_date:x.effective_from_date,notes:x.notes});else return;alert("Fee hike applied successfully! Future bills will use the new amount."),z(!1),q(null),C({new_amount:"",effective_from_date:new Date().toISOString().split("T")[0],notes:""}),n==="class-fees"?S():n==="transport"?_():n==="custom-fees"?v():n==="hikes"&&(S(),_(),v())}catch(a){alert(a.message||"Failed to hike fee")}};return X?e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:"Loading..."})})}):e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6",children:"Fee Management"}),e.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{className:"flex -mb-px",children:[...p?[]:[{id:"class-fees",label:"Class Fees"},{id:"custom-fees",label:"Custom Fees"},{id:"transport",label:"Transport"},{id:"hikes",label:"Fee Hikes"}],{id:"tracking",label:"Fee Tracking"}].map(s=>e.jsx("button",{onClick:()=>W(s.id),className:`px-6 py-4 text-sm font-medium border-b-2 ${n===s.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:s.label},s.id))})})}),n==="custom-fees"&&!p&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Custom Fees"}),!p&&e.jsx("button",{onClick:()=>E(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Add Custom Fee"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cycle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Effective From"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:'No custom fees found. Click "Add Custom Fee" to create one.'})}):A.map(s=>{var t,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-medium",children:((t=s.class_groups)==null?void 0:t.name)||"All Classes"}),e.jsx("td",{className:"px-6 py-4",children:((a=s.fee_categories)==null?void 0:a.name)||s.name||"-"}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.amount||0).toFixed(2)]}),e.jsx("td",{className:"px-6 py-4",children:s.fee_cycle||"-"}),e.jsx("td",{className:"px-6 py-4 text-xs text-gray-500",children:s.effective_from?new Date(s.effective_from).toLocaleDateString():"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:async()=>{var i;if(confirm("Are you sure you want to delete this custom fee?"))try{const c=(i=(await m.auth.getSession()).data.session)==null?void 0:i.access_token;if(!c)return;await Fe(c,s.id),alert("Custom fee deleted successfully!"),v()}catch(c){alert(c.message||"Failed to delete custom fee")}},className:"text-red-600 hover:text-red-800",children:"Delete"})})]},s.id)})})]})})]}),n==="class-fees"&&!p&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Class Fees"}),!p&&e.jsx("button",{onClick:()=>R(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Add Class Fee"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cycle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Due Day"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:'No class fees found. Click "Add Class Fee" to get started.'})}):k.map(s=>{var t,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:((t=s.class_groups)==null?void 0:t.name)||"-"}),e.jsx("td",{className:"px-6 py-4",children:s.name||((a=s.fee_categories)==null?void 0:a.name)||"Class Fee"}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.amount||0).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4",children:s.fee_cycle}),e.jsx("td",{className:"px-6 py-4",children:s.due_day||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800",children:"Edit"})})]},s.id)})})]})})]}),n==="transport"&&!p&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Transport Routes"}),!p&&e.jsx("button",{onClick:()=>M(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Add Route"})]}),e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Route Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Bus Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Zone"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Distance"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:H.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:"No transport routes found."})}):H.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-medium",children:s.route_name}),e.jsx("td",{className:"px-6 py-4",children:s.bus_number||"-"}),e.jsx("td",{className:"px-6 py-4",children:s.zone||"-"}),e.jsx("td",{className:"px-6 py-4",children:s.distance_km?`${s.distance_km} km`:"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800",children:"Edit"})})]},s.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Transport Fees"}),!p&&e.jsx("button",{onClick:()=>P(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"+ Add Transport Fee"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Route"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Base Fee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Escort Fee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fuel Surcharge"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cycle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"No transport fees found."})}):T.map(s=>{var t;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:((t=s.transport_routes)==null?void 0:t.route_name)||"-"}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.base_fee||0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.escort_fee||0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.fuel_surcharge||0).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4",children:s.fee_cycle}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800",children:"Edit"})})]},s.id)})})]})})]})]}),n==="tracking"&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Fee Collection Tracking"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("select",{value:F,onChange:s=>ie(s.target.value),className:"border border-gray-300 rounded-lg px-4 py-2",children:[e.jsx("option",{value:"",children:"All Classes"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:f,onChange:s=>ce(s.target.value),className:"border border-gray-300 rounded-lg px-4 py-2",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"partial",children:"Partially Paid"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Student"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Roll Number"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Assigned"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Total Paid"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Pending Amount"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Transport Fee"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:B.filter(s=>{var t;return!(F&&((t=s.student)==null?void 0:t.class_group_id)!==F||f==="paid"&&s.pending_amount>0||f==="pending"&&s.pending_amount===0||f==="partial"&&(s.pending_amount===0||s.total_paid===0))}).length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"px-6 py-4 text-center text-gray-500",children:"No fee tracking data found."})}):B.filter(s=>{var t;return!(F&&((t=s.student)==null?void 0:t.class_group_id)!==F||f==="paid"&&s.pending_amount>0||f==="pending"&&s.pending_amount===0||f==="partial"&&(s.pending_amount===0||s.total_paid===0))}).map(s=>{var t,a,i,c,D,Q;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 font-medium",children:((a=(t=s.student)==null?void 0:t.profile)==null?void 0:a.full_name)||"-"}),e.jsx("td",{className:"px-6 py-4",children:((i=s.student)==null?void 0:i.roll_number)||"-"}),e.jsx("td",{className:"px-6 py-4",children:((D=(c=s.student)==null?void 0:c.class_groups)==null?void 0:D.name)||"-"}),e.jsxs("td",{className:"px-6 py-4 text-right font-semibold",children:["₹",parseFloat(s.total_assigned||0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 text-right text-green-600",children:["₹",parseFloat(s.total_paid||0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 text-right font-semibold text-red-600",children:["₹",parseFloat(s.pending_amount||0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 text-right",children:["₹",parseFloat(s.transport_amount||0).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.pending_amount===0?"bg-green-100 text-green-800":s.total_paid>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.pending_amount===0?"Paid":s.total_paid>0?"Partial":"Pending"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>{V(s)},className:"text-blue-600 hover:text-blue-800 mr-2",children:"View Details"})})]},(Q=s.student)==null?void 0:Q.id)})})]})})]}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold",children:["Fee Details - ",(Z=(Y=N.student)==null?void 0:Y.profile)==null?void 0:Z.full_name]}),e.jsx("button",{onClick:()=>V(null),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-bold mb-3",children:"Fee Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Assigned"}),e.jsxs("p",{className:"text-xl font-semibold",children:["₹",parseFloat(N.total_assigned||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Paid"}),e.jsxs("p",{className:"text-xl font-semibold text-green-600",children:["₹",parseFloat(N.total_paid||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pending"}),e.jsxs("p",{className:"text-xl font-semibold text-red-600",children:["₹",parseFloat(N.pending_amount||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Transport Fee"}),e.jsxs("p",{className:"text-xl font-semibold",children:["₹",parseFloat(N.transport_amount||0).toLocaleString()]})]})]})]})})]})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Class Fee"}),e.jsxs("form",{onSubmit:me,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Class *"}),e.jsxs("select",{value:d.class_group_id,onChange:s=>y({...d,class_group_id:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Class"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fee Name *"}),e.jsx("input",{type:"text",value:d.name,onChange:s=>y({...d,name:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., Tuition Fee, Development Fee",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (₹) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:d.amount,onChange:s=>y({...d,amount:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fee Cycle *"}),e.jsxs("select",{value:d.fee_cycle,onChange:s=>y({...d,fee_cycle:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0,children:[e.jsx("option",{value:"one-time",children:"One-time"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),d.fee_cycle!=="one-time"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Due Day (1-31)"}),e.jsx("input",{type:"number",min:"1",max:"31",value:d.due_day,onChange:s=>y({...d,due_day:parseInt(s.target.value)}),className:"w-full border border-gray-300 rounded-lg px-4 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{value:d.notes,onChange:s=>y({...d,notes:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",rows:3})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),se&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Custom Fee"}),e.jsxs("form",{onSubmit:ue,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Class"}),e.jsxs("select",{value:u.class_group_id,onChange:s=>w({...u,class_group_id:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",children:[e.jsx("option",{value:"",children:"All Classes"}),L.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Select "All Classes" to apply this fee to all classes, or select a specific class'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Custom Fee Name *"}),e.jsx("input",{type:"text",value:u.name,onChange:s=>w({...u,name:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., Library Fee, Lab Fee, Sports Fee",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Amount (₹) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:u.amount,onChange:s=>w({...u,amount:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fee Cycle *"}),e.jsxs("select",{value:u.fee_cycle,onChange:s=>w({...u,fee_cycle:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0,children:[e.jsx("option",{value:"one-time",children:"One-time"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>E(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),le&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Transport Route"}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Route Name *"}),e.jsx("input",{type:"text",value:o.route_name,onChange:s=>j({...o,route_name:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., Route A, North Zone",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bus Number"}),e.jsx("input",{type:"text",value:o.bus_number,onChange:s=>j({...o,bus_number:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., BUS-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Zone"}),e.jsx("input",{type:"text",value:o.zone,onChange:s=>j({...o,zone:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",placeholder:"e.g., North, South, East, West"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Distance (km)"}),e.jsx("input",{type:"number",step:"0.1",min:"0",value:o.distance_km,onChange:s=>j({...o,distance_km:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:s=>j({...o,description:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",rows:3})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>M(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),re&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Transport Fee"}),e.jsxs("form",{onSubmit:he,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Route *"}),e.jsxs("select",{value:r.route_id,onChange:s=>g({...r,route_id:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Route"}),H.map(s=>e.jsxs("option",{value:s.id,children:[s.route_name," ",s.bus_number?`(${s.bus_number})`:""]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Base Fee (₹) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.base_fee,onChange:s=>g({...r,base_fee:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Escort Fee (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.escort_fee,onChange:s=>g({...r,escort_fee:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fuel Surcharge (₹)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:r.fuel_surcharge,onChange:s=>g({...r,fuel_surcharge:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fee Cycle *"}),e.jsxs("select",{value:r.fee_cycle,onChange:s=>g({...r,fee_cycle:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",required:!0,children:[e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"per-trip",children:"Per Trip"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),r.fee_cycle!=="per-trip"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Due Day (1-31)"}),e.jsx("input",{type:"number",min:"1",max:"31",value:r.due_day,onChange:s=>g({...r,due_day:parseInt(s.target.value)}),className:"w-full border border-gray-300 rounded-lg px-4 py-2"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("textarea",{value:r.notes,onChange:s=>g({...r,notes:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2",rows:3})]})]}),e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>P(!1),className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),n==="hikes"&&!p&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Fee Hikes & Version History"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Increase or decrease fees for future billing periods. Past bills remain unchanged."}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Class Fees"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Current Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cycle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:k.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:"No class fees found."})}):k.map(s=>{var t,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:((t=s.class_groups)==null?void 0:t.name)||"-"}),e.jsx("td",{className:"px-6 py-4",children:s.name||((a=s.fee_categories)==null?void 0:a.name)||"Class Fee"}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.amount||0).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4",children:s.fee_cycle}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>I(s,"class"),className:"text-blue-600 hover:text-blue-800 mr-4",children:"Hike Fee"})})]},s.id)})})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Transport Fees"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Route"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Current Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cycle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500",children:"No transport fees found."})}):T.map(s=>{var a;const t=parseFloat(s.base_fee||0)+parseFloat(s.escort_fee||0)+parseFloat(s.fuel_surcharge||0);return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:((a=s.transport_routes)==null?void 0:a.route_name)||"-"}),e.jsxs("td",{className:"px-6 py-4",children:["₹",t.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4",children:s.fee_cycle}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>I({...s,amount:t},"transport"),className:"text-blue-600 hover:text-blue-800 mr-4",children:"Hike Fee"})})]},s.id)})})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Custom Fees"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Class"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fee Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Current Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cycle"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-500",children:"No custom fees found."})}):A.map(s=>{var t,a;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4",children:((t=s.class_groups)==null?void 0:t.name)||"All Classes"}),e.jsx("td",{className:"px-6 py-4",children:((a=s.fee_categories)==null?void 0:a.name)||s.name||"-"}),e.jsxs("td",{className:"px-6 py-4",children:["₹",parseFloat(s.amount||0).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4",children:s.fee_cycle||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>I(s,"custom"),className:"text-blue-600 hover:text-blue-800 mr-4",children:"Hike Fee"})})]},s.id)})})]})})]})]}),oe&&b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Hike Fee"}),e.jsxs("form",{onSubmit:ye,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Amount"}),e.jsx("input",{type:"text",value:b.amount||"",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Amount *"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:x.new_amount,onChange:s=>C({...x,new_amount:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Effective From Date *"}),e.jsx("input",{type:"date",required:!0,value:x.effective_from_date,onChange:s=>C({...x,effective_from_date:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Bills generated after this date will use the new amount. Past bills remain unchanged."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:x.notes,onChange:s=>C({...x,notes:s.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",rows:3})]}),O.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Version History"}),e.jsx("div",{className:"max-h-40 overflow-y-auto border border-gray-300 rounded-lg p-2",children:O.map((s,t)=>e.jsxs("div",{className:"text-xs mb-2 pb-2 border-b last:border-0",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-medium",children:["Version ",s.version_number]}),e.jsxs("span",{children:["₹",parseFloat(s.amount||0).toLocaleString()]})]}),e.jsxs("div",{className:"text-gray-500",children:[new Date(s.effective_from_date).toLocaleDateString()," -"," ",s.effective_to_date?new Date(s.effective_to_date).toLocaleDateString():"Active"]})]},s.id))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{z(!1),q(null),$([])},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Apply Fee Hike"})]})]})]})})]})}export{Be as default};
