import{r as o,s as S,j as e}from"./index-DXuew0dG.js";import{f as E,g as A,r as U}from"./clerk.service-Dvr-vPlJ.js";import{T as $}from"./TeacherPaymentHistory-BN7vvAnm.js";function Y(){var w;const[F,u]=o.useState([]),[_,f]=o.useState([]),[D,y]=o.useState(!0),[j,M]=o.useState(new Set),[P,c]=o.useState(!1),[k,b]=o.useState(!1),[s,x]=o.useState(null),[h,v]=o.useState(null),[n,r]=o.useState({payment_date:new Date().toISOString().split("T")[0],amount:"",payment_mode:"bank",payment_proof:"",notes:"",salary_month:new Date().getMonth()+1,salary_year:new Date().getFullYear(),payment_type:"salary"});o.useEffect(()=>{N()},[]);const N=async()=>{var t;try{y(!0);const i=(t=(await S.auth.getSession()).data.session)==null?void 0:t.access_token;if(!i){console.error("No authentication token found"),y(!1);return}const l=await E(i,"last_12_months");f(l.teachers||[]);try{const d=((await A(i)).summaries||[]).filter(m=>m.pending_salary>0);u(d)}catch(a){console.error("Error loading salary summaries:",a),u([])}}catch(i){console.error("Error loading salary data:",i),f([]),u([])}finally{y(!1)}},L=t=>{const i=new Set(j);i.has(t)?i.delete(t):i.add(t),M(i)},C=async t=>{var a,d;if(t.preventDefault(),!s)return;const i=parseFloat(n.amount);if(isNaN(i)||i<=0){alert("Please enter a valid payment amount");return}const l=((a=s.selectedMonth)==null?void 0:a.net_salary)||s.pending_salary;if(i>l){const m=i-l;if(!confirm(`Payment amount (₹${i.toLocaleString()}) exceeds expected salary (₹${l.toLocaleString()}) for this month.

Excess amount (₹${m.toLocaleString()}) will be automatically applied as credit to future unpaid months.

Continue?`))return}try{const m=(d=(await S.auth.getSession()).data.session)==null?void 0:d.access_token;if(!m)return;const p=await U(m,{teacher_id:s.teacher.id,payment_date:n.payment_date,amount:i,payment_mode:n.payment_mode,payment_proof:n.payment_proof||null,notes:n.notes||null,salary_month:n.salary_month,salary_year:n.salary_year,payment_type:n.payment_type});if(p.excess_amount&&p.excess_amount>0){const g=p.credit_applied||{},T=`Payment recorded successfully!

Excess Amount: ₹${p.excess_amount.toFixed(2)}
Credit Applied: ₹${(g.applied_amount||0).toFixed(2)}
Months Applied: ${g.months_applied||0}
Remaining Credit: ₹${(g.remaining_credit||0).toFixed(2)}`;alert(T)}else alert("Payment recorded successfully!");c(!1),x(null),r({payment_date:new Date().toISOString().split("T")[0],amount:"",payment_mode:"bank",payment_proof:"",notes:"",salary_month:new Date().getMonth()+1,salary_year:new Date().getFullYear(),payment_type:"salary"}),N()}catch(m){alert(m.message||"Failed to record payment")}};return D?e.jsx("div",{children:e.jsx("div",{className:"text-center py-8",children:"Loading teacher salary information..."})}):e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:"Pay Salary"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Record salary payments directly. You can pay full, partial, or advance payments to teachers."})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase w-8"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Teacher"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Unpaid Months"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Total Unpaid"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 text-center text-gray-500",children:"No teachers with pending salary. All teachers are up to date with their payments."})}):_.map(t=>{const i=j.has(t.teacher_id),l=F.find(a=>{var d;return((d=a.teacher)==null?void 0:d.id)===t.teacher_id});return e.jsxs(o.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:t.unpaid_months_count>0&&e.jsx("button",{onClick:()=>L(t.teacher_id),className:"text-gray-500 hover:text-gray-700",children:i?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})}),e.jsx("td",{className:"px-6 py-4 font-medium",children:t.teacher_name||"Unknown"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:t.teacher_email||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[t.unpaid_months_count," ",t.unpaid_months_count===1?"month":"months"]})}),e.jsxs("td",{className:"px-6 py-4 font-semibold text-orange-600",children:["₹",t.total_unpaid_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{x({teacher:{id:t.teacher_id,full_name:t.teacher_name,email:t.teacher_email},total_salary_due:(l==null?void 0:l.total_salary_due)||0,total_salary_paid:(l==null?void 0:l.total_salary_paid)||0,pending_salary:t.total_unpaid_amount,unpaid_months:t.unpaid_months||[]});const a=t.unpaid_months&&t.unpaid_months.length>0?t.unpaid_months[t.unpaid_months.length-1]:null;r({payment_date:new Date().toISOString().split("T")[0],amount:a?a.pending_amount.toFixed(2):t.total_unpaid_amount.toFixed(2),payment_mode:"bank",payment_proof:"",notes:"",salary_month:a?a.month:new Date().getMonth()+1,salary_year:a?a.year:new Date().getFullYear(),payment_type:"salary"}),c(!0)},className:"text-blue-600 hover:text-blue-900 font-medium",children:"Record Payment"}),e.jsx("button",{onClick:()=>{v({id:t.teacher_id,name:t.teacher_name||"Unknown"}),b(!0)},className:"text-emerald-600 hover:text-emerald-900 font-medium",children:"View History"})]})})]}),i&&t.unpaid_months&&t.unpaid_months.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-6 py-4 bg-gray-50",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Monthly Breakdown:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase",children:"Month"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase",children:"Days Overdue"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase",children:"Notes"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase",children:"Action"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.unpaid_months.map((a,d)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 text-sm font-medium",children:a.period_label}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${a.payment_status==="paid"?"bg-green-100 text-green-800":a.payment_status==="partially-paid"?"bg-yellow-100 text-yellow-800":"bg-orange-100 text-orange-800"}`,children:a.payment_status==="paid"?"Paid":a.payment_status==="partially-paid"?"Partially Paid":"Unpaid"})}),e.jsxs("td",{className:"px-4 py-2 text-sm",children:[e.jsxs("div",{className:"font-semibold",children:["₹",a.net_salary.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),a.paid_amount>0&&e.jsxs("div",{className:"text-xs text-green-600",children:["Cash: ₹",a.paid_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),a.credit_applied>0&&e.jsxs("div",{className:"text-xs text-blue-600",children:["Credit: ₹",a.credit_applied.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),a.effective_paid_amount>0&&a.effective_paid_amount!==a.paid_amount&&e.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:["Total: ₹",a.effective_paid_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),a.pending_amount>0&&e.jsxs("div",{className:"text-xs text-orange-600",children:["Pending: ₹",a.pending_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsx("td",{className:"px-4 py-2 text-sm",children:a.days_since_period_start>0?e.jsxs("span",{className:"text-red-600 font-medium",children:[a.days_since_period_start," days"]}):e.jsx("span",{className:"text-gray-500",children:"-"})}),e.jsxs("td",{className:"px-4 py-2 text-xs text-gray-500",children:[a.payment_date&&e.jsxs("span",{children:["Last payment: ",new Date(a.payment_date).toLocaleDateString()]}),!a.payment_date&&a.payment_status==="unpaid"&&e.jsx("span",{className:"text-orange-600",children:"No payment recorded"})]}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("button",{onClick:()=>{x({teacher:{id:t.teacher_id,full_name:t.teacher_name,email:t.teacher_email},total_salary_due:(l==null?void 0:l.total_salary_due)||0,total_salary_paid:(l==null?void 0:l.total_salary_paid)||0,pending_salary:a.pending_amount,unpaid_months:t.unpaid_months||[],selectedMonth:a}),r({payment_date:new Date().toISOString().split("T")[0],amount:a.pending_amount>0?a.pending_amount.toFixed(2):a.net_salary.toFixed(2),payment_mode:"bank",payment_proof:"",notes:"",salary_month:a.month,salary_year:a.year,payment_type:"salary"}),c(!0)},className:"text-xs text-blue-600 hover:text-blue-900 font-medium px-2 py-1 border border-blue-300 rounded hover:bg-blue-50",children:"Pay"})})]},`${a.year}-${a.month}-${d}`))})]})})]})})})]},t.teacher_id)})})]})}),P&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Record Salary Payment"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Teacher: ",e.jsx("strong",{children:(w=s.teacher)==null?void 0:w.full_name})]}),s.selectedMonth&&e.jsxs("p",{className:"text-sm text-blue-600 mb-2 font-medium",children:["Paying for: ",s.selectedMonth.period_label]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg mb-4",children:s.selectedMonth?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Month Salary:"}),e.jsxs("span",{className:"font-semibold",children:["₹",s.selectedMonth.net_salary.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),s.selectedMonth.paid_amount>0&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Cash Paid:"}),e.jsxs("span",{className:"text-green-600",children:["₹",s.selectedMonth.paid_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),s.selectedMonth.credit_applied>0&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Credit Applied:"}),e.jsxs("span",{className:"text-blue-600",children:["₹",s.selectedMonth.credit_applied.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),s.selectedMonth.effective_paid_amount>0&&s.selectedMonth.effective_paid_amount!==s.selectedMonth.paid_amount&&e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Total Paid:"}),e.jsxs("span",{className:"text-gray-700 font-medium",children:["₹",s.selectedMonth.effective_paid_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold pt-2 border-t",children:[e.jsx("span",{children:"Pending for this month:"}),e.jsxs("span",{className:"text-orange-600",children:["₹",s.selectedMonth.pending_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Total Due:"}),e.jsxs("span",{className:"font-semibold",children:["₹",s.total_salary_due.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-600",children:"Total Paid:"}),e.jsxs("span",{className:"text-green-600",children:["₹",s.total_salary_paid.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"flex justify-between text-sm font-semibold pt-2 border-t",children:[e.jsx("span",{children:"Pending:"}),e.jsxs("span",{className:"text-orange-600",children:["₹",s.pending_salary.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]})]})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Amount (₹) *"}),e.jsx("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:n.amount,onChange:t=>r({...n,amount:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"Enter payment amount"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["You can pay full, partial, or advance amounts.",s.selectedMonth?e.jsxs(e.Fragment,{children:["Expected: ₹",s.selectedMonth.net_salary.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),".",s.selectedMonth.pending_amount>0&&e.jsxs(e.Fragment,{children:[" Pending: ₹",s.selectedMonth.pending_amount.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),"."]}),s.selectedMonth.credit_applied>0&&e.jsxs(e.Fragment,{children:[" Credit applied: ₹",s.selectedMonth.credit_applied.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),"."]})]}):e.jsxs(e.Fragment,{children:[" Pending: ₹",s.pending_salary.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),"."]}),s.selectedMonth&&parseFloat(n.amount)>s.selectedMonth.net_salary&&e.jsx("span",{className:"block mt-1 text-blue-600 font-medium",children:"ⓘ Excess amount will be applied as credit to future months automatically."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Salary Month *"}),e.jsx("select",{required:!0,value:n.salary_month,onChange:t=>r({...n,salary_month:parseInt(t.target.value)}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:Array.from({length:12},(t,i)=>i+1).map(t=>e.jsx("option",{value:t,children:new Date(2e3,t-1).toLocaleString("default",{month:"long"})},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Salary Year *"}),e.jsx("select",{required:!0,value:n.salary_year,onChange:t=>r({...n,salary_year:parseInt(t.target.value)}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:Array.from({length:5},(t,i)=>new Date().getFullYear()-2+i).map(t=>e.jsx("option",{value:t,children:t},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Date *"}),e.jsx("input",{type:"date",required:!0,value:n.payment_date,onChange:t=>r({...n,payment_date:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Date when the payment was actually made"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Mode *"}),e.jsxs("select",{required:!0,value:n.payment_mode,onChange:t=>r({...n,payment_mode:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"bank",children:"Bank Transfer"}),e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Type *"}),e.jsxs("select",{required:!0,value:n.payment_type,onChange:t=>r({...n,payment_type:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",children:[e.jsx("option",{value:"salary",children:"Monthly Salary"}),e.jsx("option",{value:"advance",children:"Advance Payment"}),e.jsx("option",{value:"adjustment",children:"Adjustment"}),e.jsx("option",{value:"bonus",children:"Bonus"}),e.jsx("option",{value:"loan",children:"Loan/Extra Payment"}),e.jsx("option",{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Payment Proof (Optional)"}),e.jsx("input",{type:"text",value:n.payment_proof,onChange:t=>r({...n,payment_proof:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",placeholder:"URL or file path to payment proof"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Upload proof document and paste URL here, or leave empty"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes (Optional)"}),e.jsx("textarea",{value:n.notes,onChange:t=>r({...n,notes:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2",rows:3,placeholder:"Additional notes about this payment"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Record Payment"}),e.jsx("button",{type:"button",onClick:()=>{c(!1),x(null),r({payment_date:new Date().toISOString().split("T")[0],amount:"",payment_mode:"bank",payment_proof:"",notes:"",salary_month:new Date().getMonth()+1,salary_year:new Date().getFullYear(),payment_type:"salary"})},className:"flex-1 bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})}),k&&h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx($,{teacherId:h.id,teacherName:h.name,onClose:()=>{b(!1),v(null)},showHeader:!0})})})]})}export{Y as default};
